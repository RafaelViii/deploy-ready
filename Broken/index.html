<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accounting Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    body { margin: 0; background: #f4f6f8; color: #111827; }

    /* Layout */
    .app { display: flex; min-height: 100vh; }
    .sidebar {
      width: 220px;
      background: #111827;
      color: #fff;
      padding: 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      z-index: 100;
    }
    
    .sidebar-header {
      padding: 1.5rem 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .sidebar-header h2 { 
      text-align: center; 
      margin: 0; 
      font-size: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .sidebar nav {
      padding: 1rem 0;
      flex: 1;
    }
    
    .sidebar nav a {
      display: block;
      padding: 0.6rem 0.8rem;
      margin: 0 1rem 0.4rem 1rem;
      border-radius: 8px;
      color: #d1d5db;
      text-decoration: none;
      font-size: 0.95rem;
    }
    .sidebar nav a.active,
    .sidebar nav a:hover { background: #1f2933; color: #fff; }
    
    /* User Profile Section */
    .user-profile {
      margin-top: auto;
      border-top: 1px solid rgba(255,255,255,0.1);
      position: relative;
    }
    
    .user-profile-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .user-profile-header:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    
    .user-info {
      flex: 1;
      min-width: 0;
    }
    
    .user-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: white;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .user-role {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
      margin-top: 0.1rem;
    }
    
    .dropdown-icon {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
      transition: transform 0.2s;
    }
    
    .user-profile-header.open .dropdown-icon {
      transform: rotate(180deg);
    }
    
    /* User Dropdown */
    .user-dropdown {
      display: none;
      background: #0f172a;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    
    .user-dropdown.open {
      display: block;
    }
    
    .dropdown-section {
      padding: 0.75rem;
    }
    
    .dropdown-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.5);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 0.5rem 0.75rem;
      font-weight: 600;
    }
    
    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      width: 100%;
      background: transparent;
      border: none;
      color: rgba(255,255,255,0.8);
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
      text-align: left;
    }
    
    .dropdown-item:hover {
      background: rgba(255,255,255,0.1);
      color: white;
    }
    
    .dropdown-item.active {
      background: rgba(99, 179, 237, 0.2);
      color: white;
    }
    
    .role-icon {
      font-size: 1.25rem;
      line-height: 1;
    }
    
    .role-info {
      flex: 1;
    }
    
    .role-name {
      font-size: 0.9rem;
      font-weight: 600;
    }
    
    .role-desc {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.5);
      margin-top: 0.1rem;
    }
    
    .dropdown-divider {
      height: 1px;
      background: rgba(255,255,255,0.1);
      margin: 0.5rem 0.75rem;
    }
    
    .logout-icon {
      font-size: 1.1rem;
    }
    
    .logout-btn:hover {
      background: rgba(239, 68, 68, 0.2) !important;
      color: #fca5a5 !important;
    }

    .main { 
      flex: 1; 
      padding: 1rem;
      margin-left: 220px;
    }

    /* Inventory Overview Section */
    .inventory-overview-section {
      margin-bottom: 2rem;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .section-title {
      font-size: 1rem;
      font-weight: 600;
      color: #6b7280;
      margin: 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .period-selector {
      display: flex;
      gap: 0.5rem;
      background: #f3f4f6;
      padding: 0.25rem;
      border-radius: 8px;
    }
    
    .period-btn {
      padding: 0.4rem 0.875rem;
      border: none;
      background: transparent;
      color: #6b7280;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .period-btn:hover {
      color: #374151;
      background: rgba(255, 255, 255, 0.5);
    }
    
    .period-btn.active {
      background: white;
      color: #196894;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .inventory-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .overview-card {
      background: #fff;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.06);
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }
    
    .overview-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.12);
    }
    
    .overview-card:active {
      transform: translateY(-2px);
    }
    
    .overview-content {
      width: 100%;
    }
    
    .overview-label {
      font-size: 0.85rem;
      color: #6b7280;
      margin: 0;
    }
    
    .overview-value {
      margin-top: 0.5rem;
      font-size: 1.4rem;
      font-weight: 600;
      color: #111827;
    }
    
    .available-card .overview-value {
      color: #10b981;
    }
    
    .low-stock-card .overview-value {
      color: #f59e0b;
    }
    
    .out-stock-card .overview-value {
      color: #ef4444;
    }
    
    .expiring-card .overview-value {
      color: #8b5cf6;
    }
    
    .overview-card.pressing {
      transform: scale(0.98);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    header { margin-bottom: 1rem; }
    header h1 { margin: 0; font-size: 1.6rem; }
    header p { margin-top: 0.25rem; color: #6b7280; }
    
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .dashboard-date {
      padding: 0.625rem 1rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      white-space: nowrap;
    }

    .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
    .card { background: #fff; padding: 1rem; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
    .card h3 { font-size: 0.85rem; color: #6b7280; margin: 0; }
    .card .value { margin-top: 0.5rem; font-size: 1.4rem; font-weight: 600; }

    .charts { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1rem; }
    .chart-card { background: #fff; padding: 1rem; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
    .chart-card h3 { margin-bottom: 1rem; font-size: 1rem; }

    .transactions, .alerts { margin-bottom: 1rem; position: relative; }
    .transactions table, .alerts table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
    .transactions th, .transactions td, .alerts th, .alerts td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
    .transactions th, .alerts th { background: #f9fafb; }

    .page { display: none; }
    .page.active { display: block; }

    /* === PATIENT LIST / LABORATORY LOGBOOK CSS === */
    .patient-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .patient-list-header h2 {
      margin: 0;
      font-size: 1.75rem;
      font-weight: 700;
      color: #111827;
    }

    .btn-manage-lab-types {
      padding: 0.75rem 1.5rem;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-manage-lab-types:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
    }

    .add-patient-form {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }

    .add-patient-form h3 {
      margin: 0 0 1rem 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: #374151;
    }

    .patient-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 1rem;
      align-items: end;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-group.align-end {
      align-self: end;
    }

    .form-group label {
      font-size: 0.875rem;
      font-weight: 600;
      color: #374151;
    }

    .form-group input,
    .form-group select {
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.9rem;
      transition: all 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .btn-add-patient {
      padding: 0.75rem 2rem;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .btn-add-patient:hover {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
    }

    .patient-records-container {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .patient-records-container h3 {
      margin: 0 0 1rem 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: #374151;
    }

    .table-wrapper {
      overflow-x: auto;
    }

    .patient-records-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }

    .patient-records-table th {
      background: #f9fafb;
      padding: 0.75rem;
      text-align: left;
      font-weight: 600;
      color: #374151;
      border-bottom: 2px solid #e5e7eb;
    }

    .patient-records-table td {
      padding: 0.75rem;
      border-bottom: 1px solid #e5e7eb;
      color: #6b7280;
    }

    .patient-records-table tbody tr:hover {
      background: #f9fafb;
    }

    .patient-records-table td:first-child {
      font-weight: 600;
      color: #374151;
    }

    .lab-types-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 1.5rem;
    }

    .lab-type-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      background: #f9fafb;
    }

    .lab-type-name {
      font-weight: 600;
      color: #374151;
    }

    .btn-delete-lab-type {
      padding: 0.4rem 0.75rem;
      background: white;
      color: #dc2626;
      border: 1px solid #fecaca;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-delete-lab-type:hover {
      background: #fee2e2;
      border-color: #dc2626;
    }

    .add-lab-type-form {
      display: flex;
      gap: 0.5rem;
      padding-top: 1rem;
      border-top: 2px solid #e5e7eb;
    }

    .add-lab-type-form input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
    }

    .add-lab-type-form button {
      padding: 0.75rem 1.5rem;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .add-lab-type-form button:hover {
      background: #059669;
    }

    @media (max-width: 768px) {
      .patient-form-grid {
        grid-template-columns: 1fr;
      }

      .patient-list-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }

      .patient-records-table {
        font-size: 0.75rem;
      }

      .patient-records-table th,
      .patient-records-table td {
        padding: 0.5rem;
      }
    }

    /* === INVENTORY SPECIFIC CSS === */
    /* New Inventory Header */
    .inventory-new-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .inventory-new-header h2 {
      margin: 0;
      font-size: 1.75rem;
      font-weight: 700;
      color: #111827;
      line-height: 1.2;
    }
    
    .current-date-badge {
      background: transparent;
      color: #111827;
      padding: 0;
      font-weight: 400;
      font-size: 1rem;
    }
    
    /* Status Grid - 1x4 on Desktop, 2x2 on Mobile */
    .inventory-status-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    
    .status-box {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      position: relative;
    }
    
    .status-box:hover {
      border-color: #cbd5e1;
    }
    
    .status-box.active {
      background: #475569;
      border-color: #475569;
    }
    
    .status-box.active .status-label,
    .status-box.active .status-count {
      color: white;
    }
    
    .status-box.add {
      background: white;
      border: 1px solid #e5e7eb;
    }
    
    .status-box.add .status-label {
      color: #2563eb;
      margin-bottom: 0.5rem;
    }
    
    .add-icon {
      font-size: 2rem;
      font-weight: 300;
      color: #111827;
    }
    
    .status-label {
      font-size: 0.875rem;
      color: #6b7280;
      font-weight: 400;
      margin-bottom: 0.75rem;
    }
    
    .status-count {
      font-size: 2.5rem;
      font-weight: 300;
      color: #111827;
    }
    
    /* Search Bar */
    .inventory-search-bar {
      margin-bottom: 1rem;
    }
    
    .inventory-search-bar input {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: border-color 0.2s;
    }
    
    .inventory-search-bar input:focus {
      outline: none;
      border-color: #cbd5e1;
    }
    
    /* Navigation - Calendar + Prev/Next */
    .inventory-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .nav-arrows-group {
      display: flex;
      gap: 0.5rem;
      margin-left: auto;
    }
    
    .calendar-picker-group {
      display: flex;
      gap: 0;
      align-items: stretch;
    }
    
    .calendar-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.875rem 1rem;
      border: 1px solid #e5e7eb;
      border-radius: 8px 0 0 8px;
      background: #2563eb;
      color: white;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border-right: none;
    }
    
    .calendar-btn:hover {
      background: #1d4ed8;
    }
    
    .calendar-icon {
      font-size: 1rem;
    }
    
    .visible-date-picker {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 0.875rem 1rem;
      font-size: 0.9rem;
      cursor: pointer;
      background: white;
      transition: all 0.2s;
      min-width: 180px;
    }
    
    .visible-date-picker:hover {
      background: #f9fafb;
      border-color: #cbd5e1;
    }
    
    .visible-date-picker:focus {
      outline: none;
      background: #eff6ff;
      border-color: #2563eb;
    }
    
    .nav-arrow-btn {
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: white;
      font-size: 1.25rem;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 300;
      color: #111827;
    }
    
    .nav-arrow-btn:hover {
      background: #f9fafb;
      border-color: #cbd5e1;
    }
    
    .hidden-date-picker {
      position: fixed;
      top: -9999px;
      left: -9999px;
      opacity: 0;
      width: 1px;
      height: 1px;
      z-index: -1;
      pointer-events: auto;
    }
    
    /* Products Table */
    .inventory-products-table {
      background: white;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      overflow: hidden;
    }
    
    .inventory-products-table table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .inventory-products-table thead {
      background: #f9fafb;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .inventory-products-table th {
      padding: 0.75rem 1rem;
      text-align: left;
      font-size: 0.8rem;
      font-weight: 600;
      color: #111827;
    }
    
    .inventory-products-table td {
      padding: 0.875rem 1rem;
      border-bottom: 1px solid #f3f4f6;
      font-size: 0.875rem;
      color: #111827;
    }
    
    .inventory-products-table tbody tr:hover {
      background: #f9fafb;
    }
    
    /* Category separator - grey spacer row */
    .inventory-products-table tbody tr.category-separator:hover {
      background: transparent;
    }
    
    .inventory-products-table tbody tr:last-child td {
      border-bottom: none;
    }
    
    /* Mobile Responsive - 2x2 Grid */
    @media (max-width: 768px) {
      .inventory-new-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .inventory-new-header h2 {
        font-size: 1.5rem;
      }
      
      /* 2x2 grid on mobile */
      .inventory-status-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .inventory-navigation {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      .calendar-picker-group {
        flex: 1;
        min-width: 200px;
      }
      
      .visible-date-picker {
        min-width: 100px;
        flex: 1;
      }
      
      .nav-arrows-group {
        margin-left: 0;
        flex-shrink: 0;
      }
      
      .nav-arrow-btn {
        width: 45px;
        height: 45px;
      }
      
      /* Optimize table for mobile - smaller text, tighter spacing */
      .inventory-products-table {
        border-radius: 8px;
      }
      
      .inventory-products-table th {
        padding: 0.5rem 0.5rem;
        font-size: 0.7rem;
      }
      
      .inventory-products-table td {
        padding: 0.625rem 0.5rem;
        font-size: 0.75rem;
      }
      
      /* Make columns fit better - 5 columns now */
      .inventory-products-table th:nth-child(1),
      .inventory-products-table td:nth-child(1) {
        width: 15%;
      }
      
      .inventory-products-table th:nth-child(2),
      .inventory-products-table td:nth-child(2) {
        width: 32%;
      }
      
      .inventory-products-table th:nth-child(3),
      .inventory-products-table td:nth-child(3) {
        width: 15%;
        text-align: center;
      }
      
      .inventory-products-table th:nth-child(4),
      .inventory-products-table td:nth-child(4) {
        width: 23%;
        font-size: 0.7rem;
      }
      
      .inventory-products-table th:nth-child(5),
      .inventory-products-table td:nth-child(5) {
        width: 15%;
        text-align: right;
      }
    }
    
    /* Restock Button */
    .restock-button-container {
      margin-top: 2rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .btn-restock,
    .btn-manual-update {
      padding: 1rem 2rem;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .btn-restock {
      background: #2563eb;
    }
    
    .btn-restock:hover {
      background: #1d4ed8;
    }
    
    .btn-manual-update {
      background: #10b981;
    }
    
    .btn-manual-update:hover {
      background: #059669;
    }
    
    /* === RESTOCK PAGE CSS === */
    .restock-page {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .restock-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .btn-back {
      padding: 0.625rem 1rem;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: background 0.2s;
    }
    
    .btn-back:hover {
      background: #e5e7eb;
    }
    
    .restock-header h2 {
      margin: 0;
      font-size: 1.75rem;
      font-weight: 700;
    }
    
    /* Restock Search and Filter */
    .restock-search-filter {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .restock-search-input {
      flex: 2;
      padding: 0.875rem 1rem;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: all 0.2s;
    }
    
    .restock-search-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .restock-category-filter {
      flex: 1;
      padding: 0.875rem 1rem;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9rem;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .restock-category-filter:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    /* Restock Filters */
    .restock-filters {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 2rem;
    }
    
    .restock-filter-btn {
      flex: 1;
      padding: 0.875rem;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .restock-filter-btn:hover {
      border-color: #2563eb;
    }
    
    .restock-filter-btn.active {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
    }
    
    /* Restock Items List */
    .restock-items-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    /* Restock Card */
    .restock-card {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.2s;
      position: relative;
    }
    
    .restock-card.selected {
      border-color: #2563eb;
      background: #eff6ff;
    }
    
    .restock-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #f3f4f6;
    }
    
    .restock-card-title {
      flex: 1;
    }
    
    .restock-product-name {
      font-size: 1rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 0.25rem;
    }
    
    .restock-category-status {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    
    .restock-category {
      font-size: 0.7rem;
      color: #6b7280;
      padding: 0.125rem 0.375rem;
      background: #f3f4f6;
      border-radius: 4px;
    }
    
    .restock-status {
      font-size: 0.7rem;
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
      font-weight: 600;
    }
    
    .restock-status.low {
      background: #fef3c7;
      color: #92400e;
    }
    
    .restock-status.out {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .restock-checkbox-delete {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    
    .restock-checkbox {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    
    .btn-delete-card {
      padding: 0.375rem 0.5rem;
      background: #fee2e2;
      color: #dc2626;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: background 0.2s;
    }
    
    .btn-delete-card:hover {
      background: #fecaca;
    }
    
    /* Restock Card Body - Horizontal 3-column layout */
    .restock-card-body {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 0.75rem;
    }
    
    .restock-field {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    
    .restock-field-label {
      font-size: 0.7rem;
      color: #9ca3af;
      font-weight: 400;
    }
    
    .restock-field-value {
      font-size: 0.875rem;
      color: #111827;
      font-weight: 600;
    }
    
    /* Restock Card Footer - Inputs row */
    .restock-card-footer {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .restock-inputs-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }
    
    .restock-input-group {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 0.25rem;
    }
    
    .restock-input-label {
      font-size: 0.7rem;
      color: #9ca3af;
      font-weight: 400;
    }
    
    .restock-field input,
    .restock-input-group input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      font-size: 0.875rem;
      background: #f9fafb;
    }
    
    .restock-field input:focus,
    .restock-input-group input:focus {
      outline: none;
      border-color: #2563eb;
      background: white;
    }
    
    .btn-add-cost {
      width: 100%;
      padding: 0.625rem;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
    }
    
    .btn-add-cost:hover {
      background: #059669;
    }
    
    /* Bottom Actions */
    .restock-actions {
      position: sticky;
      bottom: 0;
      background: white;
      padding: 1.5rem;
      border-top: 2px solid #e5e7eb;
      display: flex;
      gap: 1rem;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
    }
    
    .btn-delete-selected {
      padding: 1rem 1.5rem;
      background: #dc2626;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.75rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 70px;
      line-height: 1;
    }
    
    .btn-delete-selected:hover {
      background: #b91c1c;
      transform: scale(1.05);
    }
    
    .btn-delete-selected:active {
      transform: scale(0.95);
    }
    
    .btn-update-stocks {
      flex: 1;
      padding: 1rem;
      background: #e5e7eb;
      color: #9ca3af;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: not-allowed;
      transition: all 0.2s;
    }
    
    .btn-update-stocks.active {
      background: #10b981;
      color: white;
      cursor: pointer;
    }
    
    .btn-update-stocks.active:hover {
      background: #059669;
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
      .restock-page {
        padding: 1rem;
      }
      
      /* Make search and filter stack on mobile */
      .restock-search-filter {
        flex-direction: column;
        gap: 0.75rem;
      }
      
      .restock-search-input {
        width: 100%;
        font-size: 0.85rem;
        padding: 0.75rem;
      }
      
      .restock-category-filter {
        width: 100%;
        font-size: 0.85rem;
        padding: 0.75rem;
      }
      
      .restock-card-body {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .restock-inputs-row {
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
      }
      
      .restock-input-label {
        font-size: 0.65rem;
      }
      
      .restock-input-group input {
        font-size: 0.8rem;
        padding: 0.4rem;
      }
      
      .restock-actions {
        padding: 1rem;
      }
      
      .btn-delete-selected {
        min-width: 50px;
      }
    }
    
    /* === MANUAL INVENTORY UPDATE PAGE === */
    .manual-update-page {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .manual-update-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
    }
    
    .manual-update-header h2 {
      margin: 0;
      font-size: 1.75rem;
      font-weight: 700;
    }
    
    .manual-update-date-display {
      background: #eff6ff;
      border: 2px solid #2563eb;
      border-radius: 8px;
      padding: 1rem 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .date-label {
      font-size: 0.9rem;
      color: #1e40af;
      font-weight: 500;
    }
    
    .date-value {
      font-size: 1.1rem;
      color: #1e3a8a;
      font-weight: 700;
    }
    
    .manual-update-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 2rem;
    }
    
    .manual-update-item {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr;
      gap: 1rem;
      align-items: center;
      transition: all 0.2s;
    }
    
    .manual-update-item:hover {
      border-color: #2563eb;
      box-shadow: 0 2px 4px rgba(37, 99, 235, 0.1);
    }
    
    .manual-update-item-info {
      display: flex;
      flex-direction: column;
    }
    
    .manual-update-item-name {
      font-weight: 600;
      color: #111827;
    }
    
    .manual-update-item-category {
      font-size: 0.75rem;
      color: #6b7280;
      padding: 0.25rem 0.5rem;
      background: #f3f4f6;
      border-radius: 4px;
      display: inline-block;
      margin-top: 0.25rem;
      width: fit-content;
    }
    
    .manual-update-field {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    
    .manual-update-field-label {
      font-size: 0.7rem;
      color: #9ca3af;
      text-transform: uppercase;
      font-weight: 500;
    }
    
    .manual-update-field-value {
      font-size: 0.9rem;
      color: #4b5563;
      font-weight: 500;
    }
    
    .manual-update-field input {
      padding: 0.5rem;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .manual-update-field input:focus {
      outline: none;
      border-color: #2563eb;
      background: #eff6ff;
    }
    
    .manual-update-field input[type="number"] {
      width: 100%;
    }
    
    .manual-update-save-container {
      position: sticky;
      bottom: 0;
      background: white;
      padding: 1.5rem;
      border-top: 2px solid #e5e7eb;
      text-align: center;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
    }
    
    .btn-save-manual-updates {
      padding: 1rem 3rem;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      min-width: 250px;
    }
    
    .btn-save-manual-updates:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    
    .btn-save-manual-updates:disabled {
      background: #e5e7eb;
      color: #9ca3af;
      cursor: not-allowed;
      transform: none;
    }
    
    @media (max-width: 768px) {
      .manual-update-page {
        padding: 1rem;
      }
      
      .manual-update-item {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }
      
      .manual-update-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }
    }
    
    /* OLD STYLES (keeping for compatibility) */
    .view-toggle {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .view-toggle button {
      padding: 0.5rem 1rem;
      border: 1px solid #196894;
      background: white;
      color: #196894;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .view-toggle button.active {
      background: #196894;
      color: white;
    }
    
    /* Calendar View */
    .calendar-view {
      background: #fff;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    /* Detailed View */
    .detailed-view {
      display: none;
      background: #fff;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .detailed-view.active {
      display: block;
    }
    
    .detailed-view table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0,0,0,0.06);
    }
    
    .detailed-view th,
    .detailed-view td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .detailed-view th {
      background: #f9fafb;
      font-weight: 600;
      color: #374151;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .detailed-view td {
      font-size: 0.9rem;
      color: #111827;
    }
    
    .detailed-view tbody tr:hover {
      background: #f9fafb;
    }
    
    .detailed-view .status-badge {
      display: inline-block;
      padding: 0.25rem 0.625rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .detailed-view .status-badge.available {
      background: #d1fae5;
      color: #065f46;
    }
    
    .detailed-view .status-badge.low {
      background: #fef3c7;
      color: #92400e;
    }
    
    .detailed-view .status-badge.out {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .detailed-view .status-badge.expiring {
      background: #ddd6fe;
      color: #5b21b6;
    }
    
    .detailed-view .category-tag {
      display: inline-block;
      background: #eff6ff;
      color: #1e40af;
      padding: 0.25rem 0.625rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .detailed-view-hint {
      display: none;
    }
    
    .calendar-hint {
      text-align: center;
      font-size: 0.8rem;
      color: #6b7280;
      padding: 0.5rem;
      background: #f9fafb;
      border-radius: 8px;
      margin-bottom: 0.75rem;
      display: none;
    }
    
    .calendar-header {
      text-align: center;
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #111827;
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
    }
    
    .calendar-day-header {
      text-align: center;
      font-weight: 600;
      padding: 0.5rem;
      background: #f3f4f6;
      border-radius: 6px;
      font-size: 0.85rem;
    }
    
    .calendar-day {
      min-height: 80px;
      padding: 0.5rem;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .calendar-day:hover {
      background: #f9fafb;
      border-color: #196894;
    }
    
    .calendar-day.selected {
      background: #dbeafe;
      border-color: #196894;
    }
    
    .calendar-day.pressing {
      background: #bfdbfe;
      transform: scale(0.95);
      transition: all 0.1s;
    }
    
    .calendar-day.other-month {
      opacity: 0.3;
    }
    
    .day-number {
      font-weight: 600;
      margin-bottom: 0.25rem;
      font-size: 0.9rem;
    }
    
    .day-items {
      font-size: 0.75rem;
      color: #6b7280;
    }
    
    .day-badge {
      display: inline-block;
      background: #196894;
      color: white;
      padding: 0.1rem 0.4rem;
      border-radius: 4px;
      font-size: 0.7rem;
      margin-top: 0.25rem;
    }
    
    /* List View */
    .list-view {
      display: none;
    }
    
    .list-view.active {
      display: block;
    }
    
    /* Date Header for List View */
    .list-date-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      padding: 1.25rem 1.5rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    }
    
    .current-date-display {
      flex: 1;
      text-align: center;
      color: white;
      position: relative;
    }
    
    .date-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.9;
      margin-bottom: 0.25rem;
    }
    
    .date-value {
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    
    .date-nav-btn {
      padding: 0.75rem 1.25rem;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.2s;
      white-space: nowrap;
    }
    
    .date-nav-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
    }
    
    .date-nav-btn:active {
      transform: translateY(0);
    }
    
    .date-nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-text-short {
      display: none;
    }
    
    .btn-text-full {
      display: inline;
    }
    
    /* Category Section */
    .category-section {
      margin-bottom: 2rem;
    }
    
    .category-title {
      background: linear-gradient(135deg, #196894 0%, #155a7a 100%);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 12px 12px 0 0;
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .category-count {
      background: rgba(255,255,255,0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    
    .category-items {
      background: white;
      border-radius: 0 0 12px 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .inventory-card {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid #e5e7eb;
      transition: background 0.2s;
      display: grid;
      grid-template-columns: 2fr 2fr 1fr 1fr;
      gap: 1rem;
      align-items: center;
    }
    
    .inventory-card:last-child {
      border-bottom: none;
    }
    
    .inventory-card:hover {
      background: #f9fafb;
    }
    
    .card-field {
      display: flex;
      flex-direction: column;
    }
    
    .card-label {
      font-size: 0.75rem;
      color: #6b7280;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 0.25rem;
      letter-spacing: 0.5px;
    }
    
    .card-value {
      font-size: 0.95rem;
      color: #1f2937;
      font-weight: 500;
    }
    
    .card-value.product-name {
      font-weight: 600;
      color: #111827;
    }
    
    .status-badge {
      display: inline-block;
      padding: 0.4rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      text-align: center;
    }
    
    .status-available {
      background: #d1fae5;
      color: #065f46;
    }
    
    .status-low {
      background: #fef3c7;
      color: #92400e;
    }
    
    .status-out {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: #9ca3af;
    }
    
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    
    /* Old table styles - keeping for fallback */
    .inventory-table-wrapper {
      overflow-x: auto;
      display: none;
    }
    
    .inventory-table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .inventory-table th,
    .inventory-table td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }
    
    .inventory-table th {
      background: #f3f4f6;
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .inventory-table td {
      font-size: 0.9rem;
    }
    
    .category-header {
      background: #196894 !important;
      color: white !important;
      font-weight: 700;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 1rem !important;
    }
    
    .category-row td {
      border-bottom: 2px solid #196894;
    }
    
    .status-low {
      color: #f59e0b;
      font-weight: 600;
    }
    
    .status-out {
      color: #ef4444;
      font-weight: 600;
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .modal-header h2 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: #111827;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #9ca3af;
      line-height: 1;
      transition: color 0.2s;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-close:hover {
      color: #374151;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.3rem;
      font-weight: 600;
      font-size: 0.9rem;
      color: #374151;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    
    .form-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      margin-top: 1.5rem;
    }
    
    .btn-cancel {
      padding: 0.625rem 1.25rem;
      border: 1px solid #d1d5db;
      background: white;
      color: #6b7280;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .btn-cancel:hover {
      background: #f9fafb;
      border-color: #9ca3af;
      color: #374151;
    }
    
    .btn-submit {
      padding: 0.625rem 1.25rem;
      border: none;
      background: #10b981;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .btn-submit:hover {
      background: #059669;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }
    
    /* Category Management */
    .category-list {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 1rem;
    }
    
    .category-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      background: #f9fafb;
    }
    
    .category-name-input {
      flex: 1;
      border: 1px solid #d1d5db;
      background: white;
      font-size: 0.9rem;
      font-weight: 600;
      padding: 0.5rem;
      border-radius: 4px;
    }
    
    .category-name-input:focus {
      outline: none;
      border-color: #2563eb;
    }
    
    .category-item input {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 0.9rem;
      font-weight: 600;
    }
    
    .category-item input:disabled {
      color: #374151;
    }
    
    .category-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .btn-save-category,
    .btn-delete-category {
      padding: 0.4rem 0.75rem;
      border: 1px solid #d1d5db;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s;
    }
    
    .btn-save-category {
      background: #10b981;
      color: white;
      border-color: #10b981;
    }
    
    .btn-save-category:hover {
      background: #059669;
    }
    
    .btn-delete-category:hover {
      background: #fee2e2;
      color: #dc2626;
      border-color: #fecaca;
    }
    
    .category-item-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .btn-icon {
      padding: 0.4rem 0.6rem;
      border: 1px solid #d1d5db;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s;
    }
    
    .btn-icon:hover {
      background: #f3f4f6;
    }
    
    .btn-icon.delete {
      color: #dc2626;
    }
    
    .btn-icon.delete:hover {
      background: #fee2e2;
    }
    
    .add-category-form {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #e5e7eb;
    }
    
    .add-category-form input {
      flex: 1;
      padding: 0.6rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
    }
    
    .add-category-form button {
      padding: 0.6rem 1rem;
      border: none;
      background: #10b981;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .add-category-form button:hover {
      background: #059669;
    }
    
    /* Category Bottom Actions - Input, Save, Add in one line */
    .category-bottom-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 2px solid #e5e7eb;
    }
    
    .category-bottom-actions input {
      flex: 1;
      padding: 0.625rem 0.875rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    
    .category-bottom-actions input:focus {
      outline: none;
      border-color: #2563eb;
    }
    
    .btn-save-all {
      padding: 0.625rem 1.25rem;
      border: none;
      background: #2563eb;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      white-space: nowrap;
      transition: all 0.3s ease;
    }
    
    .btn-save-all:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
    }
    
    .btn-save-all:disabled {
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-add-category {
      padding: 0.625rem 1.25rem;
      border: none;
      background: #10b981;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      white-space: nowrap;
      transition: background 0.2s;
    }
    
    .btn-add-category:hover {
      background: #059669;
    }
    
    /* Stock Detail Modal */
    .stock-detail-category {
      margin-bottom: 1.5rem;
    }
    
    .stock-category-header {
      background: #f9fafb;
      color: #374151;
      padding: 0.625rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
      border-left: 3px solid #196894;
    }
    
    .stock-item {
      padding: 1rem;
      background: white;
      border-radius: 8px;
      margin-bottom: 0.625rem;
      border: 1px solid #e5e7eb;
      transition: all 0.2s;
    }
    
    .stock-item:hover {
      border-color: #d1d5db;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .stock-item-name {
      font-weight: 600;
      color: #111827;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }
    
    .stock-item-details {
      font-size: 0.85rem;
      color: #6b7280;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 0.5rem;
    }
    
    .stock-item-detail {
      display: flex;
      gap: 0.5rem;
    }
    
    .stock-item-detail strong {
      color: #9ca3af;
      font-weight: 500;
      font-size: 0.8rem;
    }
    
    .stock-item-detail span {
      color: #374151;
      font-weight: 500;
    }
    
    .stock-summary {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1.5rem;
      font-size: 0.9rem;
      border: 1px solid #e5e7eb;
    }
    
    .stock-summary-title {
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: #374151;
      font-size: 0.95rem;
    }
    
    .stock-summary > div:not(.stock-summary-title) {
      padding: 0.375rem 0;
      color: #6b7280;
      display: flex;
      justify-content: space-between;
      border-top: 1px solid #f3f4f6;
    }
    
    .stock-summary > div:first-of-type {
      border-top: none;
    }

    @media (min-width: 768px) {
      .app { flex-direction: row; }
      .charts { flex-direction: row; }
      .chart-card { flex: 1; }
      #navToggle { display: none; }
    }

    /* Mobile Responsive */
    @media (max-width: 767px) {
      .app { flex-direction: column; }
      
      .sidebar { 
        width: 100%; 
        padding: 0;
        position: relative;
        height: auto;
      }
      
      .sidebar-header {
        padding: 0.75rem 1rem;
        border: none;
      }
      
      .sidebar-header h2 { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        cursor: pointer;
        font-size: 1.25rem;
        margin: 0;
      }
      
      .sidebar nav { 
        display: none; 
        flex-direction: column; 
        gap: 0.25rem; 
        margin-top: 0;
        padding: 0.75rem 1rem;
        flex: none;
      }
      
      .sidebar nav a { 
        padding: 0.625rem 1rem; 
        margin: 0; 
        font-size: 0.875rem; 
      }
      
      .sidebar.open nav { display: flex; }
      
      .user-profile {
        border-top: none;
      }
      
      .user-profile-header {
        padding: 0.875rem 1rem;
      }
      
      .user-avatar {
        width: 36px;
        height: 36px;
        font-size: 0.85rem;
      }
      
      .user-name {
        font-size: 0.85rem;
      }
      
      .user-role {
        font-size: 0.7rem;
      }
      
      .dropdown-item {
        padding: 0.625rem 0.75rem;
      }
      
      .role-name {
        font-size: 0.85rem;
      }
      
      .role-desc {
        font-size: 0.65rem;
      }
      
      .main {
        margin-left: 0;
        padding: 1rem;
      }
      
      /* Dashboard Mobile */
      .cards {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
      }
      
      .card {
        padding: 0.875rem;
      }
      
      .card h3 {
        font-size: 0.75rem;
      }
      
      .card .value {
        font-size: 1.1rem;
      }
      
      .dashboard-date {
        font-size: 0.75rem;
        padding: 0.4rem 0.75rem;
      }
      
      .header-top {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
      
      header h1 {
        font-size: 1.3rem;
      }
      
      header p {
        font-size: 0.85rem;
      }
      
      /* Overview Cards Mobile */
      .inventory-overview {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
      }
      
      .overview-card {
        padding: 0.875rem;
      }
      
      .overview-value {
        font-size: 1.1rem;
      }
      
      .overview-label {
        font-size: 0.75rem;
      }
      
      .section-header {
        flex-direction: column;
        align-items: stretch;
        gap: 0.75rem;
      }
      
      .section-title {
        font-size: 0.875rem;
      }
      
      .period-selector {
        width: 100%;
      }
      
      .period-btn {
        flex: 1;
        font-size: 0.8rem;
        padding: 0.5rem 0.5rem;
      }
      
      /* Transactions & Alerts Mobile */
      .transactions, .alerts {
        margin-bottom: 2rem;
      }
      
      /* Make tables fit mobile without horizontal scroll */
      .transactions table, .alerts table {
        font-size: 0.75rem;
        display: table;
        width: 100%;
      }
      
      .transactions th, .transactions td, .alerts th, .alerts td {
        padding: 0.5rem 0.25rem;
        font-size: 0.75rem;
      }
      
      /* Make date column narrower */
      .transactions td.date, .alerts td.date {
        font-size: 0.7rem;
        width: 60px;
        max-width: 60px;
      }
      
      /* Allow text to wrap in description/invoice columns */
      .transactions td:nth-child(2), .alerts td:nth-child(1) {
        word-break: break-word;
        max-width: 120px;
      }
      
      /* Make amount/status columns compact */
      .transactions td:nth-child(3), .transactions td:nth-child(4),
      .alerts td:nth-child(3) {
        font-size: 0.7rem;
        white-space: nowrap;
      }
      
      /* Detailed View Table Mobile */
      .detailed-view {
        padding: 0.5rem;
      }
      
      .detailed-view table {
        font-size: 0.7rem;
        table-layout: fixed;
        width: 100%;
      }
      
      .detailed-view th {
        padding: 0.5rem 0.25rem;
        font-size: 0.65rem;
        font-weight: 600;
        white-space: nowrap;
      }
      
      /* Show abbreviated headers on mobile */
      .detailed-view th > div {
        display: none;
      }
      
      .detailed-view th::before {
        content: attr(data-short);
      }
      
      .detailed-view td {
        padding: 0.5rem 0.25rem;
        font-size: 0.7rem;
        word-break: break-word;
        overflow-wrap: break-word;
      }
      
      /* Adjust column widths for mobile */
      .detailed-view th:nth-child(1),
      .detailed-view td:nth-child(1) {
        width: 15%;
      }
      
      .detailed-view th:nth-child(2),
      .detailed-view td:nth-child(2) {
        width: 25%;
      }
      
      .detailed-view th:nth-child(3),
      .detailed-view td:nth-child(3) {
        width: 15%;
      }
      
      .detailed-view th:nth-child(4),
      .detailed-view td:nth-child(4) {
        width: 18%;
      }
      
      .detailed-view th:nth-child(5),
      .detailed-view td:nth-child(5) {
        width: 12%;
        text-align: center;
      }
      
      .detailed-view th:nth-child(6),
      .detailed-view td:nth-child(6) {
        width: 15%;
      }
      
      .detailed-view .category-tag {
        font-size: 0.65rem;
        padding: 0.15rem 0.3rem;
        display: block;
        text-align: center;
      }
      
      .detailed-view .status-badge {
        font-size: 0.65rem;
        padding: 0.15rem 0.3rem;
        display: block;
        text-align: center;
      }
      
      /* Inventory Mobile Adjustments */
      .inventory-header {
        flex-direction: column;
        align-items: stretch;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }
      
      .inventory-header h2 {
        font-size: 1.25rem;
        margin-bottom: 0;
      }
      
      .inventory-controls {
        flex-direction: column;
        gap: 0.625rem;
      }
      
      .date-controls {
        display: grid;
        grid-template-columns: 1fr 1fr auto;
        gap: 0.5rem;
        width: 100%;
      }
      
      .date-controls select,
      .date-controls input {
        width: 100%;
        font-size: 0.85rem;
        padding: 0.5rem 0.4rem;
      }
      
      .date-controls button {
        padding: 0.5rem 0.75rem;
        font-size: 0.85rem;
      }
      
      .search-add-controls {
        display: flex;
        gap: 0.5rem;
        width: 100%;
      }
      
      .search-add-controls input {
        flex: 1;
        font-size: 0.85rem;
        padding: 0.5rem;
      }
      
      .search-add-controls button {
        flex-shrink: 0;
        padding: 0.5rem 0.875rem;
        font-size: 0.85rem;
      }
      
      .view-toggle {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }
      
      .view-toggle button {
        width: 100%;
        padding: 0.625rem;
        font-size: 0.875rem;
      }
      
      /* Calendar Mobile */
      .calendar-view {
        padding: 0.75rem;
      }
      
      .calendar-hint {
        display: block;
        font-size: 0.7rem;
        padding: 0.5rem;
        margin-bottom: 0.5rem;
      }
      
      .calendar-header {
        font-size: 1rem;
        margin-bottom: 0.75rem;
      }
      
      .calendar-grid {
        gap: 0.25rem;
      }
      
      .calendar-day {
        min-height: 50px;
        padding: 0.25rem;
      }
      
      .calendar-day-header {
        padding: 0.375rem 0.25rem;
        font-size: 0.7rem;
      }
      
      .day-number {
        font-size: 0.8rem;
      }
      
      .day-items {
        font-size: 0.65rem;
      }
      
      .day-badge {
        font-size: 0.65rem;
        padding: 0.1rem 0.3rem;
      }
      
      /* Date Header Mobile */
      .list-date-header {
        padding: 0.75rem;
        gap: 0.5rem;
        margin-bottom: 1rem;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
      
      .current-date-display {
        flex: 1;
        text-align: center;
      }
      
      .date-label {
        display: none;
      }
      
      .date-value {
        font-size: 0.875rem;
        font-weight: 600;
        line-height: 1.2;
      }
      
      .date-nav-btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.85rem;
        min-width: auto;
        flex-shrink: 0;
      }
      
      .date-nav-btn:first-of-type {
        order: 0;
      }
      
      .date-nav-btn:last-of-type {
        order: 2;
      }
      
      .current-date-display {
        order: 1;
      }
      
      .btn-text-full {
        display: none;
      }
      
      .btn-text-short {
        display: inline;
        font-size: 1.25rem;
        font-weight: 700;
      }
      
      /* Card Layout Mobile */
      .inventory-card {
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem 0.75rem;
        padding: 0.75rem 0.875rem;
      }
      
      .card-field {
        padding-bottom: 0;
      }
      
      .card-label {
        font-size: 0.65rem;
        margin-bottom: 0.15rem;
      }
      
      .card-value {
        font-size: 0.8rem;
      }
      
      .card-value.product-name {
        font-size: 0.85rem;
      }
      
      .status-badge {
        padding: 0.25rem 0.5rem;
        font-size: 0.7rem;
      }
      
      .category-title {
        font-size: 0.875rem;
        padding: 0.625rem 0.875rem;
      }
      
      .category-count {
        font-size: 0.75rem;
        padding: 0.15rem 0.5rem;
      }
      
      .category-section {
        margin-bottom: 1rem;
      }
      
      .empty-state {
        padding: 2rem 1rem;
      }
      
      .empty-state-icon {
        font-size: 2.5rem;
      }
      
      .empty-state h3 {
        font-size: 1rem;
      }
      
      .empty-state p {
        font-size: 0.875rem;
      }
      
      /* Modal Mobile */
      .modal-content {
        padding: 1rem;
        width: 95%;
        max-height: 85vh;
      }
      
      .modal-header h2 {
        font-size: 1.1rem;
      }
      
      .form-group {
        margin-bottom: 0.875rem;
      }
      
      .form-group label {
        font-size: 0.85rem;
        margin-bottom: 0.25rem;
      }
      
      .form-group input,
      .form-group select {
        padding: 0.5rem;
        font-size: 0.875rem;
      }
      
      .form-actions button {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }
      
      .category-item {
        padding: 0.625rem;
      }
      
      .category-item input {
        font-size: 0.85rem;
      }
      
      .btn-icon {
        padding: 0.35rem 0.5rem;
        font-size: 0.8rem;
      }
      
      .add-category-form input {
        padding: 0.5rem;
        font-size: 0.875rem;
      }
      
      .add-category-form button {
        padding: 0.5rem 0.875rem;
        font-size: 0.875rem;
      }
    }
    
    @media (min-width: 768px) and (max-width: 1024px) {
      .inventory-card {
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }
    }

    /* === SALES PAGE STYLES === */
.sales-page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.sales-page-header h2 {
  margin: 0;
  font-size: 1.75rem;
  font-weight: 700;
  color: #111827;
}

.sales-period-selector {
  display: flex;
  gap: 0.5rem;
  background: #f3f4f6;
  padding: 0.25rem;
  border-radius: 8px;
}

.sales-period-btn {
  padding: 0.5rem 1rem;
  border: none;
  background: transparent;
  color: #6b7280;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 500;
  transition: all 0.2s;
}

.sales-period-btn:hover {
  color: #374151;
  background: rgba(255, 255, 255, 0.5);
}

.sales-period-btn.active {
  background: white;
  color: #2563eb;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.sales-summary-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.sales-summary-card {
  background: white;
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  border-left: 4px solid #2563eb;
}

.sales-summary-card.revenue {
  border-left-color: #10b981;
}

.sales-summary-card.transactions {
  border-left-color: #f59e0b;
}

.sales-summary-card.items {
  border-left-color: #8b5cf6;
}

.sales-summary-card.average {
  border-left-color: #ec4899;
}

.sales-summary-label {
  font-size: 0.85rem;
  color: #6b7280;
  text-transform: uppercase;
  font-weight: 600;
  margin-bottom: 0.5rem;
  letter-spacing: 0.5px;
}

.sales-summary-value {
  font-size: 1.75rem;
  font-weight: 700;
  color: #111827;
}

.sales-search-export {
  display: flex;
  gap: 1rem;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
}

.sales-search-input {
  flex: 1;
  min-width: 250px;
  padding: 0.75rem 1rem;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  font-size: 0.9rem;
}

.sales-search-input:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.btn-export-sales {
  padding: 0.75rem 1.5rem;
  background: #10b981;
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.btn-export-sales:hover {
  background: #059669;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
}

.sales-table-container {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.sales-table {
  width: 100%;
  border-collapse: collapse;
}

.sales-table thead {
  background: #f9fafb;
  border-bottom: 2px solid #e5e7eb;
}

.sales-table th {
  padding: 1rem;
  text-align: left;
  font-size: 0.85rem;
  font-weight: 600;
  color: #374151;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.sales-table td {
  padding: 1rem;
  border-bottom: 1px solid #f3f4f6;
  font-size: 0.9rem;
  color: #111827;
}

.sales-table tbody tr:hover {
  background: #f9fafb;
}

.sales-table tbody tr:last-child td {
  border-bottom: none;
}

.sales-date {
  font-weight: 500;
  color: #6b7280;
}

.sales-patient {
  font-weight: 600;
  color: #111827;
}

.sales-nurse {
  color: #6b7280;
}

.sales-items-list {
  font-size: 0.85rem;
  color: #6b7280;
}

.sales-items-breakdown {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.sales-item-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem;
  background: #f9fafb;
  border-radius: 6px;
  font-size: 0.85rem;
}

.sales-item-name {
  font-weight: 600;
  color: #111827;
  flex: 1;
}

.sales-item-calculation {
  color: #6b7280;
  font-size: 0.8rem;
  margin-right: 1rem;
}

.sales-item-subtotal {
  font-weight: 600;
  color: #2563eb;
  min-width: 80px;
  text-align: right;
}

.sales-breakdown-total {
  display: flex;
  justify-content: space-between;
  padding: 0.75rem 0.5rem;
  border-top: 2px solid #e5e7eb;
  margin-top: 0.5rem;
  font-weight: 700;
}

.sales-breakdown-total-label {
  color: #374151;
}

.sales-breakdown-total-value {
  color: #10b981;
  font-size: 1.1rem;
}

.sales-total {
  font-weight: 700;
  color: #10b981;
  font-size: 1rem;
}

.sales-empty-state {
  text-align: center;
  padding: 4rem 2rem;
  color: #9ca3af;
}

.sales-empty-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}


.sales-item-toggle {
  cursor: pointer;
  user-select: none;
}

.sales-item-toggle::before {
  content: ' ';
  display: inline-block;
  transition: transform 0.2s;
  font-size: 0.7rem;
  margin-right: 0.25rem;
}

.sales-item-toggle.collapsed::before {
  content: ' ';
}

.sales-items-breakdown.collapsed {
  display: none;
}

.sales-items-summary {
  font-size: 0.85rem;
  color: #6b7280;
  font-style: italic;
}

/* Category breakdown */
.category-breakdown {
  margin-top: 2rem;
  background: white;
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.category-breakdown h3 {
  margin: 0 0 1rem 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: #374151;
}

.category-breakdown-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.category-breakdown-item {
  padding: 1rem;
  background: #f9fafb;
  border-radius: 8px;
  border-left: 3px solid #2563eb;
}

.category-breakdown-name {
  font-size: 0.85rem;
  color: #6b7280;
  margin-bottom: 0.5rem;
}

.category-breakdown-value {
  font-size: 1.25rem;
  font-weight: 600;
  color: #111827;
}

/* Mobile Responsive */
/* Mobile Responsive */
@media (max-width: 768px) {
  .sales-page-header {
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
  }
  
  .sales-page-header h2 {
    font-size: 1.5rem;
  }
  
  .sales-period-selector {
    width: 100%;
    justify-content: stretch;
  }
  
  .sales-period-btn {
    flex: 1;
    padding: 0.625rem 0.5rem;
    font-size: 0.85rem;
  }
  
  .sales-summary-cards {
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }
  
  .sales-summary-card {
    padding: 1rem;
  }
  
  .sales-summary-label {
    font-size: 0.75rem;
  }
  
  .sales-summary-value {
    font-size: 1.3rem;
  }
  
  .sales-search-export {
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .sales-search-input {
    width: 100%;
    min-width: 100%;
    font-size: 0.9rem;
    padding: 0.625rem 0.875rem;
  }
  
  .btn-export-sales {
    width: 100%;
    padding: 0.75rem;
  }
  
  /* Mobile-optimized table - card layout */
  .sales-table-container {
    background: transparent;
    box-shadow: none;
    overflow: visible;
  }
  
  .sales-table {
    display: block;
    width: 100%;
  }
  
  .sales-table thead {
    display: none;
  }
  
  .sales-table tbody {
    display: block;
    width: 100%;
  }
  
  .sales-table tr {
    display: block;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    margin-bottom: 1rem;
    padding: 1rem;
    border: 1px solid #e5e7eb;
  }
  
  .sales-table td {
    display: block;
    text-align: left;
    padding: 0.5rem 0;
    border: none;
    font-size: 0.9rem;
  }
  
  .sales-table td::before {
    content: attr(data-label);
    display: block;
    font-weight: 600;
    color: #6b7280;
    font-size: 0.75rem;
    text-transform: uppercase;
    margin-bottom: 0.25rem;
    letter-spacing: 0.5px;
  }
  
  .sales-date {
    font-size: 0.9rem !important;
    padding-bottom: 0.75rem !important;
    border-bottom: 1px solid #f3f4f6;
    margin-bottom: 0.5rem !important;
  }
  
  .sales-date::before {
    content: ' Date & Time';
  }
  
  .sales-patient {
    font-size: 1rem !important;
    color: #111827 !important;
  }
  
  .sales-patient::before {
    content: ' Patient';
  }
  
  .sales-nurse {
    font-size: 0.85rem !important;
  }
  
  .sales-nurse::before {
    content: ' Nurse';
  }
  
  .sales-table td:nth-child(4)::before {
    content: ' Items Breakdown';
    margin-bottom: 0.5rem;
  }
  
  .sales-total {
    font-size: 1.25rem !important;
    padding-top: 0.75rem !important;
    border-top: 2px solid #e5e7eb;
    margin-top: 0.5rem !important;
  }
  
  .sales-total::before {
    content: ' Transaction Total';
  }
  
  /* Items breakdown mobile */
  .sales-items-breakdown {
    gap: 0.5rem;
    margin-top: 0.5rem;
  }
  
  .sales-item-row {
    flex-direction: column;
    align-items: stretch;
    gap: 0.25rem;
    padding: 0.75rem;
    background: #f3f4f6;
  }
  
  .sales-item-name {
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
  }
  
  .sales-item-calculation {
    margin: 0;
    font-size: 0.8rem;
    color: #6b7280;
  }
  
  .sales-item-subtotal {
    margin: 0;
    text-align: left;
    font-size: 0.95rem;
    color: #2563eb;
    margin-top: 0.25rem;
  }
  
  .sales-breakdown-total {
    padding: 0.75rem;
    margin-top: 0.5rem;
    background: #eff6ff;
    border-radius: 6px;
    border-top: none;
  }
  
  .sales-breakdown-total-label {
    font-size: 0.85rem;
  }
  
  .sales-breakdown-total-value {
    font-size: 1.1rem;
  }
  
  /* Category breakdown mobile */
  .category-breakdown {
    padding: 1rem;
  }
  
  .category-breakdown h3 {
    font-size: 1rem;
  }
  
  .category-breakdown-grid {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }
  
  .category-breakdown-item {
    padding: 0.875rem;
  }
  
  .category-breakdown-name {
    font-size: 0.8rem;
  }
  
  .category-breakdown-value {
    font-size: 1.15rem;
  }
  
  /* Empty state mobile */
  .sales-empty-state {
    padding: 3rem 1rem;
  }
  
  .sales-empty-icon {
    font-size: 3rem;
  }
  
  .sales-empty-state h3 {
    font-size: 1.1rem;
  }
  
  .sales-empty-state p {
    font-size: 0.9rem;
  }
}

/* Very small mobile devices */
@media (max-width: 375px) {
  .sales-summary-cards {
    gap: 0.5rem;
  }
  
  .sales-summary-card {
    padding: 0.75rem;
  }
  
  .sales-summary-label {
    font-size: 0.7rem;
  }
  
  .sales-summary-value {
    font-size: 1.1rem;
  }
  
  .sales-period-btn {
    font-size: 0.8rem;
    padding: 0.5rem 0.375rem;
  }
  
  .sales-item-row {
    padding: 0.625rem;
  }
  
  .sales-table tr {
    padding: 0.875rem;
  }
}

    /* === JOURNALS PAGE STYLES - MOBILE-FIRST RESPONSIVE === */
    #journals {
      padding: 0;
      height: 100%;
    }

    .journal-responsive-layout {
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-height: 100vh;
      background: #f4f6f8;
    }

    /* Header - Fixed at top */
    .journal-header-compact {
      background: white;
      padding: 0.75rem 1rem;
      border-bottom: 2px solid #e5e7eb;
      flex-shrink: 0;
    }

    .journal-nurse-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      font-size: 0.85rem;
    }

    .journal-nurse-info span:first-child {
      font-weight: 600;
      color: #111827;
    }

    .journal-nurse-info span:last-child {
      color: #6b7280;
    }

    .journal-patient-input-inline {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9rem;
    }

    .journal-patient-input-inline:focus {
      outline: none;
      border-color: #3b82f6;
    }

    /* Current Items - Collapsible */
    .journal-current-items-compact {
      background: white;
      border-bottom: 2px solid #e5e7eb;
      padding: 0.75rem 1rem;
      flex-shrink: 0;
      max-height: 200px;
      overflow-y: auto;
    }

    .journal-empty-inline {
      color: #9ca3af;
      font-size: 0.85rem;
      text-align: center;
      padding: 0.5rem;
    }

    .journal-item-compact {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      background: #f9fafb;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      font-size: 0.85rem;
    }

    .journal-item-left {
      flex: 1;
    }

    .journal-item-name {
      font-weight: 600;
      color: #111827;
    }

    .journal-item-details {
      color: #6b7280;
      font-size: 0.75rem;
    }

    .journal-item-total {
      font-weight: 600;
      color: #111827;
    }

    /* Scrollable Selection Area */
    .journal-selection-scrollable {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      background: white;
    }

    .journal-selection-title-small {
      font-size: 0.85rem;
      font-weight: 600;
      color: #374151;
      margin-bottom: 0.75rem;
      text-align: center;
    }

    .journal-grid-scrollable {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }

    .journal-grid-btn {
      padding: 0.75rem 0.5rem;
      background: #f3f4f6;
      border: 2px solid transparent;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.8rem;
      font-weight: 500;
      color: #374151;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      min-height: 75px;
    }

    .journal-grid-btn:active {
      transform: scale(0.95);
    }

    .journal-grid-btn.selected {
      background: #3b82f6;
      color: white;
      border-color: #2563eb;
    }

    .journal-grid-icon {
      font-size: 1.5rem;
      line-height: 1;
    }

    .journal-product-name {
      font-size: 0.75rem;
      line-height: 1.2;
    }

    .journal-product-price {
      font-size: 0.7rem;
      color: #6b7280;
      margin-top: auto;
    }

    .journal-grid-btn.selected .journal-product-price {
      color: rgba(255,255,255,0.9);
    }

    .journal-back-to-category {
      grid-column: 1 / -1;
      padding: 0.65rem;
      background: #6b7280;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .journal-back-to-category:active {
      background: #4b5563;
    }

    /* Fixed Bottom Controls */
    .journal-fixed-bottom {
      background: white;
      border-top: 2px solid #e5e7eb;
      padding: 0.75rem 1rem;
      flex-shrink: 0;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }

    .journal-qty-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    .journal-qty-btn-small {
      width: 55px;
      height: 55px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .journal-qty-btn-small:active {
      transform: scale(0.95);
      background: #2563eb;
    }

    .journal-qty-btn-small:disabled {
      background: #d1d5db;
      cursor: not-allowed;
    }

    .journal-qty-num {
      font-size: 2rem;
      font-weight: 700;
      color: #111827;
      min-width: 60px;
      text-align: center;
    }

    .journal-action-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }

    .journal-btn-small {
      padding: 0.75rem;
      border: none;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .journal-btn-small:active {
      transform: scale(0.97);
    }

    .journal-btn-small.journal-add-btn {
      background: #10b981;
      color: white;
    }

    .journal-btn-small.journal-add-btn:active {
      background: #059669;
    }

    .journal-btn-small.journal-add-btn:disabled {
      background: #d1d5db;
      cursor: not-allowed;
    }

    .journal-btn-small.journal-ok-btn {
      background: #3b82f6;
      color: white;
    }

    .journal-btn-small.journal-ok-btn:active {
      background: #2563eb;
    }

    .journal-btn-small.journal-ok-btn:disabled {
      background: #d1d5db;
      cursor: not-allowed;
    }

    .journal-btn-small.journal-recent-btn {
      background: #6b7280;
      color: white;
    }

    .journal-btn-small.journal-recent-btn:active {
      background: #4b5563;
    }

    .journal-hidden {
      display: none !important;
    }

    /* Success Animation */
    @keyframes journalSuccessPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .journal-success-animation {
      animation: journalSuccessPulse 0.3s ease-in-out;
    }

    /* Tablet/Desktop responsive */
    @media (min-width: 768px) {
      .journal-responsive-layout {
        max-width: 800px;
        margin: 0 auto;
        height: calc(100vh - 2rem);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      }

      .journal-grid-scrollable {
        grid-template-columns: repeat(4, 1fr);
      }

      .journal-header-compact {
        padding: 1rem 1.5rem;
      }

      .journal-selection-scrollable {
        padding: 1.5rem;
      }

      .journal-fixed-bottom {
        padding: 1rem 1.5rem;
      }

      .journal-qty-btn-small {
        width: 60px;
        height: 60px;
      }
    }

    @media (min-width: 1024px) {
      .journal-grid-scrollable {
        grid-template-columns: repeat(5, 1fr);
      }
    }


    /* Tablet Responsive */
@media (min-width: 769px) and (max-width: 1024px) {
  .sales-summary-cards {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .sales-table {
    font-size: 0.85rem;
  }
  
  .sales-table th,
  .sales-table td {
    padding: 0.875rem 0.75rem;
  }
  
  .sales-item-row {
    font-size: 0.85rem;
  }
  
  .sales-item-calculation {
    font-size: 0.8rem;
  }
  
  .category-breakdown-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

    /* === LEAVE MANAGEMENT SYSTEM CSS === */
    .leave-dashboard {
      padding: 2rem;
      max-width: 100%;
      margin: 0;
      width: 100%;
    }

    .leave-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .leave-header h2 {
      margin: 0;
      font-size: 1.75rem;
      font-weight: 700;
      color: #111827;
    }

    .btn-apply-leave {
      padding: 0.75rem 1.5rem;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-apply-leave:hover {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
    }

    /* Leave Statistics Cards */
    .leave-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .leave-stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .leave-stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }

    .stat-icon {
      font-size: 2.5rem;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
    }

    .pending-card .stat-icon {
      background: #fef3c7;
    }

    .active-card .stat-icon {
      background: #dbeafe;
    }

    .approved-card .stat-icon {
      background: #d1fae5;
    }

    .rejected-card .stat-icon {
      background: #fee2e2;
    }

    .stat-content {
      flex: 1;
    }

    .stat-label {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #111827;
    }

    /* Leave Tabs */
    .leave-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid #e5e7eb;
      overflow-x: auto;
    }

    .leave-tab {
      padding: 0.75rem 1.5rem;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-weight: 600;
      color: #6b7280;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .leave-tab:hover {
      color: #2563eb;
    }

    .leave-tab.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
    }

    /* Leave Requests List */
    .leave-requests-container {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .leave-requests-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .leave-request-card {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1.25rem;
      transition: all 0.2s;
      cursor: pointer;
    }

    .leave-request-card:hover {
      border-color: #2563eb;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);
    }

    .leave-request-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1rem;
    }

    .leave-request-info {
      flex: 1;
    }

    .employee-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 0.25rem;
    }

    .employee-position {
      font-size: 0.875rem;
      color: #6b7280;
    }

    .leave-status-badge {
      padding: 0.4rem 0.75rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }

    .status-approved {
      background: #d1fae5;
      color: #065f46;
    }

    .status-rejected {
      background: #fee2e2;
      color: #991b1b;
    }

    .status-active {
      background: #dbeafe;
      color: #1e40af;
    }

    .leave-request-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #f3f4f6;
    }

    .detail-item {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .detail-label {
      font-size: 0.75rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .detail-value {
      font-size: 0.95rem;
      font-weight: 600;
      color: #111827;
    }

    /* Leave Modal */
    .leave-modal-content {
      max-width: 600px;
    }

    .leave-balance-info {
      background: #f9fafb;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
    }

    .balance-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
    }

    .balance-label {
      font-weight: 600;
      color: #374151;
    }

    .balance-value {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .balance-value.sufficient {
      color: #10b981;
    }

    .balance-value.insufficient {
      color: #ef4444;
    }

    .leave-details-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .detail-group {
      background: #f9fafb;
      padding: 1rem;
      border-radius: 8px;
    }

    .detail-group-label {
      font-size: 0.75rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }

    .detail-group-value {
      font-size: 1rem;
      font-weight: 600;
      color: #111827;
    }

    .leave-reason-section {
      margin: 1.5rem 0;
    }

    .leave-reason-section h4 {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.5rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .leave-reason-text {
      background: #f9fafb;
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid #2563eb;
      color: #374151;
      line-height: 1.6;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #9ca3af;
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .empty-state-text {
      font-size: 1.1rem;
      font-weight: 600;
    }

      @media (max-width: 768px) {
      .leave-dashboard {
        padding: 1rem;
        max-width: 100%;
      }

      .leave-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .btn-apply-leave {
        width: 100%;
      }

      .leave-stats {
        grid-template-columns: 1fr;
      }

      .leave-tabs {
        flex-wrap: wrap;
      }

      .leave-request-header {
        flex-direction: column;
        gap: 0.75rem;
      }

      .leave-request-details {
        grid-template-columns: 1fr;
      }

      .leave-details-grid {
        grid-template-columns: 1fr;
      }
    }

  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2>HYDROMED <span id="navToggle"></span></h2>
      </div>
      <nav>
        <a href="#" class="active" data-page="dashboard">Dashboard</a>
        <a href="#" data-page="inventory">Inventory</a>
        <a href="#" data-page="trial">Patient List</a>
        <a href="#" data-page="journals">Charge Slip</a>
        <a href="#" data-page="accounts">Sales</a>
        <a href="#" data-page="financials">Leave</a>
        <a href="#" data-page="adjustments">Payroll</a>
        <a href="#" data-page="payslip">Payslip</a>
        <a href="#" data-page="reports">Reports</a>
        <a href="#" data-page="settings">Settings</a>
      </nav>
      
      <!-- User Profile Section -->
      <div class="user-profile">
        <div class="user-profile-header" id="userProfileToggle">
          <div class="user-avatar">
            <span id="userInitials">JD</span>
          </div>
          <div class="user-info">
            <div class="user-name" id="userName">John Doe</div>
            <div class="user-role" id="userRole">Owner</div>
          </div>
          <div class="dropdown-icon"></div>
        </div>
        
        <div class="user-dropdown" id="userDropdown">
          <div class="dropdown-section">
            <div class="dropdown-label">Switch Role (Demo)</div>
            <button class="dropdown-item role-switch" data-role="owner">
              <span class="role-icon"></span>
              <div class="role-info">
                <div class="role-name">Owner</div>
                <div class="role-desc">Full access, monitor changes</div>
              </div>
            </button>
            <button class="dropdown-item role-switch" data-role="admin">
              <span class="role-icon"></span>
              <div class="role-info">
                <div class="role-name">Admin</div>
                <div class="role-desc">View, write, delete</div>
              </div>
            </button>
            <button class="dropdown-item role-switch" data-role="nurse">
              <span class="role-icon"></span>
              <div class="role-info">
                <div class="role-name">Nurse</div>
                <div class="role-desc">Limited access</div>
              </div>
            </button>
          </div>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item logout-btn">
            <span class="logout-icon"></span>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </aside>

    <main class="main">
      <!-- === DASHBOARD === -->
      <div class="page active" id="dashboard">
        <header>
          <div class="header-top">
            <div>
              <h1>Dashboard</h1>
              <p>Accounting system overview</p>
            </div>
            <div class="dashboard-date" id="dashboardDate">January 23, 2026</div>
          </div>
        </header>

        <!-- Inventory Overview Section -->
        <div class="inventory-overview-section">
          <div class="section-header">
            <h3 class="section-title">Inventory Status</h3>
            <div class="period-selector">
              <button class="period-btn active" data-period="today">Today</button>
              <button class="period-btn" data-period="month">This Month</button>
              <button class="period-btn" data-period="year">This Year</button>
            </div>
          </div>
          
          <div class="inventory-overview">
            <div class="overview-card available-card" data-status="Available">
              <div class="overview-content">
                <div class="overview-label">Available Stock</div>
                <div class="overview-value" id="dashAvailableCount">0</div>
              </div>
            </div>
            
            <div class="overview-card low-stock-card" data-status="Low Stock">
              <div class="overview-content">
                <div class="overview-label">Low Stock</div>
                <div class="overview-value" id="dashLowStockCount">0</div>
              </div>
            </div>
            
            <div class="overview-card out-stock-card" data-status="Out of Stock">
              <div class="overview-content">
                <div class="overview-label">Out of Stock</div>
                <div class="overview-value" id="dashOutStockCount">0</div>
              </div>
            </div>
            
            <div class="overview-card expiring-card" data-status="Expiring Soon">
              <div class="overview-content">
                <div class="overview-label">Expiring Soon</div>
                <div class="overview-value" id="dashExpiringCount">0</div>
              </div>
            </div>
          </div>
        </div>

        <div class="cards">
          <div class="card"><h3>Total Assets</h3><div class="value" id="totalAssets">500,000</div></div>
          <div class="card"><h3>Liabilities</h3><div class="value" id="totalLiabilities">200,000</div></div>
          <div class="card"><h3>Revenue</h3><div class="value" id="totalRevenue">120,000</div></div>
          <div class="card"><h3>Expenses</h3><div class="value" id="totalExpenses">75,500</div></div>
          <div class="card"><h3>Net Profit</h3><div class="value" id="netProfit">44,500</div></div>
        </div>

        <div class="charts">
          <div class="chart-card"><h3 id="incomeExpensesTitle">Income vs Expenses</h3><canvas id="revExp"></canvas></div>
          <div class="chart-card"><h3 id="cashFlowTitle">Cash Flow Trends</h3><canvas id="cashFlow"></canvas></div>
          <div class="chart-card"><h3 id="profitMarginTitle">Profit Margins</h3><canvas id="profitMargin"></canvas></div>
        </div>

        <div class="transactions">
          <h3>Recent Transactions</h3>
          <table>
            <thead>
              <tr><th>Date</th><th>Description</th><th>Amount</th><th>Status</th></tr>
            </thead>
            <tbody id="transactionsBody">
              <tr><td class="date" data-label="Date">26-01-10</td><td data-label="Description">Invoice #1023</td><td data-label="Amount">5,000</td><td data-label="Status">Paid</td></tr>
              <tr><td class="date" data-label="Date">26-01-11</td><td data-label="Description">Invoice #1024</td><td data-label="Amount">7,500</td><td data-label="Status">Unpaid</td></tr>
              <tr><td class="date" data-label="Date">26-01-12</td><td data-label="Description">Invoice #1025</td><td data-label="Amount">3,200</td><td data-label="Status">Paid</td></tr>
            </tbody>
          </table>
        </div>

        <div class="alerts">
          <h3>Alerts</h3>
          <table>
            <thead>
              <tr><th>Invoice</th><th>Due Date</th><th>Status</th></tr>
            </thead>
            <tbody id="alertsBody">
              <tr><td data-label="Invoice">#1024</td><td class="date" data-label="Due Date">26-01-15</td><td data-label="Status">Overdue</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- === INVENTORY PAGE === -->
      <div class="page" id="inventory">
        <!-- Header with Title and Current Date -->
        <div class="inventory-new-header">
          <h2>Inventory<br>Management</h2>
          <div class="current-date-badge" id="inventoryCurrentDate">January 24, 2026</div>
        </div>

        <!-- Four Box Grid (2x2) -->
        <div class="inventory-status-grid">
          <div class="status-box available active" data-status="all">
            <div class="status-label">All</div>
            <div class="status-count" id="allCount">0</div>
          </div>
          <div class="status-box low" data-status="low">
            <div class="status-label">Low Stock</div>
            <div class="status-count" id="lowCount">0</div>
          </div>
          <div class="status-box out" data-status="out">
            <div class="status-label">Out of Stock</div>
            <div class="status-count" id="outCount">0</div>
          </div>
          <div class="status-box add" id="addNewProductBox">
            <div class="status-label">Add Product</div>
            <div class="add-icon">+</div>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="inventory-search-bar">
          <input type="text" id="inventorySearchInput" placeholder="Search products...">
        </div>

        <!-- Navigation: Date Picker and Prev/Next Buttons -->
        <div class="inventory-navigation">
          <input type="date" id="visibleDatePicker" class="visible-date-picker">
          <div class="nav-arrows-group">
            <button class="nav-arrow-btn" id="prevDayBtn">&lt;</button>
            <button class="nav-arrow-btn" id="nextDayBtn">&gt;</button>
          </div>
        </div>
        
        <!-- Hidden date picker for popup -->
        <input type="date" id="datePickerInput" class="hidden-date-picker">

        <!-- Products Table -->
        <div class="inventory-products-table">
          <table>
            <thead>
              <tr>
                <th>Category</th>
                <th>Product</th>
                <th>Current Stock</th>
                <th>Expiry Date</th>
                <th>Sales</th>
              </tr>
            </thead>
            <tbody id="inventoryProductsBody">
              <!-- Products will be inserted here by JavaScript -->
            </tbody>
          </table>
        </div>

        <!-- Restock Button -->
        <div class="restock-button-container">
          <button id="goToRestockBtn" class="btn-restock"> Restock Checklist</button>
          <button id="goToManualUpdateBtn" class="btn-manual-update"> Manual Inventory Update</button>
        </div>

        <!-- Hidden date picker for popup -->
        <input type="date" id="datePickerInput" class="hidden-date-picker">
      </div>

      <!-- === RESTOCK CHECKLIST PAGE === -->
      <div class="restock-page" id="restockPage" style="display: none;">
        <div class="restock-header">
          <h2>Restock Checklist</h2>
          <button id="backFromRestockBtn" class="btn-back"> Back to Inventory</button>
        </div>

        <!-- Search and Category Filter -->
        <div class="restock-search-filter">
          <input type="text" id="restockSearchInput" class="restock-search-input" placeholder=" Search products...">
          <select id="restockCategoryFilter" class="restock-category-filter">
            <option value="all">All Categories</option>
            <!-- Categories will be populated dynamically -->
          </select>
        </div>

        <!-- Filter Tabs -->
        <div class="restock-filters">
          <button class="restock-filter-btn active" data-filter="all">All</button>
          <button class="restock-filter-btn" data-filter="low">Low Stock</button>
          <button class="restock-filter-btn" data-filter="out">Out of Stock</button>
        </div>

        <!-- Restock Items List -->
        <div id="restockItemsList" class="restock-items-list">
          <!-- Cards will be inserted here -->
        </div>

        <!-- Bottom Actions -->
        <div class="restock-actions">
          <button id="deleteSelectedBtn" class="btn-delete-selected"></button>
          <button id="updateStocksBtn" class="btn-update-stocks">
             Update Stocks <span id="updateCounter">(0)</span>
          </button>
        </div>
      </div>

      <!-- === MANUAL INVENTORY UPDATE PAGE === -->
      <div class="manual-update-page" id="manualUpdatePage" style="display: none;">
        <div class="manual-update-header">
        <h2>Manual Inventory Update</h2>
        <button id="backFromManualUpdateBtn" class="btn-back"> Back to Inventory</button>
      </div>

      <!-- Search and Category Filter -->
      <div class="restock-search-filter">
        <input type="text" id="manualUpdateSearchInput" class="restock-search-input" placeholder=" Search products...">
        <select id="manualUpdateCategoryFilter" class="restock-category-filter">
          <option value="all">All Categories</option>
          <!-- Categories will be populated dynamically -->
        </select>
      </div>

      <!-- Date Display -->
      <div class="manual-update-date-display">
          <span class="date-label">Editing sales for:</span>
          <span class="date-value" id="manualUpdateDateDisplay">January 26, 2026</span>
        </div>

        <!-- Products List -->
        <div class="manual-update-list" id="manualUpdateList">
          <!-- Products will be inserted here -->
        </div>

        <!-- Save Button -->
        <div class="manual-update-save-container">
          <button id="saveManualUpdatesBtn" class="btn-save-manual-updates"> Save All Changes</button>
        </div>
      </div>

      <!-- === PATIENT LIST / LABORATORY LOGBOOK === -->
      <div class="page" id="trial">
        <div class="patient-list-header">
          <h2>Laboratory Logbook</h2>
          <button class="btn-manage-lab-types" id="manageLabTypesBtn"> Manage Lab Types</button>
        </div>

        <!-- Add Patient Form -->
        <div class="add-patient-form">
          <h3>Record New Patient</h3>
          <div class="patient-form-grid">
            <div class="form-group">
              <label for="patientNameInput">Patient Name</label>
              <input type="text" id="patientNameInput" placeholder="Enter patient name" required>
            </div>
            
            <div class="form-group">
              <label for="labTypeSelect">Laboratory Type</label>
              <select id="labTypeSelect" required>
                <option value="">Select Lab Type</option>
                <!-- Options will be populated from preset -->
              </select>
            </div>
            
            <div class="form-group align-end">
              <button class="btn-add-patient" id="addPatientBtn">+ Add Patient</button>
            </div>
          </div>
        </div>

        <!-- Patient Records Table -->
        <div class="patient-records-container">
          <h3>Patient Records</h3>
          <div class="table-wrapper">
            <table class="patient-records-table">
              <thead>
                <tr>
                  <th>Timestamp</th>
                  <th>Date</th>
                  <th>Patient Name</th>
                  <th>Lab Type</th>
                  <th>Nurse on Duty</th>
                  <th>Assigned</th>
                </tr>
              </thead>
              <tbody id="patientRecordsBody">
                <!-- Records will be inserted here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Lab Types Management Modal -->
      <div class="modal" id="labTypesModal">
        <div class="modal-content">
          <div class="modal-header">
            <h2>Manage Laboratory Types</h2>
            <button class="modal-close" id="closeLabTypesModal">&times;</button>
          </div>
          
          <div class="lab-types-list" id="labTypesList">
            <!-- Lab types will be inserted here -->
          </div>
          
          <div class="add-lab-type-form">
            <input type="text" id="newLabTypeInput" placeholder="Enter new lab type...">
            <button id="addLabTypeBtn">+ Add Lab Type</button>
          </div>
        </div>
      </div>

      <!-- === SALES PAGE === -->
      <div class="page" id="accounts">
        <div class="sales-page-header">
          <h2>Sales Records</h2>
          <div class="sales-period-selector">
            <button class="sales-period-btn active" data-period="today">Today</button>
            <button class="sales-period-btn" data-period="month">This Month</button>
            <button class="sales-period-btn" data-period="year">This Year</button>
          </div>
        </div>

        <!-- Summary Cards -->
        <div class="sales-summary-cards">
          <div class="sales-summary-card revenue">
            <div class="sales-summary-label">Total Revenue</div>
            <div class="sales-summary-value" id="salesTotalRevenue">0</div>
          </div>
          
          <div class="sales-summary-card transactions">
            <div class="sales-summary-label">Transactions</div>
            <div class="sales-summary-value" id="salesTotalTransactions">0</div>
          </div>
          
          <div class="sales-summary-card items">
            <div class="sales-summary-label">Items Sold</div>
            <div class="sales-summary-value" id="salesTotalItems">0</div>
          </div>
          
          <div class="sales-summary-card average">
            <div class="sales-summary-label">Average Sale</div>
            <div class="sales-summary-value" id="salesAverageSale">0</div>
          </div>
        </div>

        <!-- Search and Export -->
        <div class="sales-search-export">
          <input type="text" id="salesSearchInput" class="sales-search-input" placeholder=" Search by patient name, nurse, or items...">
          <button id="exportSalesBtn" class="btn-export-sales"> Export to Excel</button>
        </div>

        <!-- Sales Table -->
        <div class="sales-table-container">
          <table class="sales-table">
            <thead>
              <tr>
                <th>Date & Time</th>
                <th>Patient Name</th>
                <th>Nurse</th>
                <th>Items Breakdown</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="salesTableBody">
              <!-- Sales records will be inserted here -->
            </tbody>
          </table>
        </div>

        <!-- Category Breakdown -->
        <div class="category-breakdown">
          <h3>Sales by Category</h3>
          <div class="category-breakdown-grid" id="categoryBreakdownGrid">
            <!-- Category breakdown will be inserted here -->
          </div>
        </div>
      </div>

      <!-- === JOURNALS PAGE === -->
      <div class="page" id="journals">
        <div class="journal-responsive-layout">
          <!-- Top: Header Info -->
          <div class="journal-header-compact">
            <div class="journal-nurse-info">
              <span id="journalNurseName">Mark Cruz</span>
              <span id="journalCurrentTime">01/23/26 - 14:30</span>
            </div>
            <input type="text" id="journalPatientName" class="journal-patient-input-inline" placeholder="Patient Name">
          </div>

          <!-- Middle: Current Items (collapsible/compact) -->
          <div class="journal-current-items-compact" id="journalItemsList">
            <div class="journal-empty-inline">No items  Tap category to start</div>
          </div>

          <!-- Scrollable: Category/Product Selection -->
          <div class="journal-selection-scrollable">
            <div class="journal-selection-title-small" id="journalSelectionTitle">Select Category</div>
            
            <!-- Category Grid -->
            <div class="journal-grid-scrollable" id="journalCategoryGrid">
              <button class="journal-grid-btn" data-category="Medicine">
                <span class="journal-grid-icon"></span>
                <span>Medicine</span>
              </button>
              <button class="journal-grid-btn" data-category="PPE">
                <span class="journal-grid-icon"></span>
                <span>PPE</span>
              </button>
              <button class="journal-grid-btn" data-category="Supplies">
                <span class="journal-grid-icon"></span>
                <span>Supplies</span>
              </button>
              <button class="journal-grid-btn" data-category="Equipment">
                <span class="journal-grid-icon"></span>
                <span>Equipment</span>
              </button>
              <button class="journal-grid-btn" data-category="Hygiene">
                <span class="journal-grid-icon"></span>
                <span>Hygiene</span>
              </button>
              <button class="journal-grid-btn" data-category="Other">
                <span class="journal-grid-icon"></span>
                <span>Other</span>
              </button>
            </div>

            <!-- Product Grid (Hidden by default) -->
            <div class="journal-grid-scrollable journal-hidden" id="journalProductGrid">
              <!-- Products will be dynamically loaded here -->
            </div>
          </div>

          <!-- Fixed Bottom: Controls -->
          <div class="journal-fixed-bottom">
            <div class="journal-qty-row">
              <button class="journal-qty-btn-small" id="journalDecreaseQty"></button>
              <div class="journal-qty-num" id="journalQtyDisplay">1</div>
              <button class="journal-qty-btn-small" id="journalIncreaseQty">+</button>
            </div>
            <div class="journal-action-row">
              <button class="journal-btn-small journal-recent-btn" id="journalRecentBtn">Recent</button>
              <button class="journal-btn-small journal-ok-btn" id="journalOkBtn" disabled>Save</button>
              <button class="journal-btn-small journal-add-btn" id="journalAddItemBtn" disabled>Add</button>
            </div>
          </div>
        </div>
      </div>

            <!-- === LEAVE MANAGEMENT SYSTEM === -->
      <div class="page" id="financials">
        <!-- Leave Dashboard View (Default for Admin/Owner) -->
        <div class="leave-dashboard" id="leaveDashboard">
          <div class="leave-header">
            <h2>Leave Management</h2>
            <button class="btn-apply-leave" id="applyLeaveBtn">+ Apply Leave</button>
          </div>

          <!-- Leave Statistics Cards -->
          <div class="leave-stats">
            <div class="leave-stat-card pending-card">
              <div class="stat-icon"></div>
              <div class="stat-content">
                <div class="stat-label">Pending Applications</div>
                <div class="stat-value" id="pendingCount">0</div>
              </div>
            </div>

            <div class="leave-stat-card active-card">
              <div class="stat-icon"></div>
              <div class="stat-content">
                <div class="stat-label">Currently on Leave</div>
                <div class="stat-value" id="activeLeaveCount">0</div>
              </div>
            </div>

            <div class="leave-stat-card approved-card">
              <div class="stat-icon"></div>
              <div class="stat-content">
                <div class="stat-label">Approved This Month</div>
                <div class="stat-value" id="approvedCount">0</div>
              </div>
            </div>

            <div class="leave-stat-card rejected-card">
              <div class="stat-icon"></div>
              <div class="stat-content">
                <div class="stat-label">Rejected This Month</div>
                <div class="stat-value" id="rejectedCount">0</div>
              </div>
            </div>
          </div>

          <!-- Filter Tabs -->
          <div class="leave-tabs">
            <button class="leave-tab active" data-filter="pending">Pending</button>
            <button class="leave-tab" data-filter="active">Currently on Leave</button>
            <button class="leave-tab" data-filter="approved">Approved</button>
            <button class="leave-tab" data-filter="rejected">Rejected</button>
            <button class="leave-tab" data-filter="all">All Requests</button>
          </div>

          <!-- Leave Requests List -->
          <div class="leave-requests-container">
            <div id="leaveRequestsList" class="leave-requests-list">
              <!-- Leave requests will be inserted here -->
            </div>
          </div>
        </div>

        <!-- Apply Leave Modal -->
        <div class="modal" id="applyLeaveModal">
          <div class="modal-content leave-modal-content">
            <div class="modal-header">
              <h2>Apply for Leave</h2>
              <button class="modal-close" id="closeApplyLeaveModal">&times;</button>
            </div>

            <form id="applyLeaveForm">
              <div class="form-group">
                <label for="leaveType">Leave Type *</label>
                <select id="leaveType" required>
                  <option value="">Select Leave Type</option>
                  <option value="Vacation Leave">Vacation Leave</option>
                  <option value="Sick Leave">Sick Leave</option>
                </select>
              </div>

              <div class="form-group">
                <label for="leaveStartDate">Start Date *</label>
                <input type="date" id="leaveStartDate" required>
              </div>

              <div class="form-group">
                <label for="leaveEndDate">End Date *</label>
                <input type="date" id="leaveEndDate" required>
              </div>

              <div class="form-group">
                <label for="leaveDays">Number of Days</label>
                <input type="number" id="leaveDays" readonly>
              </div>

              <div class="form-group">
                <label for="leaveReason">Reason *</label>
                <textarea id="leaveReason" rows="4" placeholder="Please provide reason for leave..." required></textarea>
              </div>

              <div class="leave-balance-info" id="leaveBalanceInfo">
                <!-- Balance info will be shown here -->
              </div>

              <div class="modal-actions">
                <button type="button" class="btn-secondary" id="cancelApplyLeave">Cancel</button>
                <button type="submit" class="btn-primary">Submit Application</button>
              </div>
            </form>
          </div>
        </div>

        <!-- View Leave Details Modal -->
        <div class="modal" id="viewLeaveModal">
          <div class="modal-content leave-modal-content">
            <div class="modal-header">
              <h2>Leave Request Details</h2>
              <button class="modal-close" id="closeViewLeaveModal">&times;</button>
            </div>

            <div id="leaveDetailsContent">
              <!-- Details will be inserted here -->
            </div>

            <div class="modal-actions" id="leaveActionButtons">
              <!-- Action buttons will be inserted here based on status and role -->
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Add Product Modal -->
  <div class="modal" id="addProductModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add Product</h2>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      <form id="addProductForm">
        <div class="form-group">
          <label for="productDate">Date</label>
          <input type="date" id="productDate" required>
        </div>
        <div class="form-group">
          <label for="productCategory">Category</label>
          <div style="display: flex; gap: 0.5rem; align-items: center;">
            <select id="productCategory" required style="flex: 1;">
              <option value="">Select Category</option>
            </select>
            <button type="button" id="manageCategoriesBtn" style="padding: 0.6rem; border: 1px solid #d1d5db; background: white; color: #374151; border-radius: 6px; cursor: pointer; white-space: nowrap;">
               Manage
            </button>
          </div>
        </div>
        <div class="form-group">
          <label for="productName">Product Name</label>
          <input type="text" id="productName" required>
        </div>
        <div class="form-group">
          <label for="productExpiry">Expiry</label>
          <input type="date" id="productExpiry" required>
        </div>
        <div class="form-group">
          <label for="productQty">Quantity</label>
          <input type="number" id="productQty" min="0" required>
        </div>
        <div class="form-group">
          <label for="productStatus">Status</label>
          <select id="productStatus" required>
            <option value="Available">Available</option>
            <option value="Low Stock">Low Stock</option>
            <option value="Out of Stock">Out of Stock</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="button" class="btn-cancel" id="cancelBtn">Cancel</button>
          <button type="submit" class="btn-submit">Add Product</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Category Management Modal -->
  <div class="modal" id="categoryModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Manage Categories</h2>
        <button class="modal-close" id="closeCategoryModal">&times;</button>
      </div>
      
      <div class="category-list" id="categoryList">
        <!-- Categories will be inserted here -->
      </div>
      
      <div class="category-bottom-actions">
        <input type="text" id="newCategoryInput" placeholder="Enter new category name...">
        <button id="saveCategoriesBtn" class="btn-save-all"> Save</button>
        <button id="addCategoryBtn" class="btn-add-category">+ Add</button>
      </div>
    </div>
  </div>

  <!-- Stock Detail Modal -->
  <div class="modal" id="stockDetailModal">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2 id="stockDetailTitle">Stock Details</h2>
        <button class="modal-close" id="closeStockDetailModal">&times;</button>
      </div>
      
      <div id="stockDetailBody" style="max-height: 60vh; overflow-y: auto;">
        <!-- Stock details will be inserted here -->
      </div>
      
      <div class="form-actions" style="margin-top: 1.5rem;">
        <button type="button" class="btn-cancel" id="closeStockDetailBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Recent Receipts Modal -->
  <div class="modal" id="journalRecentModal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h2>Print Queue</h2>
        <button class="modal-close" id="closeJournalRecentModal">&times;</button>
      </div>
      <div id="journalRecentModalBody" style="max-height: 60vh; overflow-y: auto; padding: 1.25rem;">
        <div class="journal-empty">No receipts in queue</div>
      </div>
    </div>
  </div>

  <!-- Receipt Preview Modal -->
  <div class="modal" id="journalPreviewModal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h2>Receipt Preview</h2>
        <button class="modal-close" id="closeJournalPreviewModal">&times;</button>
      </div>
      <div id="journalPreviewModalBody" style="max-height: 60vh; overflow-y: auto; padding: 1.25rem;">
        <!-- Receipt preview will be shown here -->
      </div>
    </div>
  </div>




  <script>
    // Sidebar toggle
    const sidebar = document.getElementById('sidebar');
    const navToggle = document.getElementById('navToggle');
    navToggle.addEventListener('click', () => sidebar.classList.toggle('open'));

    // User profile dropdown toggle
    const userProfileToggle = document.getElementById('userProfileToggle');
    const userDropdown = document.getElementById('userDropdown');
    
    userProfileToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      userProfileToggle.classList.toggle('open');
      userDropdown.classList.toggle('open');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!userProfileToggle.contains(e.target) && !userDropdown.contains(e.target)) {
        userProfileToggle.classList.remove('open');
        userDropdown.classList.remove('open');
      }
    });
    
    // Role management
    let currentRole = 'owner';
    const roleData = {
      owner: {
        name: 'John Doe',
        initials: 'JD',
        role: 'Owner',
        permissions: {
          canView: true,
          canWrite: true,
          canDelete: false,
          canMonitor: true
        }
      },
      admin: {
        name: 'Jane Smith',
        initials: 'JS',
        role: 'Admin',
        permissions: {
          canView: true,
          canWrite: true,
          canDelete: true,
          canMonitor: false
        }
      },
      nurse: {
        name: 'Maria Santos',
        initials: 'MS',
        role: 'Nurse',
        permissions: {
          canView: true,
          canWrite: false,
          canDelete: false,
          canMonitor: false
        }
      }
    };
    
    // Update UI based on role
    function updateUIForRole(role) {
      const data = roleData[role];
      currentRole = role;
      
      // Update user info
      document.getElementById('userName').textContent = data.name;
      document.getElementById('userRole').textContent = data.role;
      document.getElementById('userInitials').textContent = data.initials;
      
      // Update active role in dropdown
      document.querySelectorAll('.role-switch').forEach(btn => {
        if (btn.dataset.role === role) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
      
      // Apply permission-based UI changes
      applyPermissions(data.permissions);
      
      // Close dropdown
      userProfileToggle.classList.remove('open');
      userDropdown.classList.remove('open');
    }
    
    // Apply permissions to UI elements
    function applyPermissions(permissions) {
      // Get all nav links
      const navLinks = {
        dashboard: document.querySelector('[data-page="dashboard"]'),
        inventory: document.querySelector('[data-page="inventory"]'),
        journals: document.querySelector('[data-page="journals"]'),
        accounts: document.querySelector('[data-page="accounts"]'),
        trial: document.querySelector('[data-page="trial"]'),
        financials: document.querySelector('[data-page="financials"]'),
        adjustments: document.querySelector('[data-page="adjustments"]'),
        reports: document.querySelector('[data-page="reports"]'),
        settings: document.querySelector('[data-page="settings"]')
      };
      
      // Nurse can only see: Accounts (Laboratory), Journals (Receipt), Adjustments, Reports, Settings
      if (!permissions.canWrite) {
        // Show only specific links for nurse
        const nursePages = ['accounts', 'journals', 'adjustments', 'reports', 'settings'];
        
        Object.keys(navLinks).forEach(key => {
          if (navLinks[key]) {
            if (nursePages.includes(key)) {
              navLinks[key].style.display = 'block';
            } else {
              navLinks[key].style.display = 'none';
            }
          }
        });
        
        // If currently on a hidden page, redirect to first available page (accounts/laboratory)
        const currentPage = document.querySelector('.page.active');
        if (currentPage && !nursePages.includes(currentPage.id)) {
          document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
          document.getElementById('accounts').classList.add('active');
          document.querySelectorAll('.sidebar nav a').forEach(l => l.classList.remove('active'));
          navLinks.accounts.classList.add('active');
        }
      } else {
        // Show all links for owner/admin
        Object.values(navLinks).forEach(link => {
          if (link) link.style.display = 'block';
        });
      }
      
      // Hide/show add product button based on write permission
      const addProductBtn = document.getElementById('addProductBtn');
      if (addProductBtn) {
        if (permissions.canWrite) {
          addProductBtn.style.display = 'block';
        } else {
          addProductBtn.style.display = 'none';
        }
      }
      
      // Hide/show category management for nurses
      const manageCategoriesBtn = document.getElementById('manageCategoriesBtn');
      if (manageCategoriesBtn) {
        if (permissions.canWrite) {
          manageCategoriesBtn.style.display = 'block';
        } else {
          manageCategoriesBtn.style.display = 'none';
        }
      }
      
      // Show notification about role change
      showRoleNotification(currentRole);
    }
    
    // Show role change notification
    function showRoleNotification(role) {
      const data = roleData[role];
      const permissions = [];
      
      if (data.permissions.canView) permissions.push('View');
      if (data.permissions.canWrite) permissions.push('Write');
      if (data.permissions.canDelete) permissions.push('Delete');
      if (data.permissions.canMonitor) permissions.push('Monitor');
      
      // Show in modal instead of alert
      stockDetailTitle.textContent = `Role Changed: ${data.role}`;
      stockDetailBody.innerHTML = `
        <div style="padding: 1rem 0;">
          <div style="margin-bottom: 1.5rem;">
            <div style="font-size: 1.1rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem;">
              Welcome, ${data.name}
            </div>
            <div style="color: #6b7280; font-size: 0.9rem;">
              You are now logged in as <strong>${data.role}</strong>
            </div>
          </div>
          
          <div class="stock-summary">
            <div class="stock-summary-title">Your Permissions</div>
            ${permissions.map(p => `
              <div style="padding: 0.5rem 0; color: #10b981; display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-size: 1.2rem;"></span>
                <span>${p}</span>
              </div>
            `).join('')}
          </div>
          
          <div style="margin-top: 1rem; padding: 0.875rem; background: #f3f4f6; border-radius: 6px; font-size: 0.85rem; color: #6b7280;">
            <strong>Note:</strong> This is a simulation. Database integration pending.
          </div>
        </div>
      `;
      stockDetailModal.classList.add('active');
    }
    
    // Role switch handlers
    document.querySelectorAll('.role-switch').forEach(btn => {
      btn.addEventListener('click', () => {
        const role = btn.dataset.role;
        updateUIForRole(role);
      });
    });
    
    // Logout handler
    document.querySelector('.logout-btn').addEventListener('click', () => {
      if (confirm('Are you sure you want to logout?')) {
        alert('Logout functionality will be implemented with backend integration.');
      }
    });

    // Page navigation
    const pageLinks = document.querySelectorAll('.sidebar nav a');
    const pages = document.querySelectorAll('.page');

    pageLinks.forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const target = link.dataset.page;

        // Hide all main pages
        pages.forEach(p => p.classList.remove('active'));
        
        // Hide restock and manual update pages (defined later in code)
        const restockPageEl = document.getElementById('restockPage');
        const manualUpdatePageEl = document.getElementById('manualUpdatePage');
        if (restockPageEl) restockPageEl.style.display = 'none';
        if (manualUpdatePageEl) manualUpdatePageEl.style.display = 'none';
        
        // Show target page
        const targetPage = document.getElementById(target);
        if (targetPage) targetPage.classList.add('active');

        // Update active link
        pageLinks.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        
        // Close sidebar on mobile after clicking
        if (window.innerWidth < 768) {
          sidebar.classList.remove('open');
        }
      });
    });

    // Charts
    let revExpChart, cashFlowChart, profitMarginChart;
    
    // Sample dashboard data
    const dashboardData = {
      today: {
        assets: 500000,
        liabilities: 200000,
        revenue: 12000,
        expenses: 7500,
        netProfit: 4500,
        incomeExpenses: {
          labels: ['12AM', '1AM', '2AM', '3AM', '4AM', '5AM', '6AM', '7AM', '8AM', '9AM', '10AM', '11AM', '12PM', '1PM', '2PM', '3PM', '4PM', '5PM', '6PM', '7PM', '8PM', '9PM', '10PM', '11PM'],
          income: [300, 280, 250, 230, 200, 350, 500, 700, 900, 1100, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000, 2700, 2400, 2100, 1800, 1500],
          expenses: [200, 190, 180, 170, 150, 250, 350, 500, 650, 850, 1000, 1150, 1300, 1450, 1600, 1750, 1900, 2000, 2100, 2000, 1800, 1600, 1400, 1200]
        },
        cashFlow: {
          labels: ['12AM', '1AM', '2AM', '3AM', '4AM', '5AM', '6AM', '7AM', '8AM', '9AM', '10AM', '11AM', '12PM', '1PM', '2PM', '3PM', '4PM', '5PM', '6PM', '7PM', '8PM', '9PM', '10PM', '11PM'],
          data: [100, 90, 70, 60, 50, 100, 150, 200, 250, 250, 400, 450, 500, 550, 600, 650, 700, 800, 900, 700, 600, 500, 400, 300]
        },
        profitMargin: {
          labels: ['12AM', '1AM', '2AM', '3AM', '4AM', '5AM', '6AM', '7AM', '8AM', '9AM', '10AM', '11AM', '12PM', '1PM', '2PM', '3PM', '4PM', '5PM', '6PM', '7PM', '8PM', '9PM', '10PM', '11PM'],
          data: [33, 32, 28, 26, 25, 29, 30, 29, 28, 23, 29, 28, 28, 27, 27, 27, 27, 29, 30, 26, 25, 24, 22, 20]
        },
        transactions: [
          { date: '26-01-23 02:15', desc: 'Emergency #1028', amount: '3,500', status: 'Paid' },
          { date: '26-01-23 08:30', desc: 'Consultation #1030', amount: '2,000', status: 'Paid' },
          { date: '26-01-23 10:15', desc: 'Lab Test #1031', amount: '1,800', status: 'Paid' },
          { date: '26-01-23 14:20', desc: 'X-Ray #1032', amount: '2,500', status: 'Paid' },
          { date: '26-01-23 18:45', desc: 'Surgery #1033', amount: '15,000', status: 'Unpaid' },
          { date: '26-01-23 22:30', desc: 'Emergency #1034', amount: '4,200', status: 'Paid' }
        ],
        alerts: [
          { invoice: '#1033', dueDate: '26-01-23 20:00', status: 'Pending Payment' }
        ]
      },
      month: {
        assets: 500000,
        liabilities: 200000,
        revenue: 120000,
        expenses: 75500,
        netProfit: 44500,
        incomeExpenses: {
          labels: ['Day 1-5', 'Day 6-10', 'Day 11-15', 'Day 16-20', 'Day 21-25', 'Day 26-31'],
          income: [15000, 18000, 20000, 17000, 22000, 28000],
          expenses: [9000, 11000, 12000, 10500, 13000, 15000]
        },
        cashFlow: {
          labels: ['Day 1-5', 'Day 6-10', 'Day 11-15', 'Day 16-20', 'Day 21-25', 'Day 26-31'],
          data: [6000, 7000, 8000, 6500, 9000, 13000]
        },
        profitMargin: {
          labels: ['Day 1-5', 'Day 6-10', 'Day 11-15', 'Day 16-20', 'Day 21-25', 'Day 26-31'],
          data: [40, 39, 40, 38, 41, 46]
        },
        transactions: [
          { date: '26-01-10', desc: 'Invoice #1023', amount: '5,000', status: 'Paid' },
          { date: '26-01-11', desc: 'Invoice #1024', amount: '7,500', status: 'Unpaid' },
          { date: '26-01-12', desc: 'Invoice #1025', amount: '3,200', status: 'Paid' },
          { date: '26-01-15', desc: 'Invoice #1026', amount: '8,900', status: 'Paid' },
          { date: '26-01-18', desc: 'Invoice #1027', amount: '4,200', status: 'Paid' }
        ],
        alerts: [
          { invoice: '#1024', dueDate: '26-01-15', status: 'Overdue' }
        ]
      },
      year: {
        assets: 500000,
        liabilities: 200000,
        revenue: 1440000,
        expenses: 906000,
        netProfit: 534000,
        incomeExpenses: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
          income: [15000, 18000, 20000, 17000, 22000, 28000, 24000, 26000, 23000, 25000, 27000, 30000],
          expenses: [9000, 11000, 12000, 10500, 13000, 15000, 14000, 15500, 13500, 14500, 16000, 17000]
        },
        cashFlow: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
          data: [6000, 7000, 8000, 6500, 9000, 13000, 10000, 10500, 9500, 10500, 11000, 13000]
        },
        profitMargin: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
          data: [40, 39, 40, 38, 41, 46, 42, 41, 41, 42, 41, 43]
        },
        transactions: [
          { date: '26-01-10', desc: 'Invoice #1023', amount: '5,000', status: 'Paid' },
          { date: '26-02-15', desc: 'Invoice #1024', amount: '7,500', status: 'Paid' },
          { date: '26-03-20', desc: 'Invoice #1025', amount: '8,200', status: 'Paid' },
          { date: '26-04-12', desc: 'Invoice #1026', amount: '6,500', status: 'Paid' },
          { date: '26-05-18', desc: 'Invoice #1027', amount: '9,200', status: 'Paid' }
        ],
        alerts: []
      }
    };
    
    function initializeCharts() {
      const data = dashboardData.month;
      
      revExpChart = new Chart(document.getElementById('revExp'), {
        type: 'line',
        data: {
          labels: data.incomeExpenses.labels,
          datasets: [
            { label: 'Income', data: data.incomeExpenses.income, borderColor:'#2563eb', tension:0.4, fill:false },
            { label: 'Expenses', data: data.incomeExpenses.expenses, borderColor:'#ef4444', tension:0.4, fill:false }
          ]
        },
        options: { 
          responsive: true, 
          maintainAspectRatio: true,
          plugins: { legend: { position:'bottom' } },
          scales: {
            x: {
              ticks: {
                maxRotation: 45,
                minRotation: 45,
                autoSkip: false,
                font: {
                  size: 10
                }
              }
            }
          }
        }
      });

      cashFlowChart = new Chart(document.getElementById('cashFlow'), {
        type: 'bar',
        data: {
          labels: data.cashFlow.labels,
          datasets: [{ label: 'Cash Flow', data: data.cashFlow.data, backgroundColor:'#10b981' }]
        },
        options: { 
          responsive: true, 
          maintainAspectRatio: true,
          plugins: { legend: { display:false } },
          scales: {
            x: {
              ticks: {
                maxRotation: 45,
                minRotation: 45,
                autoSkip: false,
                font: {
                  size: 10
                }
              }
            }
          }
        }
      });

      profitMarginChart = new Chart(document.getElementById('profitMargin'), {
        type: 'line',
        data: {
          labels: data.profitMargin.labels,
          datasets: [{ label: 'Profit Margin %', data: data.profitMargin.data, borderColor:'#f59e0b', tension:0.4, fill:false }]
        },
        options: { 
          responsive: true, 
          maintainAspectRatio: true,
          plugins: { legend: { position:'bottom' } }, 
          scales: { 
            y: { beginAtZero:true, max:100 },
            x: {
              ticks: {
                maxRotation: 45,
                minRotation: 45,
                autoSkip: false,
                font: {
                  size: 10
                }
              }
            }
          } 
        }
      });
    }
    
    function updateDashboardData(period) {
      const data = dashboardData[period];
      
      // Update date display
      const today = new Date();
      const dashboardDateEl = document.getElementById('dashboardDate');
      
      if (period === 'today') {
        // Format: "January 23, 2026"
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        dashboardDateEl.textContent = today.toLocaleDateString('en-US', options);
      } else if (period === 'month') {
        // Format: "January 2026"
        const options = { year: 'numeric', month: 'long' };
        dashboardDateEl.textContent = today.toLocaleDateString('en-US', options);
      } else if (period === 'year') {
        // Format: "2026"
        dashboardDateEl.textContent = today.getFullYear().toString();
      }
      
      // Update financial cards
      document.getElementById('totalAssets').textContent = `${data.assets.toLocaleString()}`;
      document.getElementById('totalLiabilities').textContent = `${data.liabilities.toLocaleString()}`;
      document.getElementById('totalRevenue').textContent = `${data.revenue.toLocaleString()}`;
      document.getElementById('totalExpenses').textContent = `${data.expenses.toLocaleString()}`;
      document.getElementById('netProfit').textContent = `${data.netProfit.toLocaleString()}`;
      
      // Update chart titles
      const titleSuffix = period === 'today' ? ' (Today)' : period === 'month' ? ' (This Month)' : ' (This Year)';
      document.getElementById('incomeExpensesTitle').textContent = 'Income vs Expenses' + titleSuffix;
      document.getElementById('cashFlowTitle').textContent = 'Cash Flow Trends' + titleSuffix;
      document.getElementById('profitMarginTitle').textContent = 'Profit Margins' + titleSuffix;
      
      // Update charts
      revExpChart.data.labels = data.incomeExpenses.labels;
      revExpChart.data.datasets[0].data = data.incomeExpenses.income;
      revExpChart.data.datasets[1].data = data.incomeExpenses.expenses;
      revExpChart.update();
      
      cashFlowChart.data.labels = data.cashFlow.labels;
      cashFlowChart.data.datasets[0].data = data.cashFlow.data;
      cashFlowChart.update();
      
      profitMarginChart.data.labels = data.profitMargin.labels;
      profitMarginChart.data.datasets[0].data = data.profitMargin.data;
      profitMarginChart.update();
      
      // Update transactions
      const transactionsBody = document.getElementById('transactionsBody');
      transactionsBody.innerHTML = data.transactions.map(t => `
        <tr>
          <td class="date" data-label="Date">${t.date}</td>
          <td data-label="Description">${t.desc}</td>
          <td data-label="Amount">${t.amount}</td>
          <td data-label="Status">${t.status}</td>
        </tr>
      `).join('');
      
      // Update alerts
      const alertsBody = document.getElementById('alertsBody');
      if (data.alerts.length === 0) {
        alertsBody.innerHTML = '<tr><td colspan="3" style="text-align:center;">No alerts</td></tr>';
      } else {
        alertsBody.innerHTML = data.alerts.map(a => `
          <tr>
            <td data-label="Invoice">${a.invoice}</td>
            <td class="date" data-label="Due Date">${a.dueDate}</td>
            <td data-label="Status">${a.status}</td>
          </tr>
        `).join('');
      }
    }
    
    initializeCharts();

    // === DASHBOARD PERIOD SELECTOR (Moved outside inventory block) ===
    let currentPeriod = 'today';
    const periodBtns = document.querySelectorAll('.period-btn');
    
    periodBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        currentPeriod = btn.dataset.period;
        periodBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if (typeof updateDashboardOverview === 'function') updateDashboardOverview();
        if (typeof updateDashboardData === 'function') updateDashboardData(currentPeriod);
      });
    });
    
    // === MODAL CLOSE HANDLERS (Moved outside inventory block) ===
    const addProductModal = document.getElementById('addProductModal');
    const closeModal = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const addProductForm = document.getElementById('addProductForm');
    const productDate = document.getElementById('productDate');
    const productCategory = document.getElementById('productCategory');
    
    // Categories array
    let categories = ['IV', 'TAB/CAPS', 'BY GALLON', 'BY BOX', 'BY PIECE'];
    
    // Populate category dropdown
    function populateCategoryDropdown() {
      if (productCategory) {
        productCategory.innerHTML = '<option value="">Select Category</option>';
        categories.forEach(cat => {
          const option = document.createElement('option');
          option.value = cat;
          option.textContent = cat;
          productCategory.appendChild(option);
        });
      }
    }
    
    // Category Management Modal
    const manageCategoriesBtn = document.getElementById('manageCategoriesBtn');
    const categoryModal = document.getElementById('categoryModal');
    const closeCategoryModal = document.getElementById('closeCategoryModal');
    const closeCategoryBtn = document.getElementById('closeCategoryBtn');
    const categoryList = document.getElementById('categoryList');
    const newCategoryInput = document.getElementById('newCategoryInput');
    const addCategoryBtn = document.getElementById('addCategoryBtn');
    
    // Render category list in management modal
    function renderCategoryList() {
      if (categoryList) {
        categoryList.innerHTML = categories.map((cat, index) => `
          <div class="category-item" data-index="${index}">
            <input type="text" class="category-name-input" value="${cat}" data-index="${index}" />
          </div>
        `).join('');
      }
    }
    
    // Save all category changes
    function saveAllCategories() {
      const inputs = document.querySelectorAll('.category-name-input');
      let hasChanges = false;
      
      inputs.forEach((input, index) => {
        const newName = input.value.trim();
        if (newName && newName !== categories[index]) {
          categories[index] = newName;
          hasChanges = true;
        }
      });
      
      if (hasChanges) {
        // Disable button and show loading state
        const saveBtn = document.getElementById('saveCategoriesBtn');
        if (saveBtn) {
          saveBtn.disabled = true;
          saveBtn.textContent = ' Saving...';
          saveBtn.style.opacity = '0.6';
        }
        
        // Simulate save with animation
        setTimeout(() => {
          populateCategoryDropdown();
          console.log('Updated categories:', categories);
          
          // Show success state
          if (saveBtn) {
            saveBtn.textContent = ' Saved!';
            saveBtn.style.background = '#10b981';
            saveBtn.style.opacity = '1';
          }
          
          // Close modal after short delay
          setTimeout(() => {
            if (categoryModal) {
              categoryModal.classList.remove('active');
            }
            
            // Reset button state
            if (saveBtn) {
              saveBtn.disabled = false;
              saveBtn.textContent = ' Save';
              saveBtn.style.background = '#2563eb';
            }
          }, 800);
          
        }, 600);
      } else {
        alert(' No changes to save.');
      }
    }
    
    // Open category management modal
    if (manageCategoriesBtn && categoryModal) {
      manageCategoriesBtn.addEventListener('click', () => {
        categoryModal.classList.add('active');
        renderCategoryList();
      });
    }
    
    // Close category modal
    if (closeCategoryModal && categoryModal) {
      closeCategoryModal.addEventListener('click', () => {
        categoryModal.classList.remove('active');
      });
    }
    
    if (closeCategoryBtn && categoryModal) {
      closeCategoryBtn.addEventListener('click', () => {
        categoryModal.classList.remove('active');
      });
    }
    
    // Add new category
    const saveCategoriesBtn = document.getElementById('saveCategoriesBtn');
    
    if (saveCategoriesBtn) {
      saveCategoriesBtn.addEventListener('click', () => {
        saveAllCategories();
      });
    }
    
    if (addCategoryBtn && newCategoryInput) {
      addCategoryBtn.addEventListener('click', () => {
        const newCat = newCategoryInput.value.trim();
        if (newCat && !categories.includes(newCat)) {
          categories.push(newCat);
          newCategoryInput.value = '';
          renderCategoryList();
          populateCategoryDropdown();
          alert(` Category "${newCat}" added successfully!`);
        } else if (categories.includes(newCat)) {
          alert(' This category already exists!');
        } else {
          alert(' Please enter a category name.');
        }
      });
    }
    
    // Initialize category dropdown
    populateCategoryDropdown();
    
    // Add Product Form Submit Handler
    console.log('=== SETTING UP ADD PRODUCT HANDLER ===');
    console.log('addProductForm:', addProductForm);
    
    if (addProductForm) {
      console.log('Adding submit event listener to form');
      
      // Try to attach to button directly as well
      const addProductBtn = addProductForm.querySelector('button[type="submit"]');
      console.log('Add Product Button:', addProductBtn);
      
      if (addProductBtn) {
        addProductBtn.addEventListener('click', (e) => {
          console.log(' BUTTON CLICKED! ');
          e.preventDefault(); // Prevent default form submission
          
          // Get form values
          const productDateVal = document.getElementById('productDate').value;
          const productCategoryVal = document.getElementById('productCategory').value;
          const productNameVal = document.getElementById('productName').value;
          const productExpiryVal = document.getElementById('productExpiry').value;
          const productQtyVal = document.getElementById('productQty').value;
          const productStatusVal = document.getElementById('productStatus').value;
          
          console.log('Form values:', {
            date: productDateVal,
            category: productCategoryVal,
            name: productNameVal,
            expiry: productExpiryVal,
            qty: productQtyVal,
            status: productStatusVal
          });
          
          // Validation
          if (!productCategoryVal) {
            alert(' Please select a category');
            return;
          }
          
          if (!productNameVal.trim()) {
            alert(' Please enter a product name');
            return;
          }
          
          if (!productExpiryVal) {
            alert(' Please select an expiry date');
            return;
          }
          
          const newProduct = {
            product: productNameVal.trim(),
            category: productCategoryVal,
            expiry: productExpiryVal,
            stock: parseInt(productQtyVal) || 0,  // Use 'stock' not 'qty'
            dateAdded: productDateVal
          };
          
          console.log('Adding product:', newProduct);
          
          // Add to productsMaster array
          productsMaster.push(newProduct);
          console.log('Product added! Total products:', productsMaster.length);
          
          // Show success animation
          addProductBtn.disabled = true;
          addProductBtn.textContent = ' Adding...';
          addProductBtn.style.background = '#6b7280';
          
          setTimeout(() => {
            // Success state
            addProductBtn.textContent = ' Added!';
            addProductBtn.style.background = '#10b981';
            
            // Re-render inventory if on inventory page
            if (typeof renderInventoryProducts === 'function') {
              renderInventoryProducts();
            }
            
            // Update dashboard if needed
            if (typeof updateDashboardOverview === 'function') {
              updateDashboardOverview();
            }
            
            // Close modal after delay
            setTimeout(() => {
              addProductModal.classList.remove('active');
              addProductForm.reset();
              if (productDate) productDate.value = new Date().toISOString().split('T')[0];
              
              // Reset button
              addProductBtn.disabled = false;
              addProductBtn.textContent = 'Add Product';
              addProductBtn.style.background = '#2563eb';
            }, 1000);
            
          }, 500);
        });
      }
      
      addProductForm.addEventListener('submit', (e) => {
        console.log(' FORM SUBMITTED! ');
        e.preventDefault();
        
        const productDateVal = document.getElementById('productDate').value;
        const productCategoryVal = document.getElementById('productCategory').value;
        const productNameVal = document.getElementById('productName').value;
        const productExpiryVal = document.getElementById('productExpiry').value;
        const productQtyVal = document.getElementById('productQty').value;
        const productStatusVal = document.getElementById('productStatus').value;
        
        if (!productCategoryVal) {
          alert(' Please select a category');
          return;
        }
        
        if (!productNameVal.trim()) {
          alert(' Please enter a product name');
          return;
        }
        
        const newProduct = {
          product: productNameVal.trim(),
          category: productCategoryVal,
          expiry: productExpiryVal,
          qty: parseInt(productQtyVal) || 0,
          status: productStatusVal,
          dateAdded: productDateVal
        };
        
        console.log('Adding product:', newProduct);
        
        // Add to productsMaster array
        productsMaster.push(newProduct);
        
        // Show success animation
        const submitBtn = addProductForm.querySelector('button[type="submit"]');
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = ' Adding...';
          submitBtn.style.background = '#6b7280';
        }
        
        setTimeout(() => {
          // Success state
          if (submitBtn) {
            submitBtn.textContent = ' Added!';
            submitBtn.style.background = '#10b981';
          }
          
          // Re-render inventory if on inventory page
          if (typeof renderInventoryProducts === 'function') {
            renderInventoryProducts();
          }
          
          // Update dashboard if needed
          if (typeof updateDashboardOverview === 'function') {
            updateDashboardOverview();
          }
          
          console.log('Product added! Total products:', productsMaster.length);
          
          // Close modal after delay
          setTimeout(() => {
            addProductModal.classList.remove('active');
            addProductForm.reset();
            if (productDate) productDate.value = new Date().toISOString().split('T')[0];
            
            // Reset button
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.textContent = 'Add Product';
              submitBtn.style.background = '#2563eb';
            }
          }, 1000);
          
        }, 500);
      });
    }
    
    if (closeModal && addProductModal) {
      closeModal.addEventListener('click', () => {
        addProductModal.classList.remove('active');
        if (addProductForm) addProductForm.reset();
        if (productDate) productDate.value = new Date().toISOString().split('T')[0];
      });
    }
    
    if (cancelBtn && addProductModal) {
      cancelBtn.addEventListener('click', () => {
        addProductModal.classList.remove('active');
        if (addProductForm) addProductForm.reset();
        if (productDate) productDate.value = new Date().toISOString().split('T')[0];
      });
    }

    // === DASHBOARD INITIALIZATION ===
    // Removed from here - moved to after productsMaster is defined

    // === INVENTORY SYSTEM === (OLD - DISABLED)
    // Wrap in check to prevent errors since we're using new system
    if (document.getElementById('calendarViewBtn')) {
    const inventoryBody = document.getElementById('inventoryBody');
    const monthSelect = document.getElementById('monthSelect');
    const yearInput = document.getElementById('yearInput');
    const goDateBtn = document.getElementById('goDate');
    const searchInput = document.getElementById('searchProduct');
    const calendarViewBtn = document.getElementById('calendarViewBtn');
    const listViewBtn = document.getElementById('listViewBtn');
    const detailedViewBtn = document.getElementById('detailedViewBtn');
    const calendarViewContainer = document.getElementById('calendarViewContainer');
    const listViewContainer = document.getElementById('listViewContainer');
    const detailedViewContainer = document.getElementById('detailedViewContainer');
    const detailedInventoryBody = document.getElementById('detailedInventoryBody');
    const calendarHeader = document.getElementById('calendarHeader');
    const calendarDays = document.getElementById('calendarDays');
    const addProductBtn = document.getElementById('addProductBtn');
    const addProductModal = document.getElementById('addProductModal');
    const closeModal = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const addProductForm = document.getElementById('addProductForm');
    const productDate = document.getElementById('productDate');
    const productCategory = document.getElementById('productCategory');
    
    // Date navigation controls
    const currentDateDisplay = document.getElementById('currentDateDisplay');
    const dateValueDisplay = document.getElementById('dateValueDisplay');
    const prevDateBtn = document.getElementById('prevDateBtn');
    const nextDateBtn = document.getElementById('nextDateBtn');
    
    console.log('Button elements:', { prevDateBtn, nextDateBtn });
    
    if (!prevDateBtn || !nextDateBtn) {
      console.error('Navigation buttons not found in DOM!');
    }
    
    // Category Management
    const manageCategoriesBtn = document.getElementById('manageCategoriesBtn');
    const categoryModal = document.getElementById('categoryModal');
    const closeCategoryModal = document.getElementById('closeCategoryModal');
    const closeCategoryBtn = document.getElementById('closeCategoryBtn');
    const categoryList = document.getElementById('categoryList');
    const newCategoryInput = document.getElementById('newCategoryInput');
    const addCategoryBtn = document.getElementById('addCategoryBtn');

    let currentMonth = new Date().getMonth(); // Current month
    let currentYear = new Date().getFullYear(); // Current year
    let currentView = 'calendar';
    let selectedDate = null;
    let viewingSpecificDate = false; // Track if viewing specific date or full month
    
    // Categories array
    let categories = ['IV', 'TABS/CAPS', 'GALLON', 'BOX', 'PIECE'];

    // Sample inventory data
    let inventoryData = [
      { date: '2026-01-21', category: 'BOX', product: 'Surgical Gloves', batch: 'A101/2027-06', qty: 50, status: 'Available' },
      { date: '2026-01-21', category: 'PIECE', product: 'Syringe 5ml', batch: 'B201/2027-12', qty: 30, status: 'Low Stock' },
      { date: '2026-01-22', category: 'IV', product: 'Saline Solution', batch: 'C301/2026-08', qty: 100, status: 'Available' },
      { date: '2026-01-23', category: 'BOX', product: 'Bandages', batch: 'D401/2027-03', qty: 75, status: 'Available' },
      { date: '2026-01-23', category: 'BOX', product: 'Alcohol Swabs', batch: 'E501/2026-11', qty: 15, status: 'Low Stock' },
      { date: '2026-01-25', category: 'PIECE', product: 'Face Masks', batch: 'F601/2027-01', qty: 200, status: 'Available' },
      { date: '2026-01-28', category: 'BOX', product: 'Cotton Balls', batch: 'G701/2027-05', qty: 5, status: 'Out of Stock' },
      { date: '2026-01-21', category: 'TABS/CAPS', product: 'Paracetamol 500mg', batch: 'H801/2027-09', qty: 120, status: 'Available' },
      { date: '2026-01-22', category: 'GALLON', product: 'Distilled Water', batch: 'I901/2026-12', qty: 25, status: 'Available' },
      { date: '2026-01-23', category: 'IV', product: 'Dextrose 5%', batch: 'J101/2027-04', qty: 45, status: 'Low Stock' },
    ];

    // Set today's date in modal by default
    const today = new Date().toISOString().split('T')[0];
    productDate.value = today;
    
    // Stock Detail Modal elements
    const stockDetailModal = document.getElementById('stockDetailModal');
    const closeStockDetailModal = document.getElementById('closeStockDetailModal');
    const closeStockDetailBtn = document.getElementById('closeStockDetailBtn');
    const stockDetailTitle = document.getElementById('stockDetailTitle');
    const stockDetailBody = document.getElementById('stockDetailBody');
    
    // Update dashboard inventory overview
    function updateDashboardOverview() {
      // Dashboard inventory overview is now updated by updateStatusCounts()
      // This function remains for compatibility with period buttons
      if (typeof updateStatusCounts === 'function') {
        updateStatusCounts();
      }
    }
    
    // Show stock detail modal
    function showStockDetail(status) {
      const today = new Date();
      let filteredItems = [];
      
      // Filter by period
      if (currentPeriod === 'today') {
        const todayStr = today.toISOString().split('T')[0];
        filteredItems = inventoryData.filter(item => item.date === todayStr);
      } else if (currentPeriod === 'month') {
        const monthStart = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];
        const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0).toISOString().split('T')[0];
        filteredItems = inventoryData.filter(item => item.date >= monthStart && item.date <= monthEnd);
      } else if (currentPeriod === 'year') {
        const yearStart = new Date(today.getFullYear(), 0, 1).toISOString().split('T')[0];
        const yearEnd = new Date(today.getFullYear(), 11, 31).toISOString().split('T')[0];
        filteredItems = inventoryData.filter(item => item.date >= yearStart && item.date <= yearEnd);
      }
      
      let items;
      
      if (status === 'Expiring Soon') {
        // Get expiring items
        items = filteredItems.filter(item => {
          if (!item.batch) return false;
          const parts = item.batch.split('/');
          if (parts.length < 2) return false;
          const expiryParts = parts[1].split('-');
          if (expiryParts.length < 2) return false;
          
          const expiryYear = parseInt(expiryParts[0]);
          const expiryMonth = parseInt(expiryParts[1]) - 1;
          const expiryDate = new Date(expiryYear, expiryMonth, 1);
          
          const diffTime = expiryDate - today;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          
          return diffDays <= 30 && diffDays >= 0;
        });
      } else {
        items = filteredItems.filter(item => item.status === status);
      }
      
      const periodText = currentPeriod === 'today' ? 'Today' : 
                        currentPeriod === 'month' ? 'This Month' : 'This Year';
      
      if (items.length === 0) {
        stockDetailTitle.textContent = `${status} - ${periodText}`;
        stockDetailBody.innerHTML = `
          <div class="empty-state" style="padding: 2rem;">
            <div class="empty-state-icon"></div>
            <p>No items with "${status}" status in ${periodText.toLowerCase()}</p>
          </div>
        `;
      } else {
        stockDetailTitle.textContent = `${status} - ${periodText}`;
        
        // Group by category
        const grouped = {};
        items.forEach(item => {
          if (!grouped[item.category]) grouped[item.category] = [];
          grouped[item.category].push(item);
        });
        
        let html = '';
        Object.keys(grouped).sort().forEach(category => {
          html += `
            <div class="stock-detail-category">
              <div class="stock-category-header">${category}</div>
          `;
          
          grouped[category].forEach(item => {
            html += `
              <div class="stock-item">
                <div class="stock-item-name">${item.product}</div>
                <div class="stock-item-details">
                  <div class="stock-item-detail">
                    <strong>Date:</strong> <span>${item.date}</span>
                  </div>
                  <div class="stock-item-detail">
                    <strong>Batch:</strong> <span>${item.batch}</span>
                  </div>
                  <div class="stock-item-detail">
                    <strong>Qty:</strong> <span>${item.qty}</span>
                  </div>
                  <div class="stock-item-detail">
                    <strong>Status:</strong> <span>${item.status}</span>
                  </div>
                </div>
              </div>
            `;
          });
          
          html += `</div>`;
        });
        
        // Add summary
        const totalQty = items.reduce((sum, item) => sum + item.qty, 0);
        html += `
          <div class="stock-summary">
            <div class="stock-summary-title">Summary</div>
            <div><span>Total Items</span><span>${items.length}</span></div>
            <div><span>Total Quantity</span><span>${totalQty}</span></div>
          </div>
        `;
        
        stockDetailBody.innerHTML = html;
      }
      
      stockDetailModal.classList.add('active');
    }
    
    // Close stock detail modal
    closeStockDetailModal.addEventListener('click', () => {
      stockDetailModal.classList.remove('active');
    });
    
    closeStockDetailBtn.addEventListener('click', () => {
      stockDetailModal.classList.remove('active');
    });
    
    // Add click/touch handlers to overview cards
    document.querySelectorAll('.overview-card').forEach(card => {
      let touchTimer;
      let touchStarted = false;
      
      // Desktop: Double-click
      card.addEventListener('dblclick', () => {
        const status = card.dataset.status;
        showStockDetail(status);
      });
      
      // Mobile: Touch and hold
      card.addEventListener('touchstart', (e) => {
        touchStarted = true;
        card.classList.add('pressing');
        touchTimer = setTimeout(() => {
          const status = card.dataset.status;
          card.classList.remove('pressing');
          showStockDetail(status);
          if (navigator.vibrate) {
            navigator.vibrate(50);
          }
        }, 500);
      });
      
      card.addEventListener('touchend', () => {
        clearTimeout(touchTimer);
        card.classList.remove('pressing');
        setTimeout(() => { touchStarted = false; }, 100);
      });
      
      card.addEventListener('touchmove', () => {
        clearTimeout(touchTimer);
        card.classList.remove('pressing');
      });
    });
    
    // Update date display in list view
    function updateDateDisplay() {
      const dateValueEl = document.getElementById('dateValueDisplay');
      
      if (viewingSpecificDate && selectedDate) {
        const date = new Date(selectedDate + 'T00:00:00');
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        dateValueEl.textContent = date.toLocaleDateString('en-US', options);
      } else {
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];
        dateValueEl.textContent = `${monthNames[currentMonth]} ${currentYear}`;
      }
    }
    
    // Navigate to previous date
    window.handlePrevDate = function() {
      console.log('handlePrevDate called', { viewingSpecificDate, selectedDate, currentMonth, currentYear });
      
      if (viewingSpecificDate && selectedDate) {
        // Navigate to previous day
        const parts = selectedDate.split('-');
        const year = parseInt(parts[0]);
        const month = parseInt(parts[1]) - 1;
        const day = parseInt(parts[2]);
        
        const date = new Date(year, month, day);
        date.setDate(date.getDate() - 1);
        
        const newYear = date.getFullYear();
        const newMonth = String(date.getMonth() + 1).padStart(2, '0');
        const newDay = String(date.getDate()).padStart(2, '0');
        selectedDate = `${newYear}-${newMonth}-${newDay}`;
        
        // Update month/year if crossing month boundary
        currentMonth = date.getMonth();
        currentYear = date.getFullYear();
        monthSelect.value = currentMonth;
        yearInput.value = currentYear;
        
        console.log('Moving to previous day:', selectedDate);
        updateDateDisplay();
        renderListViewForDate(selectedDate);
      } else {
        // Navigate to previous month
        if (currentMonth === 0) {
          currentMonth = 11;
          currentYear--;
        } else {
          currentMonth--;
        }
        
        monthSelect.value = currentMonth;
        yearInput.value = currentYear;
        
        console.log('Moving to previous month:', currentMonth, currentYear);
        updateDateDisplay();
        renderListView();
      }
    };
    
    // Navigate to next date
    window.handleNextDate = function() {
      console.log('handleNextDate called', { viewingSpecificDate, selectedDate, currentMonth, currentYear });
      
      if (viewingSpecificDate && selectedDate) {
        // Navigate to next day
        const parts = selectedDate.split('-');
        const year = parseInt(parts[0]);
        const month = parseInt(parts[1]) - 1;
        const day = parseInt(parts[2]);
        
        const date = new Date(year, month, day);
        date.setDate(date.getDate() + 1);
        
        const newYear = date.getFullYear();
        const newMonth = String(date.getMonth() + 1).padStart(2, '0');
        const newDay = String(date.getDate()).padStart(2, '0');
        selectedDate = `${newYear}-${newMonth}-${newDay}`;
        
        // Update month/year if crossing month boundary
        currentMonth = date.getMonth();
        currentYear = date.getFullYear();
        monthSelect.value = currentMonth;
        yearInput.value = currentYear;
        
        console.log('Moving to next day:', selectedDate);
        updateDateDisplay();
        renderListViewForDate(selectedDate);
      } else {
        // Navigate to next month
        if (currentMonth === 11) {
          currentMonth = 0;
          currentYear++;
        } else {
          currentMonth++;
        }
        
        monthSelect.value = currentMonth;
        yearInput.value = currentYear;
        
        console.log('Moving to next month:', currentMonth, currentYear);
        updateDateDisplay();
        renderListView();
      }
    };
    
    // Populate category dropdown
    function populateCategoryDropdown() {
      productCategory.innerHTML = '<option value="">Select Category</option>';
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        productCategory.appendChild(option);
      });
    }
    
    // Render category list in management modal
    function renderCategoryList() {
      categoryList.innerHTML = categories.map((cat, index) => `
        <div class="category-item">
          <input type="text" value="${cat}" id="cat-${index}" disabled>
          <div class="category-item-actions">
            <button class="btn-icon edit" onclick="editCategory(${index})"></button>
            <button class="btn-icon delete" onclick="deleteCategory(${index})"></button>
          </div>
        </div>
      `).join('');
    }
    
    // Edit category
    window.editCategory = function(index) {
      const input = document.getElementById(`cat-${index}`);
      const isDisabled = input.disabled;
      
      if (isDisabled) {
        input.disabled = false;
        input.focus();
        input.select();
      } else {
        const newName = input.value.trim();
        if (newName && newName !== categories[index]) {
          // Update category name in inventory data
          const oldName = categories[index];
          inventoryData.forEach(item => {
            if (item.category === oldName) {
              item.category = newName;
            }
          });
          categories[index] = newName;
          categories.sort();
          populateCategoryDropdown();
          renderCategoryList();
          
          // Refresh view if needed
          if (currentView === 'list') {
            renderListView();
          } else {
            renderCalendar();
          }
        }
        input.disabled = true;
      }
    };
    
    // Delete category
    window.deleteCategory = function(index) {
      const categoryToDelete = categories[index];
      const itemsInCategory = inventoryData.filter(item => item.category === categoryToDelete).length;
      
      if (itemsInCategory > 0) {
        if (!confirm(`There are ${itemsInCategory} product(s) in "${categoryToDelete}". Delete anyway?`)) {
          return;
        }
      }
      
      categories.splice(index, 1);
      populateCategoryDropdown();
      renderCategoryList();
      
      // Refresh view if needed
      if (currentView === 'list') {
        renderListView();
      }
    };
    
    // Add new category
    addCategoryBtn.addEventListener('click', () => {
      const newCategory = newCategoryInput.value.trim().toUpperCase();
      
      if (!newCategory) {
        alert('Please enter a category name');
        return;
      }
      
      if (categories.includes(newCategory)) {
        alert('Category already exists');
        return;
      }
      
      categories.push(newCategory);
      categories.sort();
      newCategoryInput.value = '';
      populateCategoryDropdown();
      renderCategoryList();
    });
    
    // Category modal controls
    manageCategoriesBtn.addEventListener('click', () => {
      renderCategoryList();
      categoryModal.classList.add('active');
    });
    
    closeCategoryModal.addEventListener('click', () => {
      categoryModal.classList.remove('active');
    });
    
    closeCategoryBtn.addEventListener('click', () => {
      categoryModal.classList.remove('active');
    });
    
    // Initialize category dropdown
    populateCategoryDropdown();

    // View Toggle
    calendarViewBtn.addEventListener('click', () => {
      currentView = 'calendar';
      viewingSpecificDate = false;
      calendarViewBtn.classList.add('active');
      listViewBtn.classList.remove('active');
      detailedViewBtn.classList.remove('active');
      calendarViewContainer.style.display = 'block';
      listViewContainer.classList.remove('active');
      detailedViewContainer.classList.remove('active');
      renderCalendar();
    });

    listViewBtn.addEventListener('click', () => {
      // Only switch if not already in list view
      if (currentView !== 'list') {
        currentView = 'list';
        listViewBtn.classList.add('active');
        calendarViewBtn.classList.remove('active');
        detailedViewBtn.classList.remove('active');
        calendarViewContainer.style.display = 'none';
        listViewContainer.classList.add('active');
        detailedViewContainer.classList.remove('active');
        
        // If a date was selected in calendar, show that specific date in list view
        if (selectedDate) {
          viewingSpecificDate = true;
          updateDateDisplay();
          renderListViewForDate(selectedDate);
        } else {
          // Otherwise show the full month
          viewingSpecificDate = false;
          updateDateDisplay();
          renderListView();
        }
      }
    });
    
    detailedViewBtn.addEventListener('click', () => {
      currentView = 'detailed';
      viewingSpecificDate = false;
      detailedViewBtn.classList.add('active');
      calendarViewBtn.classList.remove('active');
      listViewBtn.classList.remove('active');
      calendarViewContainer.style.display = 'none';
      listViewContainer.classList.remove('active');
      detailedViewContainer.classList.add('active');
      renderDetailedView();
    });

    // Month/Year Selection
    goDateBtn.addEventListener('click', () => {
      currentMonth = parseInt(monthSelect.value);
      currentYear = parseInt(yearInput.value) || 2026;
      
      // Reset to month view when using Go button - this shows entire month
      viewingSpecificDate = false;
      selectedDate = null;
      
      if (currentView === 'calendar') {
        renderCalendar();
      } else {
        // In list view, show entire month
        updateDateDisplay();
        renderListView();
      }
    });

    // Update calendar when month or year changes
    monthSelect.addEventListener('change', () => {
      currentMonth = parseInt(monthSelect.value);
      
      // When changing month dropdown, clear specific date and show month view
      viewingSpecificDate = false;
      selectedDate = null;
      
      if (currentView === 'calendar') {
        renderCalendar();
      } else {
        updateDateDisplay();
        renderListView();
      }
    });

    yearInput.addEventListener('change', () => {
      currentYear = parseInt(yearInput.value) || 2026;
      
      // When changing year, clear specific date and show month view
      viewingSpecificDate = false;
      selectedDate = null;
      
      if (currentView === 'calendar') {
        renderCalendar();
      } else {
        updateDateDisplay();
        renderListView();
      }
    });

    // Search
    searchInput.addEventListener('input', () => {
      if (currentView === 'list') {
        renderListView();
      }
    });

    // Modal Controls
    addProductBtn.addEventListener('click', () => {
      addProductModal.classList.add('active');
    });

    // Add Product Form Submit
    addProductForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const newProduct = {
        date: document.getElementById('productDate').value,
        category: document.getElementById('productCategory').value,
        product: document.getElementById('productName').value,
        batch: document.getElementById('productBatch').value,
        qty: parseInt(document.getElementById('productQty').value),
        status: document.getElementById('productStatus').value
      };
      
      inventoryData.push(newProduct);
      inventoryData.sort((a, b) => {
        const dateCompare = new Date(a.date) - new Date(b.date);
        if (dateCompare !== 0) return dateCompare;
        return a.category.localeCompare(b.category);
      });
      
      addProductModal.classList.remove('active');
      addProductForm.reset();
      productDate.value = today;
      
      // Update views
      if (currentView === 'calendar') {
        renderCalendar();
      } else {
        renderListView();
      }
      
      // Update dashboard overview
      updateDashboardOverview();
    });

    // Render Calendar View
    function renderCalendar() {
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                         'July', 'August', 'September', 'October', 'November', 'December'];
      
      calendarHeader.textContent = `${monthNames[currentMonth]} ${currentYear}`;
      
      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      const prevMonthDays = new Date(currentYear, currentMonth, 0).getDate();
      
      let html = '';
      
      // Previous month days
      for (let i = firstDay - 1; i >= 0; i--) {
        html += `<div class="calendar-day other-month">
          <div class="day-number">${prevMonthDays - i}</div>
        </div>`;
      }
      
      // Current month days
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayItems = inventoryData.filter(item => item.date === dateStr);
        const isSelected = selectedDate === dateStr;
        
        html += `<div class="calendar-day ${isSelected ? 'selected' : ''}" data-date="${dateStr}">
          <div class="day-number">${day}</div>
          <div class="day-items">
            ${dayItems.length > 0 ? `<span class="day-badge">${dayItems.length} item${dayItems.length > 1 ? 's' : ''}</span>` : ''}
          </div>
        </div>`;
      }
      
      // Next month days
      const totalCells = firstDay + daysInMonth;
      const remainingCells = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7);
      for (let i = 1; i <= remainingCells; i++) {
        html += `<div class="calendar-day other-month">
          <div class="day-number">${i}</div>
        </div>`;
      }
      
      calendarDays.innerHTML = html;
      
      // Add click handlers to calendar days
      document.querySelectorAll('.calendar-day:not(.other-month)').forEach(day => {
        let touchTimer;
        let touchStarted = false;
        
        // Single click - just select/highlight
        day.addEventListener('click', (e) => {
          if (!touchStarted) {
            selectedDate = day.dataset.date;
            renderCalendar();
          }
        });
        
        // Touch and hold for mobile
        day.addEventListener('touchstart', (e) => {
          touchStarted = true;
          day.classList.add('pressing');
          touchTimer = setTimeout(() => {
            selectedDate = day.dataset.date;
            day.classList.remove('pressing');
            renderCalendar();
            showDayDetails(selectedDate);
            // Haptic feedback if available
            if (navigator.vibrate) {
              navigator.vibrate(50);
            }
          }, 500); // Hold for 500ms
        });
        
        day.addEventListener('touchend', () => {
          clearTimeout(touchTimer);
          day.classList.remove('pressing');
          setTimeout(() => { touchStarted = false; }, 100);
        });
        
        day.addEventListener('touchmove', () => {
          clearTimeout(touchTimer);
          day.classList.remove('pressing');
        });
        
        // Double-click to go to list view for that date
        day.addEventListener('dblclick', () => {
          selectedDate = day.dataset.date;
          viewingSpecificDate = true;
          currentView = 'list';
          listViewBtn.classList.add('active');
          calendarViewBtn.classList.remove('active');
          calendarViewContainer.style.display = 'none';
          listViewContainer.classList.add('active');
          updateDateDisplay();
          renderListViewForDate(selectedDate);
        });
      });
    }

    // Show day details when Enter is pressed (Desktop)
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && selectedDate && currentView === 'calendar') {
        showDayDetails(selectedDate);
      }
    });

    // Show day details when Enter is pressed (Low Stock and Out of Stock only)
    function showDayDetails(dateStr) {
      const items = inventoryData.filter(item => item.date === dateStr);
      
      // Filter only Low Stock and Out of Stock items
      const criticalItems = items.filter(item => 
        item.status === 'Low Stock' || item.status === 'Out of Stock'
      );
      
      // Format the date for display
      const dateObj = new Date(dateStr + 'T00:00:00');
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const formattedDate = dateObj.toLocaleDateString('en-US', options);
      
      if (criticalItems.length === 0) {
        stockDetailTitle.textContent = `Stock Alert - ${formattedDate}`;
        stockDetailBody.innerHTML = `
          <div class="empty-state" style="padding: 2rem;">
            <div class="empty-state-icon" style="font-size: 3rem;"></div>
            <h3>All Good!</h3>
            <p>All inventory items are in good stock on this date</p>
          </div>
        `;
        stockDetailModal.classList.add('active');
        return;
      }
      
      // Group by category
      const grouped = {};
      criticalItems.forEach(item => {
        if (!grouped[item.category]) grouped[item.category] = [];
        grouped[item.category].push(item);
      });
      
      let lowStockCount = 0;
      let outOfStockCount = 0;
      
      let html = '';
      Object.keys(grouped).sort().forEach(category => {
        html += `
          <div class="stock-detail-category">
            <div class="stock-category-header">${category}</div>
        `;
        
        grouped[category].forEach(item => {
          const icon = item.status === 'Out of Stock' ? '' : '';
          
          html += `
            <div class="stock-item">
              <div class="stock-item-name">${icon} ${item.product}</div>
              <div class="stock-item-details">
                <div class="stock-item-detail">
                  <strong>Batch:</strong> <span>${item.batch}</span>
                </div>
                <div class="stock-item-detail">
                  <strong>Qty:</strong> <span>${item.qty}</span>
                </div>
                <div class="stock-item-detail">
                  <strong>Status:</strong> <span style="color: ${item.status === 'Out of Stock' ? '#ef4444' : '#f59e0b'};">${item.status}</span>
                </div>
              </div>
            </div>
          `;
          
          if (item.status === 'Low Stock') lowStockCount++;
          if (item.status === 'Out of Stock') outOfStockCount++;
        });
        
        html += `</div>`;
      });
      
      // Add summary
      html += `
        <div class="stock-summary">
          <div class="stock-summary-title">Summary</div>
          ${lowStockCount > 0 ? `<div><span> Low Stock</span><span>${lowStockCount} item(s)</span></div>` : ''}
          ${outOfStockCount > 0 ? `<div><span> Out of Stock</span><span>${outOfStockCount} item(s)</span></div>` : ''}
        </div>
      `;
      
      stockDetailTitle.textContent = ` Stock Alert - ${formattedDate}`;
      stockDetailBody.innerHTML = html;
      stockDetailModal.classList.add('active');
    }

    // Render List View
    function renderListView() {
      const search = searchInput.value.toLowerCase();
      
      // Update display to show "Results" if searching
      if (search) {
        const dateValueEl = document.getElementById('dateValueDisplay');
        dateValueEl.textContent = 'Search Results';
      } else {
        updateDateDisplay();
      }
      
      const monthStart = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-01`;
      const monthEnd = `${currentYear}-${String(currentMonth + 2).padStart(2, '0')}-01`;
      
      let filtered = inventoryData.filter(item => {
        const itemDate = item.date;
        return itemDate >= monthStart && itemDate < monthEnd;
      });
      
      if (search) {
        filtered = filtered.filter(item => 
          item.product.toLowerCase().includes(search) ||
          item.batch.toLowerCase().includes(search) ||
          item.category.toLowerCase().includes(search)
        );
      }
      
      if (filtered.length === 0) {
        inventoryBody.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon"></div>
            <h3>No inventory found</h3>
            <p>Try adjusting your filters or add new products</p>
          </div>
        `;
        return;
      }
      
      // Group by category
      const groupedByCategory = {};
      filtered.forEach(item => {
        if (!groupedByCategory[item.category]) {
          groupedByCategory[item.category] = [];
        }
        groupedByCategory[item.category].push(item);
      });
      
      // Sort categories
      const categories = Object.keys(groupedByCategory).sort();
      
      let html = '';
      categories.forEach(category => {
        const items = groupedByCategory[category];
        html += `
          <div class="category-section">
            <div class="category-title">
              <span>${category}</span>
              <span class="category-count">${items.length} item${items.length > 1 ? 's' : ''}</span>
            </div>
            <div class="category-items">
        `;
        
        items.forEach(item => {
          const statusClass = item.status === 'Available' ? 'status-available' : 
                             item.status === 'Low Stock' ? 'status-low' : 'status-out';
          html += `
            <div class="inventory-card">
              <div class="card-field">
                <div class="card-label">Product Name</div>
                <div class="card-value product-name">${item.product}</div>
              </div>
              <div class="card-field">
                <div class="card-label">Batch / Expiry</div>
                <div class="card-value">${item.batch}</div>
              </div>
              <div class="card-field">
                <div class="card-label">Quantity</div>
                <div class="card-value">${item.qty}</div>
              </div>
              <div class="card-field">
                <div class="card-label">Status</div>
                <div class="status-badge ${statusClass}">${item.status}</div>
              </div>
            </div>
          `;
        });
        
        html += `
            </div>
          </div>
        `;
      });
      
      inventoryBody.innerHTML = html;
    }

    // Render List View for specific date
    function renderListViewForDate(dateStr) {
      const search = searchInput.value.toLowerCase();
      
      // Update display to show "Results" if searching
      if (search) {
        const dateValueEl = document.getElementById('dateValueDisplay');
        dateValueEl.textContent = 'Search Results';
      } else {
        updateDateDisplay();
      }
      
      let filtered = inventoryData.filter(item => item.date === dateStr);
      
      if (search) {
        filtered = filtered.filter(item => 
          item.product.toLowerCase().includes(search) ||
          item.batch.toLowerCase().includes(search) ||
          item.category.toLowerCase().includes(search)
        );
      }
      
      if (filtered.length === 0) {
        inventoryBody.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon"></div>
            <h3>No inventory for ${dateStr}</h3>
            <p>No products found for this date</p>
          </div>
        `;
        return;
      }
      
      // Group by category
      const groupedByCategory = {};
      filtered.forEach(item => {
        if (!groupedByCategory[item.category]) {
          groupedByCategory[item.category] = [];
        }
        groupedByCategory[item.category].push(item);
      });
      
      // Sort categories
      const categories = Object.keys(groupedByCategory).sort();
      
      let html = '';
      categories.forEach(category => {
        const items = groupedByCategory[category];
        html += `
          <div class="category-section">
            <div class="category-title">
              <span>${category}</span>
              <span class="category-count">${items.length} item${items.length > 1 ? 's' : ''}</span>
            </div>
            <div class="category-items">
        `;
        
        items.forEach(item => {
          const statusClass = item.status === 'Available' ? 'status-available' : 
                             item.status === 'Low Stock' ? 'status-low' : 'status-out';
          html += `
            <div class="inventory-card">
              <div class="card-field">
                <div class="card-label">Product Name</div>
                <div class="card-value product-name">${item.product}</div>
              </div>
              <div class="card-field">
                <div class="card-label">Batch / Expiry</div>
                <div class="card-value">${item.batch}</div>
              </div>
              <div class="card-field">
                <div class="card-label">Quantity</div>
                <div class="card-value">${item.qty}</div>
              </div>
              <div class="card-field">
                <div class="card-label">Status</div>
                <div class="status-badge ${statusClass}">${item.status}</div>
              </div>
            </div>
          `;
        });
        
        html += `
            </div>
          </div>
        `;
      });
      
      inventoryBody.innerHTML = html;
    }
    
    // Render Detailed View
    function renderDetailedView() {
      // Get all inventory data sorted by date (newest first)
      const sortedData = [...inventoryData].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      if (sortedData.length === 0) {
        detailedInventoryBody.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon"></div>
            <h3>No inventory data</h3>
            <p>Add products to see detailed information</p>
          </div>
        `;
        return;
      }
      
      let html = `
        <table>
          <thead>
            <tr>
              <th data-short="Date"><div>Date</div></th>
              <th data-short="Product"><div>Product</div></th>
              <th data-short="Cat."><div>Category</div></th>
              <th data-short="Batch"><div>Batch</div></th>
              <th data-short="Qty"><div>Quantity</div></th>
              <th data-short="Status"><div>Status</div></th>
            </tr>
          </thead>
          <tbody>
      `;
      
      sortedData.forEach(item => {
        // Determine status class
        let statusClass = 'available';
        if (item.status === 'Low Stock') statusClass = 'low';
        else if (item.status === 'Out of Stock') statusClass = 'out';
        else if (item.status === 'Expiring Soon') statusClass = 'expiring';
        
        html += `
          <tr>
            <td data-label="Date">${item.date}</td>
            <td data-label="Product">${item.product}</td>
            <td data-label="Category"><span class="category-tag">${item.category}</span></td>
            <td data-label="Batch">${item.batch}</td>
            <td data-label="Quantity">${item.qty}</td>
            <td data-label="Status"><span class="status-badge ${statusClass}">${item.status}</span></td>
          </tr>
        `;
      });
      
      html += `
          </tbody>
        </table>
      `;
      
      detailedInventoryBody.innerHTML = html;
    }

    // Initialize
    monthSelect.value = currentMonth;
    yearInput.value = currentYear;
    renderCalendar();
    updateDashboardOverview();
    updateDashboardData('today');
    
    // Initialize role after everything else is set up
    setTimeout(() => {
      updateUIForRole('owner');
    }, 100);

    // === JOURNALS PAGE FUNCTIONALITY ===
    
    // Product Database
    const journalProductDatabase = {
      'Medicine': [
        { name: 'Paracetamol', price: 5 },
        { name: 'Ibuprofen', price: 8 },
        { name: 'Amoxicillin', price: 15 },
        { name: 'Cetirizine', price: 6 },
        { name: 'Vitamin C', price: 10 },
        { name: 'Cough Syrup', price: 25 }
      ],
      'PPE': [
        { name: 'Face Mask', price: 10 },
        { name: 'N95 Mask', price: 50 },
        { name: 'Gloves', price: 5 },
        { name: 'Face Shield', price: 30 },
        { name: 'Gown', price: 100 },
        { name: 'Hair Cap', price: 3 }
      ],
      'Supplies': [
        { name: 'Syringe', price: 8 },
        { name: 'Bandage', price: 15 },
        { name: 'Cotton', price: 20 },
        { name: 'Gauze', price: 25 },
        { name: 'Tape', price: 12 },
        { name: 'IV Catheter', price: 40 }
      ],
      'Equipment': [
        { name: 'Thermometer', price: 200 },
        { name: 'BP Monitor', price: 1500 },
        { name: 'Stethoscope', price: 800 },
        { name: 'Oximeter', price: 500 },
        { name: 'Nebulizer', price: 2000 }
      ],
      'Hygiene': [
        { name: 'Alcohol', price: 100 },
        { name: 'Hand Soap', price: 50 },
        { name: 'Sanitizer', price: 80 },
        { name: 'Wet Wipes', price: 60 },
        { name: 'Tissue', price: 30 }
      ],
      'Other': [
        { name: 'Water Bottle', price: 20 },
        { name: 'Bedpan', price: 150 },
        { name: 'Urinal', price: 120 },
        { name: 'Ice Pack', price: 50 },
        { name: 'Hot Pack', price: 50 }
      ]
    };

    // Journal State
    let journalCurrentItems = [];
    let journalCurrentQuantity = 1;
    let journalSelectedCategory = null;
    let journalSelectedProduct = null;
    let journalRecentReceipts = [];

    // Journal Elements
    const journalNurseName = document.getElementById('journalNurseName');
    const journalCurrentTime = document.getElementById('journalCurrentTime');
    const journalPatientNameInput = document.getElementById('journalPatientName');
    const journalItemsList = document.getElementById('journalItemsList');
    const journalSelectionTitle = document.getElementById('journalSelectionTitle');
    const journalCategoryGrid = document.getElementById('journalCategoryGrid');
    const journalProductGrid = document.getElementById('journalProductGrid');
    const journalQtyDisplay = document.getElementById('journalQtyDisplay');
    const journalDecreaseQtyBtn = document.getElementById('journalDecreaseQty');
    const journalIncreaseQtyBtn = document.getElementById('journalIncreaseQty');
    const journalAddItemBtn = document.getElementById('journalAddItemBtn');
    const journalOkBtn = document.getElementById('journalOkBtn');
    const journalRecentBtn = document.getElementById('journalRecentBtn');
    const journalRecentModal = document.getElementById('journalRecentModal');
    const closeJournalRecentModal = document.getElementById('closeJournalRecentModal');
    const journalRecentModalBody = document.getElementById('journalRecentModalBody');
    const journalPreviewModal = document.getElementById('journalPreviewModal');
    const closeJournalPreviewModal = document.getElementById('closeJournalPreviewModal');
    const journalPreviewModalBody = document.getElementById('journalPreviewModalBody');

    // Update Journal Time
    function updateJournalTime() {
      const now = new Date();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const year = String(now.getFullYear()).slice(-2);
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      journalCurrentTime.textContent = `${month}/${day}/${year} - ${hours}:${minutes}`;
    }
    
    // Update nurse name from current user
    function updateJournalNurseName() {
      const currentUserName = document.getElementById('userName').textContent;
      journalNurseName.textContent = currentUserName;
    }

    updateJournalTime();
    updateJournalNurseName();
    setInterval(updateJournalTime, 60000);

    // Category Selection
    journalCategoryGrid.addEventListener('click', (e) => {
      const btn = e.target.closest('.journal-grid-btn');
      if (!btn) return;

      journalSelectedCategory = btn.dataset.category;
      showJournalProducts(journalSelectedCategory);
    });

    // Show Products
    function showJournalProducts(category) {
      journalCategoryGrid.classList.add('journal-hidden');
      journalProductGrid.classList.remove('journal-hidden');
      journalSelectionTitle.textContent = `Select ${category}`;

      const products = journalProductDatabase[category] || [];
      let html = '<button class="journal-back-to-category"> Back to Categories</button>';

      products.forEach(product => {
        html += `
          <button class="journal-grid-btn" data-product='${JSON.stringify(product)}'>
            <span class="journal-product-name">${product.name}</span>
            <span class="journal-product-price">${product.price}</span>
          </button>
        `;
      });

      journalProductGrid.innerHTML = html;

      // Back button
      journalProductGrid.querySelector('.journal-back-to-category').addEventListener('click', backToJournalCategories);

      // Product selection
      journalProductGrid.querySelectorAll('.journal-grid-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          journalProductGrid.querySelectorAll('.journal-grid-btn').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          journalSelectedProduct = JSON.parse(btn.dataset.product);
          journalAddItemBtn.disabled = false;
        });
      });
    }

    // Back to Categories
    function backToJournalCategories() {
      journalProductGrid.classList.add('journal-hidden');
      journalCategoryGrid.classList.remove('journal-hidden');
      journalSelectionTitle.textContent = 'Select Category';
      journalSelectedProduct = null;
      journalAddItemBtn.disabled = true;
    }

    // Quantity Controls
    journalDecreaseQtyBtn.addEventListener('click', () => {
      if (journalCurrentQuantity > 1) {
        journalCurrentQuantity--;
        journalQtyDisplay.textContent = journalCurrentQuantity;
      }
    });

    journalIncreaseQtyBtn.addEventListener('click', () => {
      journalCurrentQuantity++;
      journalQtyDisplay.textContent = journalCurrentQuantity;
    });

    // Add Item
    journalAddItemBtn.addEventListener('click', () => {
      if (!journalSelectedProduct) return;

      const item = {
        name: journalSelectedProduct.name,
        price: journalSelectedProduct.price,
        quantity: journalCurrentQuantity,
        total: journalSelectedProduct.price * journalCurrentQuantity
      };

      journalCurrentItems.push(item);
      renderJournalItems();
      
      // Reset selection
      journalCurrentQuantity = 1;
      journalQtyDisplay.textContent = journalCurrentQuantity;
      journalSelectedProduct = null;
      journalAddItemBtn.disabled = true;
      backToJournalCategories();
      
      // Enable OK button
      journalOkBtn.disabled = false;

      // Animation
      journalItemsList.classList.add('journal-success-animation');
      setTimeout(() => journalItemsList.classList.remove('journal-success-animation'), 300);
    });

    // Render Items
    function renderJournalItems() {
      if (journalCurrentItems.length === 0) {
        journalItemsList.innerHTML = '<div class="journal-empty-inline">No items  Tap category to start</div>';
        return;
      }

      let html = '';
      let grandTotal = 0;

      journalCurrentItems.forEach(item => {
        html += `
          <div class="journal-item-compact">
            <div class="journal-item-left">
              <div class="journal-item-name">${item.name}</div>
              <div class="journal-item-details">${item.quantity}  ${item.price}</div>
            </div>
            <div class="journal-item-total">${item.total}</div>
          </div>
        `;
        grandTotal += item.total;
      });

      html += `
        <div class="journal-item-compact" style="border-top: 2px solid #e5e7eb; margin-top: 0.5rem; padding-top: 0.5rem;">
          <div class="journal-item-left">
            <div class="journal-item-name" style="font-weight: 700;">TOTAL</div>
          </div>
          <div class="journal-item-total" style="font-size: 1rem;">${grandTotal}</div>
        </div>
      `;

      journalItemsList.innerHTML = html;
    }

    // Save Receipt
    journalOkBtn.addEventListener('click', () => {
      const patientName = journalPatientNameInput.value.trim();
      
      if (!patientName) {
        alert('Please enter patient name');
        journalPatientNameInput.focus();
        return;
      }

      if (journalCurrentItems.length === 0) {
        alert('Please add at least one item');
        return;
      }

      const totalAmount = journalCurrentItems.reduce((sum, item) => sum + item.total, 0);
      const currentNurseName = document.getElementById('userName').textContent;

      const receipt = {
        id: Date.now(),
        nurse: currentNurseName,
        patient: patientName,
        items: [...journalCurrentItems],
        total: totalAmount,
        timestamp: new Date().toLocaleString()
      };

      journalRecentReceipts.unshift(receipt);
      
      // **NEW: Add to sales records**
      const salesRecord = {
        id: Date.now(),
        timestamp: new Date().toISOString().replace('T', ' ').substring(0, 19),
        patient: patientName,
        nurse: currentNurseName,
        items: journalCurrentItems.map(item => ({
          name: item.name,
          category: 'Medicine', // You can enhance this by tracking category
          quantity: item.quantity,
          price: item.price
        })),
        total: totalAmount
      };
      
      if (typeof salesRecords !== 'undefined') {
        salesRecords.unshift(salesRecord);
      }
      
      // Clear form
      journalPatientNameInput.value = '';
      journalCurrentItems = [];
      renderJournalItems();
      journalOkBtn.disabled = true;

      // Show success
      alert('Receipt saved and queued for printing!');
      
      // Show recent modal
      showJournalRecentModal();
    });

    // Recent Button
    journalRecentBtn.addEventListener('click', showJournalRecentModal);

    // Show Recent Modal
    function showJournalRecentModal() {
      if (journalRecentReceipts.length === 0) {
        journalRecentModalBody.innerHTML = '<div class="journal-empty">No receipts in queue</div>';
      } else {
        let html = '<div style="display: flex; flex-direction: column; gap: 0.75rem;">';
        journalRecentReceipts.forEach(receipt => {
          const itemsText = receipt.items.map(item => `${item.name} (${item.quantity})`).join(', ');
          html += `
            <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; border: 2px solid #e5e7eb; cursor: pointer;" onclick="showJournalReceiptPreview(${receipt.id})">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <span style="font-weight: 600; color: #111827;">${receipt.patient}</span>
                <span style="font-size: 0.8rem; color: #6b7280;">${receipt.timestamp}</span>
              </div>
              <div style="font-size: 0.85rem; color: #6b7280;">${itemsText}</div>
              <div style="font-weight: 600; color: #111827; margin-top: 0.5rem;">Total: ${receipt.total}</div>
              <button onclick="event.stopPropagation(); printJournalReceipt(${receipt.id})" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 0.85rem; font-weight: 600; cursor: pointer; width: 100%;"> Print Receipt</button>
            </div>
          `;
        });
        html += '</div>';
        journalRecentModalBody.innerHTML = html;
      }
      journalRecentModal.classList.add('active');
    }

    // Show Receipt Preview
    window.showJournalReceiptPreview = function(receiptId) {
      const receipt = journalRecentReceipts.find(r => r.id === receiptId);
      if (!receipt) return;

      let html = '<div style="background: white; padding: 1.5rem; border: 2px dashed #d1d5db; border-radius: 8px; font-family: \'Courier New\', monospace; font-size: 0.85rem;">';
      html += '<div style="text-align: center; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px dashed #d1d5db;">';
      html += '<div style="font-weight: bold; font-size: 1.1rem;">HOSPITAL RECEIPT</div>';
      html += `<div>Nurse: ${receipt.nurse}</div>`;
      html += `<div>Date: ${receipt.timestamp}</div>`;
      html += `<div>Patient: ${receipt.patient}</div>`;
      html += '</div>';
      
      html += '<div style="margin-bottom: 1rem;">';
      receipt.items.forEach(item => {
        html += `<div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">`;
        html += `<span>${item.name} x${item.quantity}</span>`;
        html += `<span>${item.total}</span>`;
        html += `</div>`;
      });
      html += '</div>';
      
      html += '<div style="padding-top: 1rem; border-top: 1px dashed #d1d5db; font-weight: bold;">';
      html += `<div style="display: flex; justify-content: space-between;">`;
      html += `<span>TOTAL</span>`;
      html += `<span>${receipt.total}</span>`;
      html += `</div>`;
      html += '</div>';
      
      html += '</div>';
      
      html += `<button onclick="printJournalReceipt(${receipt.id})" style="margin-top: 1rem; padding: 0.75rem 1rem; background: #3b82f6; color: white; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; width: 100%;"> Print Receipt</button>`;
      
      journalPreviewModalBody.innerHTML = html;
      journalPreviewModal.classList.add('active');
    };

    // Print Receipt
    window.printJournalReceipt = function(receiptId) {
      const receipt = journalRecentReceipts.find(r => r.id === receiptId);
      if (!receipt) return;

      // In real implementation, this would send to server/printer
      console.log('Printing receipt:', receipt);
      alert('Sending to printer...\n(In production, this will print to the server printer)');
      
      // Remove from queue after printing
      journalRecentReceipts = journalRecentReceipts.filter(r => r.id !== receiptId);
      showJournalRecentModal();
    };

    // Close Modals
    closeJournalRecentModal.addEventListener('click', () => {
      journalRecentModal.classList.remove('active');
    });

    closeJournalPreviewModal.addEventListener('click', () => {
      journalPreviewModal.classList.remove('active');
    });

    // Close on background click
    journalRecentModal.addEventListener('click', (e) => {
      if (e.target === journalRecentModal) {
        journalRecentModal.classList.remove('active');
      }
    });

    journalPreviewModal.addEventListener('click', (e) => {
      if (e.target === journalPreviewModal) {
        journalPreviewModal.classList.remove('active');
      }
    });
    } // End of OLD inventory system check

    // === NEW INVENTORY SYSTEM ===
    // New Inventory Elements
    const inventoryCurrentDate = document.getElementById('inventoryCurrentDate');
    const inventorySearchInput = document.getElementById('inventorySearchInput');
    const datePickerInput = document.getElementById('datePickerInput');
    const inventoryProductsBody = document.getElementById('inventoryProductsBody');
    const statusBoxes = document.querySelectorAll('.status-box[data-status]');
    const addNewProductBox = document.getElementById('addNewProductBox');
    const allCountEl = document.getElementById('allCount');
    const lowCountEl = document.getElementById('lowCount');
    const outCountEl = document.getElementById('outCount');
    
    // Current filter status
    let currentStockFilter = 'all'; // 'all', 'low', 'out'
    
    // Current selected date (default to today)
    let currentSelectedDate = new Date();
    
    // Product master list - all products
    let productsMaster = [
      // Temporary test products
      { product: 'Surgical Gloves', category: 'BY BOX', expiry: '2027-06-15', stock: 150 },
      { product: 'Syringe 5ml', category: 'BY PIECE', expiry: '2027-12-20', stock: 300 },
      { product: 'Saline Solution', category: 'IV', expiry: '2026-08-10', stock: 85 },
      { product: 'Bandages', category: 'BY BOX', expiry: '2027-03-25', stock: 120 },
      { product: 'Alcohol Swabs', category: 'BY BOX', expiry: '2026-11-30', stock: 200 },
      { product: 'Face Masks', category: 'BY BOX', expiry: '2027-01-15', stock: 450 },
      { product: 'Cotton Balls', category: 'BY PIECE', expiry: '2027-05-20', stock: 180 },
      { product: 'Paracetamol 500mg', category: 'TAB/CAPS', expiry: '2027-09-10', stock: 95 },
      { product: 'Distilled Water', category: 'BY GALLON', expiry: '2026-12-15', stock: 60 },
      { product: 'Dextrose 5%', category: 'IV', expiry: '2027-04-22', stock: 110 },
      { product: 'Amoxicillin 500mg', category: 'TAB/CAPS', expiry: '2026-02-10', stock: 8 },
      { product: 'Normal Saline', category: 'IV', expiry: '2026-09-05', stock: 140 },
      
      // IV
      { product: 'D50 50ML', category: 'IV', expiry: '2026-12-31', stock: 75 },
      { product: 'DIPENHYDRAMINE', category: 'IV', expiry: '2027-03-15', stock: 50 },
      { product: 'EPOETIN ALFA', category: 'IV', expiry: '2026-09-20', stock: 25 },
      { product: 'EPINEPHRINE', category: 'IV', expiry: '2027-01-10', stock: 90 },
      { product: 'EPOETIN BETA', category: 'IV', expiry: '2026-08-25', stock: 30 },
      { product: 'GENTAMYCIN', category: 'IV', expiry: '2027-05-18', stock: 65 },
      { product: 'HEPARIN', category: 'IV', expiry: '2026-11-30', stock: 45 },
      { product: 'HYDROCORTISONE', category: 'IV', expiry: '2027-02-14', stock: 55 },
      { product: 'IV IRON', category: 'IV', expiry: '2027-04-22', stock: 40 },
      { product: 'IV PARACETAMOL', category: 'IV', expiry: '2026-10-15', stock: 80 },
      { product: 'PNSS IL', category: 'IV', expiry: '2027-06-30', stock: 200 },
      { product: 'SALBUTAMOL', category: 'IV', expiry: '2026-12-20', stock: 70 },
      
      // TAB/CAPS
      { product: 'CLONIDINE', category: 'TAB/CAPS', expiry: '2027-01-25', stock: 120 },
      { product: 'DUO GESIC', category: 'TAB/CAPS', expiry: '2026-09-10', stock: 5 },
      { product: 'FLUGARD', category: 'TAB/CAPS', expiry: '2027-03-05', stock: 95 },
      { product: 'MEFENAMIC ACID', category: 'TAB/CAPS', expiry: '2026-11-18', stock: 150 },
      { product: 'TRAMADOL OPIODEX', category: 'TAB/CAPS', expiry: '2027-02-28', stock: 60 },
      { product: 'TRAMADOL ROUNOX', category: 'TAB/CAPS', expiry: '2026-10-22', stock: 3 },
      { product: 'TRAMADOL IV', category: 'TAB/CAPS', expiry: '2027-04-15', stock: 85 },
      
      // BY GALLON
      { product: 'ALCOHOL', category: 'BY GALLON', expiry: '2027-12-31', stock: 45 },
      
      // BY BOX
      { product: 'FACEMASK', category: 'BY BOX', expiry: '2028-01-30', stock: 250 },
      { product: 'GLOVES', category: 'BY BOX', expiry: '2027-08-15', stock: 180 },
      { product: 'STERILE GLOVES', category: 'BY BOX', expiry: '2027-09-20', stock: 95 },
      { product: 'ALCOHOL PREP PAD', category: 'BY BOX', expiry: '2027-06-10', stock: 140 },
      
      // BY PIECE
      { product: 'BLANKET', category: 'BY PIECE', expiry: '2029-01-01', stock: 75 },
      { product: 'BLOODLINES', category: 'BY PIECE', expiry: '2027-05-20', stock: 120 },
      { product: 'CBG TESTING LANCET', category: 'BY PIECE', expiry: '2026-12-15', stock: 200 },
      { product: 'CBG TESTING TEST STRIP', category: 'BY PIECE', expiry: '2026-11-28', stock: 180 },
      { product: 'DISPOSABLE SYRINGE', category: 'BY PIECE', expiry: '2027-07-30', stock: 300 },
      { product: 'FISTULA KIT', category: 'BY PIECE', expiry: '2027-03-18', stock: 50 },
      { product: 'FISTULA NEEDLE SET', category: 'BY PIECE', expiry: '2027-04-25', stock: 60 },
      { product: 'HIFLUX DIALYZER', category: 'BY PIECE', expiry: '2026-10-31', stock: 0 },
      { product: 'LINEN', category: 'BY PIECE', expiry: '2029-01-01', stock: 100 },
      { product: 'MICROPORE', category: 'BY PIECE', expiry: '2027-08-22', stock: 150 },
      { product: 'MUPIROCIN', category: 'BY PIECE', expiry: '2026-09-14', stock: 8 },
      { product: 'NASAL CANNULA', category: 'BY PIECE', expiry: '2027-11-05', stock: 90 },
      { product: 'NEBU KIT', category: 'BY PIECE', expiry: '2027-02-10', stock: 110 },
      { product: 'NECK PILLOW', category: 'BY PIECE', expiry: '2029-01-01', stock: 40 },
      { product: 'OXYGEN MASK', category: 'BY PIECE', expiry: '2027-06-18', stock: 85 },
      { product: 'SUBCLAVIAN KIT', category: 'BY PIECE', expiry: '2027-01-28', stock: 2 },
      { product: 'TISSUE', category: 'BY PIECE', expiry: '2028-12-31', stock: 220 },
      { product: 'TUMBLER', category: 'BY PIECE', expiry: '2029-01-01', stock: 65 },
    ];
    
    // Sales data by date - keyed by date string "YYYY-MM-DD" -> { productName: salesCount }
    let salesByDate = {};
    
    // Initialize with random sales for demonstration
    function initializeSalesData() {
      const today = new Date();
      for (let i = -30; i <= 30; i++) {
        const date = new Date(today);
        date.setDate(date.getDate() + i);
        const dateStr = date.toISOString().split('T')[0];
        salesByDate[dateStr] = {};
        productsMaster.forEach(product => {
          salesByDate[dateStr][product.product] = Math.floor(Math.random() * 20);
        });
      }
    }
    
    initializeSalesData();
    
    // Update date display
    function updateInventoryDateDisplay() {
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      inventoryCurrentDate.textContent = currentSelectedDate.toLocaleDateString('en-US', options);
    }
    
    // Render products table
    function renderInventoryProducts() {
      console.log('=== RENDERING PRODUCTS ===');
      console.log('inventorySearchInput:', inventorySearchInput);
      console.log('inventoryProductsBody:', inventoryProductsBody);
      
      if (!inventorySearchInput || !inventoryProductsBody) {
        console.error('Missing required elements!');
        return;
      }
      
      const searchTerm = inventorySearchInput.value.toLowerCase();
      const currentDateStr = currentSelectedDate.toISOString().split('T')[0];
      
      console.log('searchTerm:', searchTerm);
      console.log('currentDateStr:', currentDateStr);
      console.log('productsMaster:', productsMaster.length, 'products');
      
      // Filter products
      let filtered = productsMaster.filter(p => {
        const matchesSearch = p.product.toLowerCase().includes(searchTerm) || 
                             p.category.toLowerCase().includes(searchTerm);
        
        // Filter by stock status
        let matchesStockFilter = true;
        if (currentStockFilter === 'all') {
          matchesStockFilter = true; // Show all items
        } else if (currentStockFilter === 'low') {
          matchesStockFilter = (p.stock || 0) > 0 && (p.stock || 0) < 20;
        } else if (currentStockFilter === 'out') {
          matchesStockFilter = (p.stock || 0) === 0;
        }
        
        return matchesSearch && matchesStockFilter;
      });
      
      console.log('filtered:', filtered.length, 'products');
      
      // Sort by category, then by name
      filtered.sort((a, b) => {
        if (a.category !== b.category) return a.category.localeCompare(b.category);
        return a.product.localeCompare(b.product);
      });
      
      // Build table HTML
      let html = '';
      let lastCategory = '';
      
      filtered.forEach((product, index) => {
        // Add separator row when category changes (except for first item)
        if (product.category !== lastCategory && lastCategory !== '') {
          html += `
            <tr class="category-separator">
              <td colspan="5" style="background: #f3f4f6; height: 8px; padding: 0; border: none;"></td>
            </tr>
          `;
        }
        lastCategory = product.category;
        
        // Get sales for today
        const salesToday = (salesByDate[currentDateStr] && salesByDate[currentDateStr][product.product]) || 0;
        const currentStock = product.stock || 0;
        
        // Determine stock status color
        let stockColor = '#10b981'; // Green for good stock
        if (currentStock === 0) {
          stockColor = '#dc2626'; // Red for out of stock
        } else if (currentStock < 20) {
          stockColor = '#f59e0b'; // Orange for low stock
        }
        
        html += `
          <tr>
            <td data-label="Category">${product.category}</td>
            <td data-label="Product">${product.product}</td>
            <td data-label="Current Stock"><span style="color: ${stockColor}; font-weight: 600;">${currentStock}</span></td>
            <td data-label="Expiry Date">${formatDate(product.expiry)}</td>
            <td data-label="Sales">${salesToday}</td>
          </tr>
        `;
      });
      
      console.log('Generated HTML length:', html.length);
      
      inventoryProductsBody.innerHTML = html || '<tr><td colspan="4" style="text-align:center; padding:2rem; color:#9ca3af;">No products found</td></tr>';
      
      console.log('Products rendered to table');
      
      // Update counts
      updateStatusCounts();
    }
    
    // Format date
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
    }
    
    // Update status counts
    function updateStatusCounts() {
      // Calculate real counts based on stock levels
      let allCount = productsMaster.length; // Total items
      let lowCount = 0;
      let outCount = 0;
      let availableCount = 0;
      let expiringCount = 0;
      
      const today = new Date();
      
      productsMaster.forEach(product => {
        const stock = product.stock || 0;
        
        // Count by stock status
        if (stock === 0) {
          outCount++;
        } else if (stock < 20) {
          lowCount++;
        } else {
          availableCount++;
        }
        
        // Check if expiring soon (within 90 days)
        if (product.expiry) {
          const expiryDate = new Date(product.expiry);
          const diffTime = expiryDate - today;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          
          // Expiring within 90 days
          if (diffDays <= 90 && diffDays >= 0) {
            expiringCount++;
          }
        }
      });
      
      // Update inventory page status boxes
      if (allCountEl) allCountEl.textContent = allCount;
      if (lowCountEl) lowCountEl.textContent = lowCount;
      if (outCountEl) outCountEl.textContent = outCount;
      
      // Update dashboard inventory overview
      const dashAvailableEl = document.getElementById('dashAvailableCount');
      const dashLowStockEl = document.getElementById('dashLowStockCount');
      const dashOutStockEl = document.getElementById('dashOutStockCount');
      const dashExpiringEl = document.getElementById('dashExpiringCount');
      
      if (dashAvailableEl) dashAvailableEl.textContent = availableCount;
      if (dashLowStockEl) dashLowStockEl.textContent = lowCount;
      if (dashOutStockEl) dashOutStockEl.textContent = outCount;
      if (dashExpiringEl) dashExpiringEl.textContent = expiringCount;
      
      console.log('Status counts updated (Inventory + Dashboard):', {
        all: allCount,
        available: availableCount,
        lowStock: lowCount,
        outStock: outCount,
        expiring: expiringCount
      });
    }
    
    // Status box click handlers
    statusBoxes.forEach(box => {
      box.addEventListener('click', () => {
        const status = box.dataset.status;
        
        // Update active state
        statusBoxes.forEach(b => b.classList.remove('active'));
        box.classList.add('active');
        
        // Update filter
        currentStockFilter = status;
        
        console.log('Filter changed to:', status);
        
        // Re-render products with new filter
        renderInventoryProducts();
      });
    });
    
    // Event listeners
    if (inventorySearchInput) {
      inventorySearchInput.addEventListener('input', renderInventoryProducts);
    }
    
    // Previous day button
    const prevDayBtn = document.getElementById('prevDayBtn');
    if (prevDayBtn) {
      prevDayBtn.addEventListener('click', () => {
        currentSelectedDate.setDate(currentSelectedDate.getDate() - 1);
        updateInventoryDateDisplay();
        if (datePickerInput) {
          datePickerInput.value = currentSelectedDate.toISOString().split('T')[0];
        }
        renderInventoryProducts();
      });
    }
    
    // Next day button
    const nextDayBtn = document.getElementById('nextDayBtn');
    if (nextDayBtn) {
      nextDayBtn.addEventListener('click', () => {
        currentSelectedDate.setDate(currentSelectedDate.getDate() + 1);
        updateInventoryDateDisplay();
        if (datePickerInput) {
          datePickerInput.value = currentSelectedDate.toISOString().split('T')[0];
        }
        renderInventoryProducts();
      });
    }
    
    // Calendar picker button
    const visibleDatePicker = document.getElementById('visibleDatePicker');
    
    // Setup visible date picker
    if (visibleDatePicker) {
      visibleDatePicker.value = currentSelectedDate.toISOString().split('T')[0];
      
      visibleDatePicker.addEventListener('change', (e) => {
        console.log('Date picker changed:', e.target.value);
        currentSelectedDate = new Date(e.target.value + 'T00:00:00');
        updateInventoryDateDisplay();
        renderInventoryProducts();
      });
    }
    
    // Date picker change
    if (datePickerInput) {
      datePickerInput.addEventListener('change', (e) => {
        console.log('Date changed:', e.target.value);
        currentSelectedDate = new Date(e.target.value + 'T00:00:00');
        updateInventoryDateDisplay();
        renderInventoryProducts();
        
        // Hide the date picker again
        datePickerInput.style.position = 'fixed';
        datePickerInput.style.top = '-9999px';
        datePickerInput.style.left = '-9999px';
        datePickerInput.style.width = '1px';
        datePickerInput.style.height = '1px';
        datePickerInput.style.zIndex = '-1';
      });
      
      // Also hide on blur (when calendar closes)
      datePickerInput.addEventListener('blur', () => {
        setTimeout(() => {
          datePickerInput.style.position = 'fixed';
          datePickerInput.style.top = '-9999px';
          datePickerInput.style.left = '-9999px';
          datePickerInput.style.width = '1px';
          datePickerInput.style.height = '1px';
          datePickerInput.style.zIndex = '-1';
        }, 200);
      });
    }
    
    // Status box click handlers
    statusBoxes.forEach(box => {
      box.addEventListener('click', () => {
        statusBoxes.forEach(b => b.classList.remove('active'));
        box.classList.add('active');
        // TODO: Filter by status
        renderInventoryProducts();
      });
    });
    
    // Add product box
    if (addNewProductBox) {
      addNewProductBox.addEventListener('click', () => {
        if (addProductModal) addProductModal.classList.add('active');
      });
    }
    
    // Initialize inventory system
    function initInventorySystem() {
      console.log('=== INITIALIZING INVENTORY ===');
      console.log('datePickerInput:', datePickerInput);
      console.log('inventoryProductsBody:', inventoryProductsBody);
      console.log('productsMaster length:', productsMaster.length);
      console.log('currentSelectedDate:', currentSelectedDate);
      
      if (datePickerInput) {
        datePickerInput.value = currentSelectedDate.toISOString().split('T')[0];
      }
      updateInventoryDateDisplay();
      renderInventoryProducts();
      console.log('=== INITIALIZATION COMPLETE ===');
    }
    
    // === RESTOCK SYSTEM ===
    const goToRestockBtn = document.getElementById('goToRestockBtn');
    const backFromRestockBtn = document.getElementById('backFromRestockBtn');
    const restockPage = document.getElementById('restockPage');
    const inventoryPage = document.getElementById('inventory');
    const restockItemsList = document.getElementById('restockItemsList');
    const restockFilterBtns = document.querySelectorAll('.restock-filter-btn');
    const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
    const updateStocksBtn = document.getElementById('updateStocksBtn');
    const updateCounter = document.getElementById('updateCounter');
    const restockSearchInput = document.getElementById('restockSearchInput');
    const restockCategoryFilter = document.getElementById('restockCategoryFilter');
    
    // Delete password
    const DELETE_PASSWORD = 'admin123'; // Change this to your desired password
    const MANUAL_UPDATE_PASSWORD = 'admin123'; // Password for manual inventory update access
    
    let currentRestockFilter = 'all';
    let currentRestockSearch = '';
    let currentRestockCategory = 'all';
    let restockData = [];
    
    // Initialize restock data from products
    function initializeRestockData() {
      restockData = productsMaster.map(product => ({
        product: product.product,
        category: product.category,
        status: Math.random() > 0.7 ? 'low' : (Math.random() > 0.9 ? 'out' : 'normal'),
        monthlySold: Math.floor(Math.random() * 300) + 50,
        currentStock: Math.floor(Math.random() * 100),
        previousCost: (Math.random() * 500 + 50).toFixed(2),
        newCost: '',
        newStockQty: 0,
        checked: false
      }));
      
      // Populate category filter
      populateRestockCategoryFilter();
    }
    
    // Populate category filter dropdown
    function populateRestockCategoryFilter() {
      if (!restockCategoryFilter) return;
      
      // Get unique categories from restockData
      const categories = [...new Set(restockData.map(item => item.category))].sort();
      
      restockCategoryFilter.innerHTML = '<option value="all">All Categories</option>';
      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        restockCategoryFilter.appendChild(option);
      });
    }
    
    // Navigate to restock page
    if (goToRestockBtn) {
      goToRestockBtn.addEventListener('click', () => {
        inventoryPage.classList.remove('active');
        restockPage.style.display = 'block';
        initializeRestockData();
        renderRestockItems();
        setupDeleteButton(); // Setup delete button when page opens

        // Scroll to top
        window.scrollTo(0, 0);
      });
    }
    
    // Navigate back to inventory
    if (backFromRestockBtn) {
      backFromRestockBtn.addEventListener('click', () => {
        restockPage.style.display = 'none';
        inventoryPage.classList.add('active');
      });
    }
    
    // Filter buttons
    restockFilterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        currentRestockFilter = btn.dataset.filter;
        restockFilterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderRestockItems();
      });
    });
    
    // Search input
    if (restockSearchInput) {
      restockSearchInput.addEventListener('input', (e) => {
        currentRestockSearch = e.target.value;
        renderRestockItems();
      });
    }
    
    // Category filter
    if (restockCategoryFilter) {
      restockCategoryFilter.addEventListener('change', (e) => {
        currentRestockCategory = e.target.value;
        renderRestockItems();
      });
    }
    
    // Render restock items
    function renderRestockItems() {
      let filtered = restockData;
      
      // Apply stock status filter
      if (currentRestockFilter === 'low') {
        filtered = filtered.filter(item => item.status === 'low');
      } else if (currentRestockFilter === 'out') {
        filtered = filtered.filter(item => item.status === 'out');
      }
      
      // Apply search filter
      if (currentRestockSearch) {
        filtered = filtered.filter(item => 
          item.product.toLowerCase().includes(currentRestockSearch.toLowerCase())
        );
      }
      
      // Apply category filter
      if (currentRestockCategory !== 'all') {
        filtered = filtered.filter(item => item.category === currentRestockCategory);
      }
      
      let html = '';
      
      if (filtered.length === 0) {
        html = '<div style="text-align: center; padding: 3rem; color: #9ca3af;">No items found matching your filters.</div>';
      } else {
        filtered.forEach((item, index) => {
        const actualIndex = restockData.indexOf(item);
        const statusClass = item.status === 'low' ? 'low' : item.status === 'out' ? 'out' : '';
        const statusText = item.status === 'low' ? 'Low Stock' : item.status === 'out' ? 'Out of Stock' : 'Normal';
        
        html += `
          <div class="restock-card ${item.checked ? 'selected' : ''}" data-index="${actualIndex}">
            <div class="restock-card-header">
              <div class="restock-card-title">
                <div class="restock-product-name">${item.product}</div>
                <div class="restock-category-status">
                  <span class="restock-category">${item.category}</span>
                  ${statusClass ? `<span class="restock-status ${statusClass}">${statusText}</span>` : ''}
                </div>
              </div>
              <div class="restock-checkbox-delete">
                <input type="checkbox" class="restock-checkbox" data-index="${actualIndex}" ${item.checked ? 'checked' : ''}>
              </div>
            </div>
            
            <div class="restock-card-body">
              <div class="restock-field">
                <div class="restock-field-label">Monthly Sold</div>
                <div class="restock-field-value">${item.monthlySold}</div>
              </div>
              
              <div class="restock-field">
                <div class="restock-field-label">Current Stock</div>
                <div class="restock-field-value">${item.currentStock}</div>
              </div>
              
              <div class="restock-field">
                <div class="restock-field-label">Previous Cost</div>
                <div class="restock-field-value">${item.previousCost}</div>
              </div>
            </div>
            
            <div class="restock-card-footer">
              <div class="restock-inputs-row">
                <div class="restock-input-group">
                  <div class="restock-input-label">New Cost (Per Item)</div>
                  <input type="number" class="new-cost-input" data-index="${actualIndex}" 
                         placeholder="0.00" value="${item.newCost}" step="0.01">
                </div>
                
                <div class="restock-input-group">
                  <div class="restock-input-label">New Stocks (Qty)</div>
                  <input type="number" class="new-stock-input" data-index="${actualIndex}" 
                         placeholder="0" value="${item.newStockQty || ''}" min="0">
                </div>
              </div>
              
              <button class="btn-add-cost" data-index="${actualIndex}">+ New Cost</button>
            </div>
          </div>
        `;
        });
      }
      
      restockItemsList.innerHTML = html;
      
      // Add event listeners
      attachRestockEventListeners();
      updateRestockCounter();
    }
    
    // Attach event listeners to restock cards
    function attachRestockEventListeners() {
      // Checkboxes
      document.querySelectorAll('.restock-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', (e) => {
          const index = parseInt(e.target.dataset.index);
          restockData[index].checked = e.target.checked;
          renderRestockItems();
        });
      });
      
      // New cost inputs
      document.querySelectorAll('.new-cost-input').forEach(input => {
        input.addEventListener('input', (e) => {
          const index = parseInt(e.target.dataset.index);
          restockData[index].newCost = e.target.value;
        });
      });
      
      // New stock inputs - auto-check when value added
      document.querySelectorAll('.new-stock-input').forEach(input => {
        input.addEventListener('input', (e) => {
          const index = parseInt(e.target.dataset.index);
          const value = parseInt(e.target.value) || 0;
          restockData[index].newStockQty = value;
          
          // Auto-check if value > 0
          if (value > 0 && !restockData[index].checked) {
            restockData[index].checked = true;
            renderRestockItems();
          }
          updateRestockCounter();
        });
      });
      
      // Add cost buttons
      document.querySelectorAll('.btn-add-cost').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = parseInt(e.target.dataset.index);
          const input = document.querySelector(`.new-cost-input[data-index="${index}"]`);
          if (input) input.focus();
        });
      });
    }
    
    // Update restock counter
    function updateRestockCounter() {
      const checkedCount = restockData.filter(item => item.checked && item.newStockQty > 0).length;
      updateCounter.textContent = `(${checkedCount})`;
      
      if (checkedCount > 0) {
        updateStocksBtn.classList.add('active');
        updateStocksBtn.style.cursor = 'pointer';
      } else {
        updateStocksBtn.classList.remove('active');
        updateStocksBtn.style.cursor = 'not-allowed';
      }
    }
    
    // Setup delete button handler
    function setupDeleteButton() {
      const btn = document.getElementById('deleteSelectedBtn');
      if (!btn) {
        console.error('Delete button NOT found!');
        return;
      }
      
      console.log('Setting up delete button handler');
      
      // Remove any existing listeners by cloning
      const newBtn = btn.cloneNode(true);
      btn.parentNode.replaceChild(newBtn, btn);
      
      newBtn.addEventListener('click', () => {
        console.log(' Delete button clicked!');
        const toDelete = restockData.filter(item => item.checked);
        console.log('Items to delete:', toDelete.length);
        
        if (toDelete.length === 0) {
          alert(' No items selected. Please check items first.');
          return;
        }
        
        // Request password
        const password = prompt(` Enter password to delete ${toDelete.length} item(s):`);
        
        if (password === null) {
          // User cancelled
          console.log('User cancelled password prompt');
          return;
        }
        
        if (password !== DELETE_PASSWORD) {
          alert(' Incorrect password! Deletion cancelled.');
          console.log('Wrong password entered');
          return;
        }
        
        // Password correct, confirm deletion
        if (confirm(` Password accepted. Delete ${toDelete.length} selected item(s)?`)) {
          restockData = restockData.filter(item => !item.checked);
          renderRestockItems();
          alert(` ${toDelete.length} item(s) deleted successfully!`);
          console.log('Items deleted successfully');
        }
      });
      
      console.log('Delete button handler attached successfully');
    }
    
    // Update stocks
    if (updateStocksBtn) {
      updateStocksBtn.addEventListener('click', () => {
        const toUpdate = restockData.filter(item => item.checked && item.newStockQty > 0);
        
        if (toUpdate.length === 0) {
          alert('No items to update. Add stock quantities first.');
          return;
        }
        
        // Process updates
        toUpdate.forEach(item => {
          item.currentStock += item.newStockQty;
          if (item.newCost) {
            item.previousCost = item.newCost;
          }
          item.newStockQty = 0;
          item.newCost = '';
          item.checked = false;
        });
        
        alert(`Successfully updated ${toUpdate.length} item(s)!`);
        renderRestockItems();
      });
    }
    
    // END RESTOCK SYSTEM
    
    // === MANUAL INVENTORY UPDATE SYSTEM ===
    const goToManualUpdateBtn = document.getElementById('goToManualUpdateBtn');
    const backFromManualUpdateBtn = document.getElementById('backFromManualUpdateBtn');
    const manualUpdatePage = document.getElementById('manualUpdatePage');
    const manualUpdateList = document.getElementById('manualUpdateList');
    const manualUpdateDateDisplay = document.getElementById('manualUpdateDateDisplay');
    const saveManualUpdatesBtn = document.getElementById('saveManualUpdatesBtn');
    const manualUpdateSearchInput = document.getElementById('manualUpdateSearchInput');
    const manualUpdateCategoryFilter = document.getElementById('manualUpdateCategoryFilter');

    // Filter state
    let currentManualUpdateSearch = '';
    let currentManualUpdateCategory = 'all';

    // Search input for manual update
    if (manualUpdateSearchInput) {
      manualUpdateSearchInput.addEventListener('input', (e) => {
        currentManualUpdateSearch = e.target.value;
        renderManualUpdateList();
      });
    }

    // Category filter for manual update
    if (manualUpdateCategoryFilter) {
      manualUpdateCategoryFilter.addEventListener('change', (e) => {
        currentManualUpdateCategory = e.target.value;
        renderManualUpdateList();
      });
    }
    
    // Navigate to manual update page
    if (goToManualUpdateBtn) {
      goToManualUpdateBtn.addEventListener('click', () => {
        // Request password before opening
        const password = prompt(' Enter password to access Manual Inventory Update:\n\n(This action will be logged for tracking purposes)');
        
        if (password === null) {
          // User cancelled
          console.log('Manual update access cancelled by user');
          return;
        }
        
        if (password !== MANUAL_UPDATE_PASSWORD) {
          alert(' Incorrect password! Access denied.');
          console.log('Failed manual update access attempt - wrong password');
          return;
        }
        
        // Password correct - log and open
        const timestamp = new Date().toLocaleString();
        console.log(` Manual Inventory Update accessed at ${timestamp}`);
        console.log('User authenticated successfully');
        
        inventoryPage.classList.remove('active');
        manualUpdatePage.style.display = 'block';
        renderManualUpdateList();
        
        // Scroll to top
        window.scrollTo(0, 0);
      });
    }
    
    // Navigate back to inventory
    if (backFromManualUpdateBtn) {
      backFromManualUpdateBtn.addEventListener('click', () => {
        manualUpdatePage.style.display = 'none';
        inventoryPage.classList.add('active');
      });
    }

    // Populate manual update category filter
    function populateManualUpdateCategoryFilter() {
      if (!manualUpdateCategoryFilter) return;
      
      // Get unique categories from productsMaster
      const categories = [...new Set(productsMaster.map(item => item.category))].sort();
      
      manualUpdateCategoryFilter.innerHTML = '<option value="all">All Categories</option>';
      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        manualUpdateCategoryFilter.appendChild(option);
      });
    }
    
    // Render manual update list
    function renderManualUpdateList() {
      const currentDateStr = currentSelectedDate.toISOString().split('T')[0];
      
      // Update date display
      if (manualUpdateDateDisplay) {
        manualUpdateDateDisplay.textContent = currentSelectedDate.toLocaleDateString('en-US', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
      }
      
      if (!manualUpdateList) return;
      
      let html = '';
      
      // Filter products
      let filtered = [...productsMaster];
      
      // Apply search filter
      if (currentManualUpdateSearch) {
        filtered = filtered.filter(item => 
          item.product.toLowerCase().includes(currentManualUpdateSearch.toLowerCase())
        );
      }
      
      // Apply category filter
      if (currentManualUpdateCategory !== 'all') {
        filtered = filtered.filter(item => item.category === currentManualUpdateCategory);
      }
      
      // Sort products by category then name
      const sortedProducts = filtered.sort((a, b) => {
        if (a.category !== b.category) return a.category.localeCompare(b.category);
        return a.product.localeCompare(b.product);
      });
      
      sortedProducts.forEach((product, index) => {
        const currentSales = (salesByDate[currentDateStr] && salesByDate[currentDateStr][product.product]) || 0;
        const currentStock = product.stock || 0;
        
        // Determine stock status color
        let stockColor = '#10b981'; // Green for good stock
        let stockStatus = 'Good';
        if (currentStock === 0) {
          stockColor = '#dc2626'; // Red for out of stock
          stockStatus = 'Out of Stock';
        } else if (currentStock < 20) {
          stockColor = '#f59e0b'; // Orange for low stock
          stockStatus = 'Low Stock';
        }
        
        html += `
          <div class="manual-update-item">
            <div class="manual-update-item-info">
              <div class="manual-update-item-name">${product.product}</div>
              <span class="manual-update-item-category">${product.category}</span>
            </div>
            
            <div class="manual-update-field">
              <div class="manual-update-field-label">Expiry Date</div>
              <div class="manual-update-field-value">${formatDate(product.expiry)}</div>
            </div>
            
            <div class="manual-update-field">
              <div class="manual-update-field-label">Current Stock</div>
              <div class="manual-update-field-value" style="color: ${stockColor}; font-weight: 700;">${currentStock}</div>
            </div>
            
            <div class="manual-update-field">
              <div class="manual-update-field-label">Sales (Edit)</div>
              <input type="number" 
                     class="manual-sales-input" 
                     data-product="${product.product}" 
                     value="${currentSales}" 
                     min="0">
            </div>
          </div>
        `;
      });
      
      manualUpdateList.innerHTML = html || '<p style="text-align:center; padding:2rem; color:#9ca3af;">No products found</p>';
    }
    
    // Save manual updates
    if (saveManualUpdatesBtn) {
      saveManualUpdatesBtn.addEventListener('click', () => {
        const currentDateStr = currentSelectedDate.toISOString().split('T')[0];
        const inputs = document.querySelectorAll('.manual-sales-input');
        let changesMade = false;
        
        // Ensure date exists in salesByDate
        if (!salesByDate[currentDateStr]) {
          salesByDate[currentDateStr] = {};
        }
        
        inputs.forEach(input => {
          const productName = input.dataset.product;
          const newValue = parseInt(input.value) || 0;
          const oldValue = salesByDate[currentDateStr][productName] || 0;
          
          if (newValue !== oldValue) {
            salesByDate[currentDateStr][productName] = newValue;
            changesMade = true;
          }
        });
        
        if (changesMade) {
          // Show saving animation
          saveManualUpdatesBtn.disabled = true;
          saveManualUpdatesBtn.textContent = ' Saving...';
          saveManualUpdatesBtn.style.opacity = '0.6';
          
          setTimeout(() => {
            // Success state
            saveManualUpdatesBtn.textContent = ' Saved!';
            saveManualUpdatesBtn.style.background = '#10b981';
            saveManualUpdatesBtn.style.opacity = '1';
            
            // Update inventory view if needed
            if (typeof renderInventoryProducts === 'function') {
              renderInventoryProducts();
            }
            
            console.log('Manual sales updates saved for:', currentDateStr);
            
            // Close and return after delay
            setTimeout(() => {
              manualUpdatePage.style.display = 'none';
              inventoryPage.style.display = 'block';
              
              // Reset button
              saveManualUpdatesBtn.disabled = false;
              saveManualUpdatesBtn.textContent = ' Save All Changes';
              saveManualUpdatesBtn.style.background = '#2563eb';
            }, 1000);
            
          }, 600);
        } else {
          alert(' No changes to save.');
        }
      });
    }
    
    // END MANUAL INVENTORY UPDATE SYSTEM
    
    // === PATIENT LIST / LABORATORY LOGBOOK SYSTEM ===
    const patientNameInput = document.getElementById('patientNameInput');
    const labTypeSelect = document.getElementById('labTypeSelect');
    const addPatientBtn = document.getElementById('addPatientBtn');
    const patientRecordsBody = document.getElementById('patientRecordsBody');
    const manageLabTypesBtn = document.getElementById('manageLabTypesBtn');
    const labTypesModal = document.getElementById('labTypesModal');
    const closeLabTypesModal = document.getElementById('closeLabTypesModal');
    const labTypesList = document.getElementById('labTypesList');
    const newLabTypeInput = document.getElementById('newLabTypeInput');
    const addLabTypeBtn = document.getElementById('addLabTypeBtn');
    
    // Current nurse (from user profile - you can update this based on your auth system)
    let currentNurse = 'Mark Cruz'; // This should come from your login system
    
    // Lab types preset (can be modified)
    let labTypes = [
      'Complete Blood Count (CBC)',
      'Urinalysis',
      'Fecalysis',
      'Blood Chemistry',
      'Lipid Profile',
      'Blood Typing',
      'Pregnancy Test',
      'Drug Test',
      'X-Ray',
      'ECG',
      'Ultrasound',
      'CT Scan',
      'MRI'
    ];
    
    // Patient records storage
    let patientRecords = [];
    
    // Initialize lab types dropdown
    function populateLabTypeSelect() {
      if (labTypeSelect) {
        labTypeSelect.innerHTML = '<option value="">Select Lab Type</option>';
        labTypes.forEach(type => {
          const option = document.createElement('option');
          option.value = type;
          option.textContent = type;
          labTypeSelect.appendChild(option);
        });
      }
    }
    
    // Render lab types in management modal
    function renderLabTypesList() {
      if (labTypesList) {
        labTypesList.innerHTML = labTypes.map((type, index) => `
          <div class="lab-type-item">
            <span class="lab-type-name">${type}</span>
            <button class="btn-delete-lab-type" data-index="${index}"> Delete</button>
          </div>
        `).join('');
        
        // Add delete handlers
        document.querySelectorAll('.btn-delete-lab-type').forEach(btn => {
          btn.addEventListener('click', () => {
            const index = parseInt(btn.dataset.index);
            if (confirm(`Delete "${labTypes[index]}"?`)) {
              labTypes.splice(index, 1);
              renderLabTypesList();
              populateLabTypeSelect();
            }
          });
        });
      }
    }
    
    // Add new lab type
    if (addLabTypeBtn && newLabTypeInput) {
      addLabTypeBtn.addEventListener('click', () => {
        const newType = newLabTypeInput.value.trim();
        if (newType && !labTypes.includes(newType)) {
          labTypes.push(newType);
          newLabTypeInput.value = '';
          renderLabTypesList();
          populateLabTypeSelect();
        } else if (labTypes.includes(newType)) {
          alert(' This lab type already exists!');
        } else {
          alert(' Please enter a lab type name.');
        }
      });
    }
    
    // Open lab types management modal
    if (manageLabTypesBtn && labTypesModal) {
      manageLabTypesBtn.addEventListener('click', () => {
        labTypesModal.classList.add('active');
        renderLabTypesList();
      });
    }
    
    // Close lab types modal
    if (closeLabTypesModal && labTypesModal) {
      closeLabTypesModal.addEventListener('click', () => {
        labTypesModal.classList.remove('active');
      });
    }
    
    // Add patient record
    if (addPatientBtn) {
      addPatientBtn.addEventListener('click', () => {
        const patientName = patientNameInput.value.trim();
        const labType = labTypeSelect.value;
        
        // Validation
        if (!patientName) {
          alert(' Please enter patient name');
          return;
        }
        
        if (!labType) {
          alert(' Please select laboratory type');
          return;
        }
        
        // Create timestamp
        const now = new Date();
        const timestamp = now.toLocaleTimeString('en-US', { 
          hour: '2-digit', 
          minute: '2-digit',
          second: '2-digit',
          hour12: true 
        });
        const date = now.toLocaleDateString('en-US', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit'
        });
        
        // Create record
        const record = {
          timestamp: timestamp,
          date: date,
          patientName: patientName,
          labType: labType,
          nurseOnDuty: currentNurse,
          assigned: '' // Empty for now
        };
        
        // Add to records
        patientRecords.unshift(record); // Add to beginning (newest first)
        
        // Clear form
        patientNameInput.value = '';
        labTypeSelect.value = '';
        
        // Render records
        renderPatientRecords();
        
        // Success feedback
        addPatientBtn.textContent = ' Added!';
        addPatientBtn.style.background = '#10b981';
        setTimeout(() => {
          addPatientBtn.textContent = '+ Add Patient';
          addPatientBtn.style.background = '#10b981';
        }, 2000);
      });
    }
    
    // Render patient records
    function renderPatientRecords() {
      if (patientRecordsBody) {
        if (patientRecords.length === 0) {
          patientRecordsBody.innerHTML = `
            <tr>
              <td colspan="6" style="text-align: center; padding: 2rem; color: #9ca3af;">
                No patient records yet. Add your first patient above.
              </td>
            </tr>
          `;
        } else {
          patientRecordsBody.innerHTML = patientRecords.map(record => `
            <tr>
              <td>${record.timestamp}</td>
              <td>${record.date}</td>
              <td style="font-weight: 600; color: #111827;">${record.patientName}</td>
              <td>${record.labType}</td>
              <td>${record.nurseOnDuty}</td>
              <td style="color: #9ca3af; font-style: italic;">${record.assigned || 'Pending'}</td>
            </tr>
          `).join('');
        }
      }
    }
    
    // Initialize patient list system
    populateLabTypeSelect();
    renderPatientRecords();
    
    // END PATIENT LIST / LABORATORY LOGBOOK SYSTEM
    
    // === SALES PAGE SYSTEM ===
    const salesTableBody = document.getElementById('salesTableBody');
    const salesTotalRevenue = document.getElementById('salesTotalRevenue');
    const salesTotalTransactions = document.getElementById('salesTotalTransactions');
    const salesTotalItems = document.getElementById('salesTotalItems');
    const salesAverageSale = document.getElementById('salesAverageSale');
    const salesSearchInput = document.getElementById('salesSearchInput');
    const exportSalesBtn = document.getElementById('exportSalesBtn');
    const salesPeriodBtns = document.querySelectorAll('.sales-period-btn');
    const categoryBreakdownGrid = document.getElementById('categoryBreakdownGrid');

    let currentSalesPeriod = 'today';
    let currentSalesSearch = '';

    // Check if mobile device
    function isMobileDevice() {
      return window.innerWidth <= 768;
    }

    // Format mobile-friendly item breakdown
    function formatItemsForMobile(items, total) {
      const itemsHtml = items.map(item => {
        const subtotal = item.quantity * item.price;
        return `
          <div class="sales-item-row">
            <span class="sales-item-name">${item.name}</span>
            <span class="sales-item-calculation">${item.quantity}  ${item.price.toLocaleString()}</span>
            <span class="sales-item-subtotal">= ${subtotal.toLocaleString()}</span>
          </div>
        `;
      }).join('');
      
      return `
        <div class="sales-items-breakdown">
          ${itemsHtml}
          <div class="sales-breakdown-total">
            <span class="sales-breakdown-total-label">TOTAL:</span>
            <span class="sales-breakdown-total-value">${total.toLocaleString()}</span>
          </div>
        </div>
      `;
    }

    // Sample sales data - in production, this would come from your database
    let salesRecords = [
      {
        id: 1,
        timestamp: '2026-01-26 09:30:00',
        patient: 'John Doe',
        nurse: 'Mark Cruz',
        items: [
          { name: 'Paracetamol', category: 'Medicine', quantity: 2, price: 5 },
          { name: 'Face Mask', category: 'PPE', quantity: 5, price: 10 }
        ],
        total: 60
      },
      {
        id: 2,
        timestamp: '2026-01-26 10:15:00',
        patient: 'Jane Smith',
        nurse: 'Maria Santos',
        items: [
          { name: 'Syringe', category: 'Supplies', quantity: 3, price: 8 },
          { name: 'Bandage', category: 'Supplies', quantity: 2, price: 15 }
        ],
        total: 54
      },
      {
        id: 3,
        timestamp: '2026-01-26 11:00:00',
        patient: 'Robert Johnson',
        nurse: 'Mark Cruz',
        items: [
          { name: 'Alcohol', category: 'Hygiene', quantity: 1, price: 100 },
          { name: 'Cotton', category: 'Supplies', quantity: 1, price: 20 }
        ],
        total: 120
      },
      {
        id: 4,
        timestamp: '2026-01-26 14:30:00',
        patient: 'Mary Williams',
        nurse: 'Jane Smith',
        items: [
          { name: 'Ibuprofen', category: 'Medicine', quantity: 3, price: 8 },
          { name: 'Vitamin C', category: 'Medicine', quantity: 2, price: 10 }
        ],
        total: 44
      },
      {
        id: 5,
        timestamp: '2026-01-25 15:45:00',
        patient: 'David Brown',
        nurse: 'Mark Cruz',
        items: [
          { name: 'N95 Mask', category: 'PPE', quantity: 10, price: 50 },
          { name: 'Gloves', category: 'PPE', quantity: 5, price: 5 }
        ],
        total: 525
      },
      {
        id: 6,
        timestamp: '2026-01-20 09:00:00',
        patient: 'Sarah Davis',
        nurse: 'Maria Santos',
        items: [
          { name: 'Thermometer', category: 'Equipment', quantity: 1, price: 200 },
          { name: 'Alcohol', category: 'Hygiene', quantity: 2, price: 100 }
        ],
        total: 400
      },
      {
        id: 7,
        timestamp: '2026-01-15 11:30:00',
        patient: 'Michael Wilson',
        nurse: 'Mark Cruz',
        items: [
          { name: 'Amoxicillin', category: 'Medicine', quantity: 1, price: 15 },
          { name: 'Face Shield', category: 'PPE', quantity: 2, price: 30 }
        ],
        total: 75
      },
      {
        id: 8,
        timestamp: '2025-12-28 16:20:00',
        patient: 'Lisa Martinez',
        nurse: 'Jane Smith',
        items: [
          { name: 'BP Monitor', category: 'Equipment', quantity: 1, price: 1500 },
          { name: 'Sanitizer', category: 'Hygiene', quantity: 3, price: 80 }
        ],
        total: 1740
      }
    ];

    // Period selector
    salesPeriodBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        currentSalesPeriod = btn.dataset.period;
        salesPeriodBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderSalesRecords();
      });
    });

    // Search input
    if (salesSearchInput) {
      salesSearchInput.addEventListener('input', (e) => {
        currentSalesSearch = e.target.value.toLowerCase();
        renderSalesRecords();
      });
    }

    // Filter sales by period
    function filterSalesByPeriod(records) {
      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
      const yearStart = new Date(now.getFullYear(), 0, 1);
      
      return records.filter(record => {
        const recordDate = new Date(record.timestamp);
        
        if (currentSalesPeriod === 'today') {
          return recordDate >= today;
        } else if (currentSalesPeriod === 'month') {
          return recordDate >= monthStart;
        } else if (currentSalesPeriod === 'year') {
          return recordDate >= yearStart;
        }
        
        return true;
      });
    }

    // Render sales records
    function renderSalesRecords() {
      let filtered = [...salesRecords];
      
      // Filter by period
      filtered = filterSalesByPeriod(filtered);
      
      // Filter by search
      if (currentSalesSearch) {
        filtered = filtered.filter(record => {
          const searchableText = `
            ${record.patient}
            ${record.nurse}
            ${record.items.map(item => item.name).join(' ')}
          `.toLowerCase();
          
          return searchableText.includes(currentSalesSearch);
        });
      }
      
      // Sort by date (newest first)
      filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      // Calculate summary
      const totalRevenue = filtered.reduce((sum, record) => sum + record.total, 0);
      const totalTransactions = filtered.length;
      const totalItems = filtered.reduce((sum, record) => {
        return sum + record.items.reduce((itemSum, item) => itemSum + item.quantity, 0);
      }, 0);
      const averageSale = totalTransactions > 0 ? totalRevenue / totalTransactions : 0;
      
      // Update summary cards
      if (salesTotalRevenue) salesTotalRevenue.textContent = `${totalRevenue.toLocaleString()}`;
      if (salesTotalTransactions) salesTotalTransactions.textContent = totalTransactions.toLocaleString();
      if (salesTotalItems) salesTotalItems.textContent = totalItems.toLocaleString();
      if (salesAverageSale) salesAverageSale.textContent = `${Math.round(averageSale).toLocaleString()}`;
      
      // Render table
      if (salesTableBody) {
        if (filtered.length === 0) {
          salesTableBody.innerHTML = `
            <tr>
              <td colspan="6">
                <div class="sales-empty-state">
                  <div class="sales-empty-icon"></div>
                  <h3>No sales records found</h3>
                  <p>No sales match your current filters</p>
                </div>
              </td>
            </tr>
          `;
        } else {
                salesTableBody.innerHTML = filtered.map(record => {
                const date = new Date(record.timestamp);
                const formattedDate = date.toLocaleDateString('en-US', { 
                  month: 'short', 
                  day: 'numeric',
                  year: 'numeric'
                });
                const formattedTime = date.toLocaleTimeString('en-US', { 
                  hour: '2-digit', 
                  minute: '2-digit'
                });
                
                // Build detailed items breakdown
                const breakdownWithTotal = formatItemsForMobile(record.items, record.total);
                
                return `
                <tr>
                  <td class="sales-date" data-label="Date & Time">${formattedDate}<br><small>${formattedTime}</small></td>
                  <td class="sales-patient" data-label="Patient">${record.patient}</td>
                  <td class="sales-nurse" data-label="Nurse">${record.nurse}</td>
                  <td data-label="Items Breakdown">${breakdownWithTotal}</td>
                  <td class="sales-total" data-label="Total">${record.total.toLocaleString()}</td>
                </tr>
              `;
                    }).join('');
      
          // Make items collapsible on mobile
          setTimeout(makeItemsCollapsible, 100);
        }
      }
      
      // Render category breakdown
      renderCategoryBreakdown(filtered);
    }

    // Render category breakdown
    function renderCategoryBreakdown(records) {
      const categoryTotals = {};
      
      records.forEach(record => {
        record.items.forEach(item => {
          if (!categoryTotals[item.category]) {
            categoryTotals[item.category] = 0;
          }
          categoryTotals[item.category] += item.quantity * item.price;
        });
      });
      
      if (categoryBreakdownGrid) {
        const categories = Object.keys(categoryTotals).sort();
        
        if (categories.length === 0) {
          categoryBreakdownGrid.innerHTML = '<p style="color: #9ca3af; text-align: center;">No data available</p>';
        } else {
          categoryBreakdownGrid.innerHTML = categories.map(category => `
            <div class="category-breakdown-item">
              <div class="category-breakdown-name">${category}</div>
              <div class="category-breakdown-value">${categoryTotals[category].toLocaleString()}</div>
            </div>
          `).join('');
        }
      }
    }

    // Export to Excel (CSV format)
    if (exportSalesBtn) {
      exportSalesBtn.addEventListener('click', () => {
        let filtered = filterSalesByPeriod([...salesRecords]);
        
        if (currentSalesSearch) {
          filtered = filtered.filter(record => {
            const searchableText = `
              ${record.patient}
              ${record.nurse}
              ${record.items.map(item => item.name).join(' ')}
            `.toLowerCase();
            
            return searchableText.includes(currentSalesSearch);
          });
        }
        
        if (filtered.length === 0) {
          alert('No data to export');
          return;
        }
        
           // Create CSV content
            let csv = 'Date,Time,Patient Name,Nurse,Item Name,Quantity,Unit Price,Subtotal,Transaction Total\n';
            
            filtered.forEach(record => {
              const date = new Date(record.timestamp);
              const formattedDate = date.toLocaleDateString('en-US');
              const formattedTime = date.toLocaleTimeString('en-US');
              
              // Add a row for each item
              record.items.forEach((item, index) => {
                const subtotal = item.quantity * item.price;
                const transactionTotal = index === 0 ? record.total : ''; // Only show total on first item
                
                csv += `"${formattedDate}","${formattedTime}","${record.patient}","${record.nurse}","${item.name}",${item.quantity},${item.price},${subtotal},${transactionTotal}\n`;
              });
              
              // Add empty row between transactions for readability
              csv += '\n';
            });
        
        // Create download
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        const periodText = currentSalesPeriod === 'today' ? 'Today' : 
                          currentSalesPeriod === 'month' ? 'This_Month' : 'This_Year';
        
        link.setAttribute('href', url);
        link.setAttribute('download', `Sales_Report_${periodText}_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Show success message
        exportSalesBtn.textContent = ' Exported!';
        exportSalesBtn.style.background = '#10b981';
        setTimeout(() => {
          exportSalesBtn.textContent = ' Export to Excel';
          exportSalesBtn.style.background = '#10b981';
        }, 2000);
      });
    }


    // Make sales items collapsible on mobile
    function makeItemsCollapsible() {
      if (window.innerWidth <= 768) {
        document.querySelectorAll('.sales-items-breakdown').forEach((breakdown, index) => {
          const items = breakdown.querySelectorAll('.sales-item-row').length;
          const total = breakdown.querySelector('.sales-breakdown-total-value').textContent;
          
          const summary = document.createElement('div');
          summary.className = 'sales-items-summary sales-item-toggle';
          summary.textContent = `${items} item${items > 1 ? 's' : ''}  ${total}`;
          summary.onclick = function() {
            breakdown.classList.toggle('collapsed');
            this.classList.toggle('collapsed');
          };
          
          breakdown.parentElement.insertBefore(summary, breakdown);
          breakdown.classList.add('collapsed');
          summary.classList.add('collapsed');
        });
      }
    }

    // Call after rendering on mobile
    window.addEventListener('resize', () => {
      if (window.innerWidth <= 768) {
        renderSalesRecords();
      }
    });

    // Initialize sales page
    renderSalesRecords();

    // END SALES PAGE SYSTEM
    
    // === INITIALIZE DASHBOARD WITH REAL INVENTORY DATA ===
    console.log('=== INITIALIZING DASHBOARD WITH REAL DATA ===');
    
    if (typeof updateDashboardOverview === 'function') {
      console.log('Loading dashboard inventory overview...');
      updateDashboardOverview();
    }
    
    if (typeof updateDashboardData === 'function') {
      console.log('Loading dashboard data for: today');
      updateDashboardData('today');
    }
    
    console.log('Dashboard initialized with real inventory counts');
    
    // Run initialization immediately
    initInventorySystem();
    
    // Also run when inventory page becomes visible
    if (inventoryPage) {
      // Check if page is already active
      if (inventoryPage.classList.contains('active')) {
        initInventorySystem();
      }
      
      // Watch for when page becomes active
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            if (inventoryPage.classList.contains('active')) {
              initInventorySystem();
            }
          }
        });
      });
      
      observer.observe(inventoryPage, { attributes: true });
    }


    // Smooth scroll to top when changing filters on mobile
salesPeriodBtns.forEach(btn => {
  const originalHandler = btn.onclick;
  btn.addEventListener('click', () => {
    if (isMobileDevice()) {
      setTimeout(() => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }, 100);
    }
  });
});

// Optimize mobile performance - lazy load if many records
function optimizeMobileRendering() {
  if (isMobileDevice() && salesRecords.length > 20) {
    // Show loading state
    const loadingHtml = `
      <tr>
        <td colspan="5">
          <div style="text-align: center; padding: 2rem; color: #6b7280;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;"></div>
            <div>Loading sales records...</div>
          </div>
        </td>
      </tr>
    `;
    
    if (salesTableBody) {
      salesTableBody.innerHTML = loadingHtml;
    }
    
    // Render after a brief delay to show loading state
    setTimeout(renderSalesRecords, 100);
  } else {
    renderSalesRecords();
  }
}

// Use optimized rendering when opening sales page
const salesPageLink = document.querySelector('[data-page="accounts"]');
if (salesPageLink) {
  salesPageLink.addEventListener('click', () => {
    setTimeout(optimizeMobileRendering, 50);
  });
}
    

    // === LEAVE MANAGEMENT SYSTEM ===
    
    // Employee data (integrate with your employee masterlist)
    const employees = [
      { id: 'LRCI-001', name: 'Golloso, Cristina Gahita', position: 'Chief Operating Officer', department: 'Executive', vlEntitled: 15, slEntitled: 15, vlUsed: 0, slUsed: 0 },
      { id: 'LRCI-002', name: 'Santiago, Diana Bagual', position: 'Administrative Manager', department: 'Administrative', vlEntitled: 7, slEntitled: 7, vlUsed: 0, slUsed: 0 },
      { id: 'LRCI-003', name: 'Cabigas, Karen Sumagit', position: 'Medical Director', department: 'Executive', vlEntitled: 15, slEntitled: 15, vlUsed: 0, slUsed: 0 }
    ];

    // Current user (from your auth system)
    let currentUser = { id: 'LRCI-002', name: 'Santiago, Diana Bagual', role: 'owner', position: 'Administrative Manager', department: 'Administrative' };

    // Leave applications storage
    let leaveApplications = [];

    // Initialize Leave System
    function initializeLeaveSystem() {
      updateLeaveStats();
      renderLeaveRequests('pending');
      setupLeaveEventListeners();
    }

    // Setup Event Listeners
    function setupLeaveEventListeners() {
      const applyBtn = document.getElementById('applyLeaveBtn');
      const closeApply = document.getElementById('closeApplyLeaveModal');
      const cancelApply = document.getElementById('cancelApplyLeave');
      const form = document.getElementById('applyLeaveForm');
      const closeView = document.getElementById('closeViewLeaveModal');
      const startDate = document.getElementById('leaveStartDate');
      const endDate = document.getElementById('leaveEndDate');
      const leaveType = document.getElementById('leaveType');
      const leaveTabs = document.querySelectorAll('.leave-tab');

      if (applyBtn) applyBtn.addEventListener('click', () => {
        document.getElementById('applyLeaveModal').classList.add('active');
        updateLeaveBalance();
      });

      if (closeApply) closeApply.addEventListener('click', () => {
        document.getElementById('applyLeaveModal').classList.remove('active');
        form.reset();
      });

      if (cancelApply) cancelApply.addEventListener('click', () => {
        document.getElementById('applyLeaveModal').classList.remove('active');
        form.reset();
      });

      if (closeView) closeView.addEventListener('click', () => {
        document.getElementById('viewLeaveModal').classList.remove('active');
      });

      if (startDate) startDate.addEventListener('change', calculateLeaveDays);
      if (endDate) endDate.addEventListener('change', calculateLeaveDays);
      if (leaveType) leaveType.addEventListener('change', updateLeaveBalance);

      if (form) form.addEventListener('submit', handleLeaveApplication);

      leaveTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const filter = tab.dataset.filter;
          leaveTabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          renderLeaveRequests(filter);
        });
      });
    }

    // Calculate Leave Days
    function calculateLeaveDays() {
      const start = document.getElementById('leaveStartDate').value;
      const end = document.getElementById('leaveEndDate').value;
      const daysInput = document.getElementById('leaveDays');

      if (start && end) {
        const startDate = new Date(start);
        const endDate = new Date(end);
        
        if (endDate >= startDate) {
          const days = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
          daysInput.value = days;
          updateLeaveBalance();
        } else {
          daysInput.value = 0;
          alert('End date must be after start date!');
        }
      }
    }

    // Update Leave Balance
    function updateLeaveBalance() {
      const leaveType = document.getElementById('leaveType').value;
      const days = parseInt(document.getElementById('leaveDays').value) || 0;
      const balanceInfo = document.getElementById('leaveBalanceInfo');

      if (!leaveType || days === 0) {
        balanceInfo.innerHTML = '';
        return;
      }

      const employee = employees.find(e => e.id === currentUser.id);
      if (!employee) return;

      let entitled, used, balance, remaining;
      
      if (leaveType === 'Vacation Leave') {
        entitled = employee.vlEntitled;
        used = employee.vlUsed;
      } else {
        entitled = employee.slEntitled;
        used = employee.slUsed;
      }

      balance = entitled - used;
      remaining = balance - days;
      const sufficient = remaining >= 0;

      balanceInfo.innerHTML = `
        <div class="balance-row">
          <span class="balance-label">${leaveType} Entitled:</span>
          <span class="balance-value">${entitled} days</span>
        </div>
        <div class="balance-row">
          <span class="balance-label">Used:</span>
          <span class="balance-value">${used} days</span>
        </div>
        <div class="balance-row">
          <span class="balance-label">Current Balance:</span>
          <span class="balance-value ${sufficient ? 'sufficient' : 'insufficient'}">${balance} days</span>
        </div>
        <div class="balance-row" style="border-top: 2px solid #e5e7eb; margin-top: 0.5rem; padding-top: 0.5rem;">
          <span class="balance-label">After This Leave:</span>
          <span class="balance-value ${sufficient ? 'sufficient' : 'insufficient'}">${remaining} days</span>
        </div>
        ${!sufficient ? '<p style="color: #ef4444; margin-top: 0.5rem; font-weight: 600;"> Insufficient leave balance!</p>' : ''}
      `;
    }

    // Handle Leave Application
    function handleLeaveApplication(e) {
      e.preventDefault();

      const leaveType = document.getElementById('leaveType').value;
      const startDate = document.getElementById('leaveStartDate').value;
      const endDate = document.getElementById('leaveEndDate').value;
      const days = parseInt(document.getElementById('leaveDays').value);
      const reason = document.getElementById('leaveReason').value;

      const employee = employees.find(e => e.id === currentUser.id);
      let balance = leaveType === 'Vacation Leave' ? (employee.vlEntitled - employee.vlUsed) : (employee.slEntitled - employee.slUsed);

      if (days > balance) {
        alert(' Insufficient leave balance!');
        return;
      }

      const newApp = {
        id: `LV-${new Date().getFullYear()}-${String(leaveApplications.length + 1).padStart(3, '0')}`,
        employeeId: currentUser.id,
        employeeName: currentUser.name,
        position: currentUser.position,
        department: currentUser.department,
        leaveType: leaveType,
        startDate: startDate,
        endDate: endDate,
        days: days,
        reason: reason,
        appliedDate: new Date().toISOString(),
        status: 'pending',
        approvedBy: null,
        approvedDate: null,
        remarks: null
      };

      leaveApplications.unshift(newApp);

      document.getElementById('applyLeaveModal').classList.remove('active');
      document.getElementById('applyLeaveForm').reset();

      updateLeaveStats();
      renderLeaveRequests('pending');

      alert(' Leave application submitted successfully!');
    }

    // Render Leave Requests
    function renderLeaveRequests(filter) {
      const list = document.getElementById('leaveRequestsList');
      if (!list) return;

      let filtered = leaveApplications;
      const today = new Date().toISOString().split('T')[0];

      if (filter === 'pending') filtered = leaveApplications.filter(a => a.status === 'pending');
      else if (filter === 'active') filtered = leaveApplications.filter(a => a.status === 'approved' && a.startDate <= today && a.endDate >= today);
      else if (filter === 'approved') filtered = leaveApplications.filter(a => a.status === 'approved');
      else if (filter === 'rejected') filtered = leaveApplications.filter(a => a.status === 'rejected');

      if (filtered.length === 0) {
        list.innerHTML = '<div class="empty-state"><div class="empty-state-icon"></div><div class="empty-state-text">No ' + (filter === 'all' ? '' : filter) + ' leave requests</div></div>';
        return;
      }

      let html = '';
      filtered.forEach(app => {
        const isActive = app.status === 'approved' && new Date(app.startDate) <= new Date() && new Date(app.endDate) >= new Date();
        
        html += `
          <div class="leave-request-card" onclick="showLeaveDetails('${app.id}')">
            <div class="leave-request-header">
              <div class="leave-request-info">
                <div class="employee-name">${app.employeeName}</div>
                <div class="employee-position">${app.position}  ${app.department}</div>
              </div>
              <div class="leave-status-badge status-${isActive ? 'active' : app.status}">
                ${isActive ? 'On Leave' : app.status.toUpperCase()}
              </div>
            </div>
            <div class="leave-request-details">
              <div class="detail-item">
                <div class="detail-label">Leave Type</div>
                <div class="detail-value">${app.leaveType}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Start Date</div>
                <div class="detail-value">${formatDate(app.startDate)}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">End Date</div>
                <div class="detail-value">${formatDate(app.endDate)}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Duration</div>
                <div class="detail-value">${app.days} day${app.days > 1 ? 's' : ''}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Applied</div>
                <div class="detail-value">${formatDateTime(app.appliedDate)}</div>
              </div>
            </div>
          </div>
        `;
      });

      list.innerHTML = html;
    }

    // Show Leave Details
    window.showLeaveDetails = function(leaveId) {
      const app = leaveApplications.find(a => a.id === leaveId);
      if (!app) return;

      const content = document.getElementById('leaveDetailsContent');
      const actions = document.getElementById('leaveActionButtons');
      const isActive = app.status === 'approved' && new Date(app.startDate) <= new Date() && new Date(app.endDate) >= new Date();

      content.innerHTML = `
        <div class="leave-status-badge status-${isActive ? 'active' : app.status}" style="margin-bottom: 1.5rem;">
          ${isActive ? 'CURRENTLY ON LEAVE' : app.status.toUpperCase()}
        </div>

        <div class="leave-details-grid">
          <div class="detail-group">
            <div class="detail-group-label">Employee</div>
            <div class="detail-group-value">${app.employeeName}</div>
          </div>
          <div class="detail-group">
            <div class="detail-group-label">Position</div>
            <div class="detail-group-value">${app.position}</div>
          </div>
          <div class="detail-group">
            <div class="detail-group-label">Department</div>
            <div class="detail-group-value">${app.department}</div>
          </div>
          <div class="detail-group">
            <div class="detail-group-label">Leave Type</div>
            <div class="detail-group-value">${app.leaveType}</div>
          </div>
          <div class="detail-group">
            <div class="detail-group-label">Start Date</div>
            <div class="detail-group-value">${formatDate(app.startDate)}</div>
          </div>
          <div class="detail-group">
            <div class="detail-group-label">End Date</div>
            <div class="detail-group-value">${formatDate(app.endDate)}</div>
          </div>
          <div class="detail-group">
            <div class="detail-group-label">Duration</div>
            <div class="detail-group-value">${app.days} day${app.days > 1 ? 's' : ''}</div>
          </div>
          <div class="detail-group">
            <div class="detail-group-label">Applied On</div>
            <div class="detail-group-value">${formatDateTime(app.appliedDate)}</div>
          </div>
        </div>

        <div class="leave-reason-section">
          <h4>Reason for Leave:</h4>
          <div class="leave-reason-text">${app.reason}</div>
        </div>

        ${app.approvedBy ? `
          <div class="leave-reason-section">
            <h4>Approval Details:</h4>
            <div class="leave-details-grid">
              <div class="detail-group">
                <div class="detail-group-label">Approved By</div>
                <div class="detail-group-value">${app.approvedBy}</div>
              </div>
              <div class="detail-group">
                <div class="detail-group-label">Approved On</div>
                <div class="detail-group-value">${formatDateTime(app.approvedDate)}</div>
              </div>
            </div>
            ${app.remarks ? `<div class="leave-reason-text" style="margin-top: 1rem;">${app.remarks}</div>` : ''}
          </div>
        ` : ''}
      `;

      if ((currentUser.role === 'owner' || currentUser.role === 'admin') && app.status === 'pending') {
        actions.innerHTML = `
          <button type="button" class="btn-secondary" onclick="rejectLeave('${app.id}')"> Reject</button>
          <button type="button" class="btn-primary" onclick="approveLeave('${app.id}')"> Approve</button>
        `;
      } else {
        actions.innerHTML = `
          <button type="button" class="btn-secondary" onclick="document.getElementById('viewLeaveModal').classList.remove('active')">Close</button>
        `;
      }

      document.getElementById('viewLeaveModal').classList.add('active');
    };

    // Approve Leave
    window.approveLeave = function(leaveId) {
      const password = prompt(' Enter password to approve leave:\n\n(This action will be logged)');
      
      if (password === null) return;
      
      if (password !== 'admin123') {
        alert(' Incorrect password!');
        return;
      }

      const app = leaveApplications.find(a => a.id === leaveId);
      if (!app) return;

      app.status = 'approved';
      app.approvedBy = currentUser.name;
      app.approvedDate = new Date().toISOString();

      const employee = employees.find(e => e.id === app.employeeId);
      if (employee) {
        if (app.leaveType === 'Vacation Leave') employee.vlUsed += app.days;
        else employee.slUsed += app.days;
      }

      console.log(` Leave approved: ${leaveId} by ${currentUser.name} at ${new Date().toLocaleString()}`);

      document.getElementById('viewLeaveModal').classList.remove('active');
      updateLeaveStats();
      renderLeaveRequests('pending');

      alert(' Leave application approved!');
    };

    // Reject Leave
    window.rejectLeave = function(leaveId) {
      const password = prompt(' Enter password to reject leave:\n\n(This action will be logged)');
      
      if (password === null) return;
      
      if (password !== 'admin123') {
        alert(' Incorrect password!');
        return;
      }

      const remarks = prompt('Reason for rejection (optional):');

      const app = leaveApplications.find(a => a.id === leaveId);
      if (!app) return;

      app.status = 'rejected';
      app.approvedBy = currentUser.name;
      app.approvedDate = new Date().toISOString();
      app.remarks = remarks || 'No remarks provided';

      console.log(` Leave rejected: ${leaveId} by ${currentUser.name} at ${new Date().toLocaleString()}`);

      document.getElementById('viewLeaveModal').classList.remove('active');
      updateLeaveStats();
      renderLeaveRequests('pending');

      alert('Leave application rejected.');
    };

    // Update Statistics
    function updateLeaveStats() {
      const today = new Date().toISOString().split('T')[0];
      const month = new Date().getMonth();
      const year = new Date().getFullYear();

      const pending = leaveApplications.filter(a => a.status === 'pending').length;
      const active = leaveApplications.filter(a => a.status === 'approved' && a.startDate <= today && a.endDate >= today).length;
      const approved = leaveApplications.filter(a => {
        if (a.status !== 'approved') return false;
        const d = new Date(a.approvedDate);
        return d.getMonth() === month && d.getFullYear() === year;
      }).length;
      const rejected = leaveApplications.filter(a => {
        if (a.status !== 'rejected') return false;
        const d = new Date(a.approvedDate);
        return d.getMonth() === month && d.getFullYear() === year;
      }).length;

      const pendingEl = document.getElementById('pendingCount');
      const activeEl = document.getElementById('activeLeaveCount');
      const approvedEl = document.getElementById('approvedCount');
      const rejectedEl = document.getElementById('rejectedCount');

      if (pendingEl) pendingEl.textContent = pending;
      if (activeEl) activeEl.textContent = active;
      if (approvedEl) approvedEl.textContent = approved;
      if (rejectedEl) rejectedEl.textContent = rejected;
    }

    // Format Date
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    // Format DateTime
    function formatDateTime(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    }

    // Initialize Leave System when page opens
    setTimeout(() => {
      if (document.getElementById('financials')) {
        initializeLeaveSystem();
      }
    }, 500);

  </script>
</body>
</html>
